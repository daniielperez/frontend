/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Bounds } from './model/bounds';
import { CornerMarker } from './model/cornerMarker';
import { CropTouch } from './model/cropTouch';
import { DragMarker } from './model/dragMarker';
import { ImageCropperModel } from './model/imageCropperModel';
import { ImageCropperDataShare } from './imageCropperDataShare';
import { PointPool } from './model/pointPool';
var ImageCropper = /** @class */ (function (_super) {
    tslib_1.__extends(ImageCropper, _super);
    function ImageCropper(cropperSettings) {
        var _this = _super.call(this) || this;
        _this.imageCropperDataShare = new ImageCropperDataShare();
        /** @type {?} */
        var x = 0;
        /** @type {?} */
        var y = 0;
        /** @type {?} */
        var width = cropperSettings.width;
        /** @type {?} */
        var height = cropperSettings.height;
        /** @type {?} */
        var keepAspect = cropperSettings.keepAspect;
        /** @type {?} */
        var touchRadius = cropperSettings.touchRadius;
        /** @type {?} */
        var centerTouchRadius = cropperSettings.centerTouchRadius;
        /** @type {?} */
        var minWidth = cropperSettings.minWidth;
        /** @type {?} */
        var minHeight = cropperSettings.minHeight;
        /** @type {?} */
        var croppedWidth = cropperSettings.croppedWidth;
        /** @type {?} */
        var croppedHeight = cropperSettings.croppedHeight;
        _this.cropperSettings = cropperSettings;
        _this.crop = _this;
        _this.x = x;
        _this.y = y;
        _this.canvasHeight = cropperSettings.canvasHeight;
        _this.canvasWidth = cropperSettings.canvasWidth;
        _this.width = width;
        if (width === void 0) {
            _this.width = 100;
        }
        _this.height = height;
        if (height === void 0) {
            _this.height = 50;
        }
        _this.keepAspect = keepAspect;
        if (keepAspect === void 0) {
            _this.keepAspect = true;
        }
        _this.touchRadius = touchRadius;
        if (touchRadius === void 0) {
            _this.touchRadius = 20;
        }
        _this.minWidth = minWidth;
        _this.minHeight = minHeight;
        _this.aspectRatio = 0;
        _this.currentDragTouches = [];
        _this.isMouseDown = false;
        _this.ratioW = 1;
        _this.ratioH = 1;
        _this.fileType = cropperSettings.fileType;
        _this.imageSet = false;
        _this.pointPool = new PointPool(200);
        _this.tl = new CornerMarker(x, y, touchRadius, _this.cropperSettings);
        _this.tr = new CornerMarker(x + width, y, touchRadius, _this.cropperSettings);
        _this.bl = new CornerMarker(x, y + height, touchRadius, _this.cropperSettings);
        _this.br = new CornerMarker(x + width, y + height, touchRadius, _this.cropperSettings);
        _this.tl.addHorizontalNeighbour(_this.tr);
        _this.tl.addVerticalNeighbour(_this.bl);
        _this.tr.addHorizontalNeighbour(_this.tl);
        _this.tr.addVerticalNeighbour(_this.br);
        _this.bl.addHorizontalNeighbour(_this.br);
        _this.bl.addVerticalNeighbour(_this.tl);
        _this.br.addHorizontalNeighbour(_this.bl);
        _this.br.addVerticalNeighbour(_this.tr);
        _this.markers = [_this.tl, _this.tr, _this.bl, _this.br];
        _this.center = new DragMarker(x + width / 2, y + height / 2, centerTouchRadius, _this.cropperSettings);
        _this.aspectRatio = height / width;
        _this.croppedImage = new Image();
        _this.currentlyInteracting = false;
        _this.cropWidth = croppedWidth;
        _this.cropHeight = croppedHeight;
        return _this;
    }
    /**
     * @private
     * @param {?} x
     * @return {?}
     */
    ImageCropper.prototype.sign = /**
     * @private
     * @param {?} x
     * @return {?}
     */
    function (x) {
        if (+x === x) {
            return x === 0 ? x : x > 0 ? 1 : -1;
        }
        return NaN;
    };
    /**
     * @private
     * @param {?} canvas
     * @param {?} evt
     * @return {?}
     */
    ImageCropper.prototype.getMousePos = /**
     * @private
     * @param {?} canvas
     * @param {?} evt
     * @return {?}
     */
    function (canvas, evt) {
        /** @type {?} */
        var rect = canvas.getBoundingClientRect();
        return new PointPool().instance.borrow(evt.clientX - rect.left, evt.clientY - rect.top);
    };
    /**
     * @private
     * @param {?} canvas
     * @param {?} touch
     * @return {?}
     */
    ImageCropper.prototype.getTouchPos = /**
     * @private
     * @param {?} canvas
     * @param {?} touch
     * @return {?}
     */
    function (canvas, touch) {
        /** @type {?} */
        var rect = canvas.getBoundingClientRect();
        return new PointPool().instance.borrow(touch.clientX - rect.left, touch.clientY - rect.top);
    };
    /**
     * @private
     * @param {?} img
     * @return {?}
     */
    ImageCropper.prototype.detectVerticalSquash = /**
     * @private
     * @param {?} img
     * @return {?}
     */
    function (img) {
        /** @type {?} */
        var ih = img.height;
        /** @type {?} */
        var canvas = document.createElement('canvas');
        canvas.width = 1;
        canvas.height = ih;
        /** @type {?} */
        var ctx = (/** @type {?} */ (canvas.getContext('2d')));
        ctx.drawImage(img, 0, 0);
        /** @type {?} */
        var imageData = ctx.getImageData(0, 0, 1, ih);
        if (imageData) {
            /** @type {?} */
            var data = imageData.data;
            // search image edge pixel position in case it is squashed vertically.
            /** @type {?} */
            var sy = 0;
            /** @type {?} */
            var ey = ih;
            /** @type {?} */
            var py = ih;
            while (py > sy) {
                /** @type {?} */
                var alpha = data[(py - 1) * 4 + 3];
                if (alpha === 0) {
                    ey = py;
                }
                else {
                    sy = py;
                }
                // tslint:disable-next-line:no-bitwise
                py = (ey + sy) >> 1;
            }
            /** @type {?} */
            var ratio = py / ih;
            return ratio === 0 ? 1 : ratio;
        }
        else {
            return 1;
        }
    };
    /**
     * @private
     * @param {?} dataUri
     * @return {?}
     */
    ImageCropper.prototype.getDataUriMimeType = /**
     * @private
     * @param {?} dataUri
     * @return {?}
     */
    function (dataUri) {
        // Get a substring because the regex does not perform well on very large strings.
        // Cater for optional charset. Length 50 shoould be enough.
        /** @type {?} */
        var dataUriSubstring = dataUri.substring(0, 50);
        /** @type {?} */
        var mimeType = 'image/png';
        // data-uri scheme
        // data:[<media type>][;charset=<character set>][;base64],<data>
        /** @type {?} */
        var regEx = RegExp(/^(data:)([\w\/\+]+);(charset=[\w-]+|base64).*,(.*)/gi);
        /** @type {?} */
        var matches = regEx.exec(dataUriSubstring);
        if (matches && matches[2]) {
            mimeType = matches[2];
            if (mimeType === 'image/jpg') {
                mimeType = 'image/jpeg';
            }
        }
        return mimeType;
    };
    /**
     * @param {?} canvas
     * @return {?}
     */
    ImageCropper.prototype.prepare = /**
     * @param {?} canvas
     * @return {?}
     */
    function (canvas) {
        this.buffer = document.createElement('canvas');
        this.cropCanvas = document.createElement('canvas');
        // todo get more reliable parent width value.
        /** @type {?} */
        var responsiveWidth = canvas.parentElement
            ? canvas.parentElement.clientWidth
            : 0;
        if (responsiveWidth > 0 && this.cropperSettings.dynamicSizing) {
            this.cropCanvas.width = responsiveWidth;
            this.buffer.width = responsiveWidth;
            canvas.width = responsiveWidth;
        }
        else {
            this.cropCanvas.width = this.cropWidth;
            this.buffer.width = canvas.width;
        }
        this.cropCanvas.height = this.cropHeight;
        this.buffer.height = canvas.height;
        this.canvas = canvas;
        this.ctx = (/** @type {?} */ (this.canvas.getContext('2d')));
        this.draw(this.ctx);
    };
    /**
     * @param {?} cropperSettings
     * @return {?}
     */
    ImageCropper.prototype.updateSettings = /**
     * @param {?} cropperSettings
     * @return {?}
     */
    function (cropperSettings) {
        this.cropperSettings = cropperSettings;
    };
    /**
     * @param {?} width
     * @param {?} height
     * @param {?=} setImage
     * @return {?}
     */
    ImageCropper.prototype.resizeCanvas = /**
     * @param {?} width
     * @param {?} height
     * @param {?=} setImage
     * @return {?}
     */
    function (width, height, setImage) {
        if (setImage === void 0) { setImage = false; }
        this.canvas.width = this.cropCanvas.width = this.width = this.canvasWidth = this.buffer.width = width;
        this.canvas.height = this.cropCanvas.height = this.height = this.canvasHeight = this.buffer.height = height;
        if (setImage) {
            this.setImage(this.srcImage);
        }
    };
    /**
     * @return {?}
     */
    ImageCropper.prototype.reset = /**
     * @return {?}
     */
    function () {
        this.setImage(undefined);
    };
    /**
     * @param {?} ctx
     * @return {?}
     */
    ImageCropper.prototype.draw = /**
     * @param {?} ctx
     * @return {?}
     */
    function (ctx) {
        /** @type {?} */
        var bounds = this.getBounds();
        if (this.srcImage) {
            ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight);
            /** @type {?} */
            var sourceAspect = this.srcImage.height / this.srcImage.width;
            /** @type {?} */
            var canvasAspect = this.canvasHeight / this.canvasWidth;
            /** @type {?} */
            var w = this.canvasWidth;
            /** @type {?} */
            var h = this.canvasHeight;
            if (canvasAspect > sourceAspect) {
                w = this.canvasWidth;
                h = this.canvasWidth * sourceAspect;
            }
            else {
                h = this.canvasHeight;
                w = this.canvasHeight / sourceAspect;
            }
            this.ratioW = w / this.srcImage.width;
            this.ratioH = h / this.srcImage.height;
            if (canvasAspect < sourceAspect) {
                this.drawImageIOSFix(ctx, this.srcImage, 0, 0, this.srcImage.width, this.srcImage.height, this.buffer.width / 2 - w / 2, 0, w, h);
            }
            else {
                this.drawImageIOSFix(ctx, this.srcImage, 0, 0, this.srcImage.width, this.srcImage.height, 0, this.buffer.height / 2 - h / 2, w, h);
            }
            ((/** @type {?} */ (this.buffer.getContext('2d')))).drawImage(this.canvas, 0, 0, this.canvasWidth, this.canvasHeight);
            ctx.lineWidth = this.cropperSettings.cropperDrawSettings.strokeWidth;
            ctx.strokeStyle = this.cropperSettings.cropperDrawSettings.strokeColor;
            ctx.fillStyle = this.cropperSettings.cropperDrawSettings.backgroundFillColor;
            if (!this.cropperSettings.rounded) {
                ctx.fillRect(0, 0, this.canvasWidth, this.canvasHeight);
                ctx.drawImage(this.buffer, bounds.left, bounds.top, Math.max(bounds.width, 1), Math.max(bounds.height, 1), bounds.left, bounds.top, bounds.width, bounds.height);
                ctx.strokeRect(bounds.left, bounds.top, bounds.width, bounds.height);
            }
            else {
                ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                ctx.save();
                ctx.beginPath();
                ctx.arc(bounds.left + bounds.width / 2, bounds.top + bounds.height / 2, bounds.width / 2, 0, 2 * Math.PI);
                ctx.stroke();
                ctx.clip();
                if (canvasAspect < sourceAspect) {
                    this.drawImageIOSFix(ctx, this.srcImage, 0, 0, this.srcImage.width, this.srcImage.height, this.buffer.width / 2 - w / 2, 0, w, h);
                }
                else {
                    this.drawImageIOSFix(ctx, this.srcImage, 0, 0, this.srcImage.width, this.srcImage.height, 0, this.buffer.height / 2 - h / 2, w, h);
                }
                ctx.restore();
            }
            /** @type {?} */
            var marker = void 0;
            // tslint:disable-next-line:prefer-for-of
            for (var i = 0; i < this.markers.length; i++) {
                marker = this.markers[i];
                marker.draw(ctx);
            }
            this.center.draw(ctx);
        }
        else {
            ctx.fillStyle = 'rgba(192,192,192,1)';
            ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
        }
    };
    /**
     * @param {?} x
     * @param {?} y
     * @param {?} marker
     * @return {?}
     */
    ImageCropper.prototype.dragCenter = /**
     * @param {?} x
     * @param {?} y
     * @param {?} marker
     * @return {?}
     */
    function (x, y, marker) {
        /** @type {?} */
        var bounds = this.getBounds();
        /** @type {?} */
        var left = x - bounds.width / 2;
        /** @type {?} */
        var right = x + bounds.width / 2;
        /** @type {?} */
        var top = y - bounds.height / 2;
        /** @type {?} */
        var bottom = y + bounds.height / 2;
        if (right >= this.maxXClamp) {
            x = this.maxXClamp - bounds.width / 2;
        }
        if (left <= this.minXClamp) {
            x = bounds.width / 2 + this.minXClamp;
        }
        if (top < this.minYClamp) {
            y = bounds.height / 2 + this.minYClamp;
        }
        if (bottom >= this.maxYClamp) {
            y = this.maxYClamp - bounds.height / 2;
        }
        this.tl.moveX(x - bounds.width / 2);
        this.tl.moveY(y - bounds.height / 2);
        this.tr.moveX(x + bounds.width / 2);
        this.tr.moveY(y - bounds.height / 2);
        this.bl.moveX(x - bounds.width / 2);
        this.bl.moveY(y + bounds.height / 2);
        this.br.moveX(x + bounds.width / 2);
        this.br.moveY(y + bounds.height / 2);
        marker.setPosition(x, y);
    };
    /**
     * @param {?} x
     * @param {?} y
     * @param {?} marker
     * @return {?}
     */
    ImageCropper.prototype.enforceMinSize = /**
     * @param {?} x
     * @param {?} y
     * @param {?} marker
     * @return {?}
     */
    function (x, y, marker) {
        /** @type {?} */
        var xLength = x - marker.getHorizontalNeighbour().position.x;
        /** @type {?} */
        var yLength = y - marker.getVerticalNeighbour().position.y;
        /** @type {?} */
        var xOver = this.minWidth - Math.abs(xLength);
        /** @type {?} */
        var yOver = this.minHeight - Math.abs(yLength);
        if (xLength === 0 || yLength === 0) {
            x = marker.position.x;
            y = marker.position.y;
            return new PointPool().instance.borrow(x, y);
        }
        if (this.keepAspect) {
            if (xOver > 0 && yOver / this.aspectRatio > 0) {
                if (xOver > yOver / this.aspectRatio) {
                    if (xLength < 0) {
                        x -= xOver;
                        if (yLength < 0) {
                            y -= xOver * this.aspectRatio;
                        }
                        else {
                            y += xOver * this.aspectRatio;
                        }
                    }
                    else {
                        x += xOver;
                        if (yLength < 0) {
                            y -= xOver * this.aspectRatio;
                        }
                        else {
                            y += xOver * this.aspectRatio;
                        }
                    }
                }
                else {
                    if (yLength < 0) {
                        y -= yOver;
                        if (xLength < 0) {
                            x -= yOver / this.aspectRatio;
                        }
                        else {
                            x += yOver / this.aspectRatio;
                        }
                    }
                    else {
                        y += yOver;
                        if (xLength < 0) {
                            x -= yOver / this.aspectRatio;
                        }
                        else {
                            x += yOver / this.aspectRatio;
                        }
                    }
                }
            }
            else {
                if (xOver > 0) {
                    if (xLength < 0) {
                        x -= xOver;
                        if (yLength < 0) {
                            y -= xOver * this.aspectRatio;
                        }
                        else {
                            y += xOver * this.aspectRatio;
                        }
                    }
                    else {
                        x += xOver;
                        if (yLength < 0) {
                            y -= xOver * this.aspectRatio;
                        }
                        else {
                            y += xOver * this.aspectRatio;
                        }
                    }
                }
                else {
                    if (yOver > 0) {
                        if (yLength < 0) {
                            y -= yOver;
                            if (xLength < 0) {
                                x -= yOver / this.aspectRatio;
                            }
                            else {
                                x += yOver / this.aspectRatio;
                            }
                        }
                        else {
                            y += yOver;
                            if (xLength < 0) {
                                x -= yOver / this.aspectRatio;
                            }
                            else {
                                x += yOver / this.aspectRatio;
                            }
                        }
                    }
                }
            }
        }
        else {
            if (xOver > 0) {
                if (xLength < 0) {
                    x -= xOver;
                }
                else {
                    x += xOver;
                }
            }
            if (yOver > 0) {
                if (yLength < 0) {
                    y -= yOver;
                }
                else {
                    y += yOver;
                }
            }
        }
        if (x < this.minXClamp ||
            x > this.maxXClamp ||
            y < this.minYClamp ||
            y > this.maxYClamp) {
            x = marker.position.x;
            y = marker.position.y;
        }
        return new PointPool().instance.borrow(x, y);
    };
    /**
     * @param {?} x
     * @param {?} y
     * @param {?} marker
     * @return {?}
     */
    ImageCropper.prototype.dragCorner = /**
     * @param {?} x
     * @param {?} y
     * @param {?} marker
     * @return {?}
     */
    function (x, y, marker) {
        /** @type {?} */
        var iX = 0;
        /** @type {?} */
        var iY = 0;
        /** @type {?} */
        var ax = 0;
        /** @type {?} */
        var ay = 0;
        /** @type {?} */
        var newHeight = 0;
        /** @type {?} */
        var newWidth = 0;
        /** @type {?} */
        var newY = 0;
        /** @type {?} */
        var newX = 0;
        /** @type {?} */
        var anchorMarker;
        /** @type {?} */
        var fold = 0;
        if (this.keepAspect) {
            anchorMarker = marker.getHorizontalNeighbour().getVerticalNeighbour();
            ax = anchorMarker.position.x;
            ay = anchorMarker.position.y;
            if (x <= anchorMarker.position.x) {
                if (y <= anchorMarker.position.y) {
                    iX = ax - 100 / this.aspectRatio;
                    iY = ay - (100 / this.aspectRatio) * this.aspectRatio;
                    fold = this.getSide(new PointPool().instance.borrow(iX, iY), anchorMarker.position, new PointPool().instance.borrow(x, y));
                    if (fold > 0) {
                        newHeight = Math.abs(anchorMarker.position.y - y);
                        newWidth = newHeight / this.aspectRatio;
                        newY = anchorMarker.position.y - newHeight;
                        newX = anchorMarker.position.x - newWidth;
                        /** @type {?} */
                        var min = this.enforceMinSize(newX, newY, marker);
                        marker.move(min.x, min.y);
                        new PointPool().instance.returnPoint(min);
                    }
                    else {
                        if (fold < 0) {
                            newWidth = Math.abs(anchorMarker.position.x - x);
                            newHeight = newWidth * this.aspectRatio;
                            newY = anchorMarker.position.y - newHeight;
                            newX = anchorMarker.position.x - newWidth;
                            /** @type {?} */
                            var min = this.enforceMinSize(newX, newY, marker);
                            marker.move(min.x, min.y);
                            new PointPool().instance.returnPoint(min);
                        }
                    }
                }
                else {
                    iX = ax - 100 / this.aspectRatio;
                    iY = ay + (100 / this.aspectRatio) * this.aspectRatio;
                    fold = this.getSide(new PointPool().instance.borrow(iX, iY), anchorMarker.position, new PointPool().instance.borrow(x, y));
                    if (fold > 0) {
                        newWidth = Math.abs(anchorMarker.position.x - x);
                        newHeight = newWidth * this.aspectRatio;
                        newY = anchorMarker.position.y + newHeight;
                        newX = anchorMarker.position.x - newWidth;
                        /** @type {?} */
                        var min = this.enforceMinSize(newX, newY, marker);
                        marker.move(min.x, min.y);
                        new PointPool().instance.returnPoint(min);
                    }
                    else {
                        if (fold < 0) {
                            newHeight = Math.abs(anchorMarker.position.y - y);
                            newWidth = newHeight / this.aspectRatio;
                            newY = anchorMarker.position.y + newHeight;
                            newX = anchorMarker.position.x - newWidth;
                            /** @type {?} */
                            var min = this.enforceMinSize(newX, newY, marker);
                            marker.move(min.x, min.y);
                            new PointPool().instance.returnPoint(min);
                        }
                    }
                }
            }
            else {
                if (y <= anchorMarker.position.y) {
                    iX = ax + 100 / this.aspectRatio;
                    iY = ay - (100 / this.aspectRatio) * this.aspectRatio;
                    fold = this.getSide(new PointPool().instance.borrow(iX, iY), anchorMarker.position, new PointPool().instance.borrow(x, y));
                    if (fold < 0) {
                        newHeight = Math.abs(anchorMarker.position.y - y);
                        newWidth = newHeight / this.aspectRatio;
                        newY = anchorMarker.position.y - newHeight;
                        newX = anchorMarker.position.x + newWidth;
                        /** @type {?} */
                        var min = this.enforceMinSize(newX, newY, marker);
                        marker.move(min.x, min.y);
                        new PointPool().instance.returnPoint(min);
                    }
                    else {
                        if (fold > 0) {
                            newWidth = Math.abs(anchorMarker.position.x - x);
                            newHeight = newWidth * this.aspectRatio;
                            newY = anchorMarker.position.y - newHeight;
                            newX = anchorMarker.position.x + newWidth;
                            /** @type {?} */
                            var min = this.enforceMinSize(newX, newY, marker);
                            marker.move(min.x, min.y);
                            new PointPool().instance.returnPoint(min);
                        }
                    }
                }
                else {
                    iX = ax + 100 / this.aspectRatio;
                    iY = ay + (100 / this.aspectRatio) * this.aspectRatio;
                    fold = this.getSide(new PointPool().instance.borrow(iX, iY), anchorMarker.position, new PointPool().instance.borrow(x, y));
                    if (fold < 0) {
                        newWidth = Math.abs(anchorMarker.position.x - x);
                        newHeight = newWidth * this.aspectRatio;
                        newY = anchorMarker.position.y + newHeight;
                        newX = anchorMarker.position.x + newWidth;
                        /** @type {?} */
                        var min = this.enforceMinSize(newX, newY, marker);
                        marker.move(min.x, min.y);
                        new PointPool().instance.returnPoint(min);
                    }
                    else {
                        if (fold > 0) {
                            newHeight = Math.abs(anchorMarker.position.y - y);
                            newWidth = newHeight / this.aspectRatio;
                            newY = anchorMarker.position.y + newHeight;
                            newX = anchorMarker.position.x + newWidth;
                            /** @type {?} */
                            var min = this.enforceMinSize(newX, newY, marker);
                            marker.move(min.x, min.y);
                            new PointPool().instance.returnPoint(min);
                        }
                    }
                }
            }
        }
        else {
            /** @type {?} */
            var min = this.enforceMinSize(x, y, marker);
            marker.move(min.x, min.y);
            new PointPool().instance.returnPoint(min);
        }
        this.center.recalculatePosition(this.getBounds());
    };
    /**
     * @param {?} a
     * @param {?} b
     * @param {?} c
     * @return {?}
     */
    ImageCropper.prototype.getSide = /**
     * @param {?} a
     * @param {?} b
     * @param {?} c
     * @return {?}
     */
    function (a, b, c) {
        /** @type {?} */
        var n = this.sign((b.x - a.x) * (c.y - a.y) - (b.y - a.y) * (c.x - a.x));
        // TODO move the return of the pools to outside of this function
        new PointPool().instance.returnPoint(a);
        new PointPool().instance.returnPoint(c);
        return n;
    };
    /**
     * @param {?} newCropTouch
     * @return {?}
     */
    ImageCropper.prototype.handleRelease = /**
     * @param {?} newCropTouch
     * @return {?}
     */
    function (newCropTouch) {
        if (newCropTouch == null) {
            return;
        }
        /** @type {?} */
        var index = 0;
        for (var k = 0; k < this.currentDragTouches.length; k++) {
            if (newCropTouch.id === this.currentDragTouches[k].id) {
                this.currentDragTouches[k].dragHandle.setDrag(false);
                index = k;
            }
        }
        this.currentDragTouches.splice(index, 1);
        this.draw(this.ctx);
    };
    /**
     * @param {?} newCropTouch
     * @return {?}
     */
    ImageCropper.prototype.handleMove = /**
     * @param {?} newCropTouch
     * @return {?}
     */
    function (newCropTouch) {
        var e_1, _a;
        /** @type {?} */
        var matched = false;
        // tslint:disable-next-line:prefer-for-of
        for (var k = 0; k < this.currentDragTouches.length; k++) {
            if (newCropTouch.id === this.currentDragTouches[k].id &&
                this.currentDragTouches[k].dragHandle != null) {
                /** @type {?} */
                var dragTouch = this.currentDragTouches[k];
                /** @type {?} */
                var clampedPositions = this.clampPosition(newCropTouch.x - dragTouch.dragHandle.offset.x, newCropTouch.y - dragTouch.dragHandle.offset.y);
                newCropTouch.x = clampedPositions.x;
                newCropTouch.y = clampedPositions.y;
                new PointPool().instance.returnPoint(clampedPositions);
                if (dragTouch.dragHandle instanceof CornerMarker) {
                    this.dragCorner(newCropTouch.x, newCropTouch.y, (/** @type {?} */ (dragTouch.dragHandle)));
                }
                else {
                    this.dragCenter(newCropTouch.x, newCropTouch.y, (/** @type {?} */ (dragTouch.dragHandle)));
                }
                this.currentlyInteracting = true;
                matched = true;
                this.imageCropperDataShare.setPressed(this.canvas);
                break;
            }
        }
        if (!matched) {
            try {
                for (var _b = tslib_1.__values(this.markers), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var marker = _c.value;
                    if (marker.touchInBounds(newCropTouch.x, newCropTouch.y)) {
                        newCropTouch.dragHandle = marker;
                        this.currentDragTouches.push(newCropTouch);
                        marker.setDrag(true);
                        newCropTouch.dragHandle.offset.x =
                            newCropTouch.x - newCropTouch.dragHandle.position.x;
                        newCropTouch.dragHandle.offset.y =
                            newCropTouch.y - newCropTouch.dragHandle.position.y;
                        this.dragCorner(newCropTouch.x - newCropTouch.dragHandle.offset.x, newCropTouch.y - newCropTouch.dragHandle.offset.y, (/** @type {?} */ (newCropTouch.dragHandle)));
                        break;
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
            if (newCropTouch.dragHandle === null ||
                typeof newCropTouch.dragHandle === 'undefined') {
                if (this.center.touchInBounds(newCropTouch.x, newCropTouch.y)) {
                    newCropTouch.dragHandle = this.center;
                    this.currentDragTouches.push(newCropTouch);
                    newCropTouch.dragHandle.setDrag(true);
                    newCropTouch.dragHandle.offset.x =
                        newCropTouch.x - newCropTouch.dragHandle.position.x;
                    newCropTouch.dragHandle.offset.y =
                        newCropTouch.y - newCropTouch.dragHandle.position.y;
                    this.dragCenter(newCropTouch.x - newCropTouch.dragHandle.offset.x, newCropTouch.y - newCropTouch.dragHandle.offset.y, (/** @type {?} */ (newCropTouch.dragHandle)));
                }
            }
        }
    };
    /**
     * @return {?}
     */
    ImageCropper.prototype.updateClampBounds = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var sourceAspect = this.srcImage.height / this.srcImage.width;
        /** @type {?} */
        var canvasAspect = this.canvas.height / this.canvas.width;
        /** @type {?} */
        var w = this.canvas.width;
        /** @type {?} */
        var h = this.canvas.height;
        if (canvasAspect > sourceAspect) {
            w = this.canvas.width;
            h = this.canvas.width * sourceAspect;
        }
        else {
            h = this.canvas.height;
            w = this.canvas.height / sourceAspect;
        }
        this.minXClamp = this.canvas.width / 2 - w / 2;
        this.minYClamp = this.canvas.height / 2 - h / 2;
        this.maxXClamp = this.canvas.width / 2 + w / 2;
        this.maxYClamp = this.canvas.height / 2 + h / 2;
    };
    /**
     * @return {?}
     */
    ImageCropper.prototype.getCropBounds = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var bounds = this.getBounds();
        bounds.top = Math.round((bounds.top - this.minYClamp) / this.ratioH);
        bounds.bottom = Math.round((bounds.bottom - this.minYClamp) / this.ratioH);
        bounds.left = Math.round((bounds.left - this.minXClamp) / this.ratioW);
        bounds.right = Math.round((bounds.right - this.minXClamp) / this.ratioW);
        return bounds;
    };
    /**
     * @param {?} x
     * @param {?} y
     * @return {?}
     */
    ImageCropper.prototype.clampPosition = /**
     * @param {?} x
     * @param {?} y
     * @return {?}
     */
    function (x, y) {
        if (x < this.minXClamp) {
            x = this.minXClamp;
        }
        if (x > this.maxXClamp) {
            x = this.maxXClamp;
        }
        if (y < this.minYClamp) {
            y = this.minYClamp;
        }
        if (y > this.maxYClamp) {
            y = this.maxYClamp;
        }
        return new PointPool().instance.borrow(x, y);
    };
    /**
     * @return {?}
     */
    ImageCropper.prototype.isImageSet = /**
     * @return {?}
     */
    function () {
        return this.imageSet;
    };
    /**
     * @param {?} img
     * @return {?}
     */
    ImageCropper.prototype.setImage = /**
     * @param {?} img
     * @return {?}
     */
    function (img) {
        this.srcImage = img;
        if (!img) {
            this.imageSet = false;
            this.draw(this.ctx);
        }
        else {
            this.imageSet = true;
            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
            /** @type {?} */
            var bufferContext = (/** @type {?} */ (this.buffer.getContext('2d')));
            bufferContext.clearRect(0, 0, this.buffer.width, this.buffer.height);
            if (!this.cropperSettings.fileType) {
                this.fileType = this.getDataUriMimeType(img.src);
            }
            if (this.cropperSettings.minWithRelativeToResolution) {
                this.minWidth =
                    (this.canvas.width * this.cropperSettings.minWidth) /
                        this.srcImage.width;
                this.minHeight =
                    (this.canvas.height * this.cropperSettings.minHeight) /
                        this.srcImage.height;
            }
            this.updateClampBounds();
            this.canvasWidth = this.canvas.width;
            this.canvasHeight = this.canvas.height;
            /** @type {?} */
            var cropPosition = this.getCropPositionFromMarkers();
            this.setCropPosition(cropPosition);
        }
    };
    /**
     * @param {?} cropBounds
     * @return {?}
     */
    ImageCropper.prototype.updateCropPosition = /**
     * @param {?} cropBounds
     * @return {?}
     */
    function (cropBounds) {
        /** @type {?} */
        var cropPosition = this.getCropPositionFromBounds(cropBounds);
        this.setCropPosition(cropPosition);
    };
    /**
     * @private
     * @param {?} cropPosition
     * @return {?}
     */
    ImageCropper.prototype.setCropPosition = /**
     * @private
     * @param {?} cropPosition
     * @return {?}
     */
    function (cropPosition) {
        var e_2, _a;
        this.tl.setPosition(cropPosition[0].x, cropPosition[0].y);
        this.tr.setPosition(cropPosition[1].x, cropPosition[1].y);
        this.bl.setPosition(cropPosition[2].x, cropPosition[2].y);
        this.br.setPosition(cropPosition[3].x, cropPosition[3].y);
        this.center.setPosition(cropPosition[4].x, cropPosition[4].y);
        try {
            for (var cropPosition_1 = tslib_1.__values(cropPosition), cropPosition_1_1 = cropPosition_1.next(); !cropPosition_1_1.done; cropPosition_1_1 = cropPosition_1.next()) {
                var position = cropPosition_1_1.value;
                new PointPool().instance.returnPoint(position);
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (cropPosition_1_1 && !cropPosition_1_1.done && (_a = cropPosition_1.return)) _a.call(cropPosition_1);
            }
            finally { if (e_2) throw e_2.error; }
        }
        this.vertSquashRatio = this.detectVerticalSquash(this.srcImage);
        this.draw(this.ctx);
        this.croppedImage = this.getCroppedImageHelper(false, this.cropWidth, this.cropHeight);
    };
    /**
     * @private
     * @return {?}
     */
    ImageCropper.prototype.getCropPositionFromMarkers = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var w = this.canvas.width;
        /** @type {?} */
        var h = this.canvas.height;
        /** @type {?} */
        var tlPos;
        /** @type {?} */
        var trPos;
        /** @type {?} */
        var blPos;
        /** @type {?} */
        var brPos;
        /** @type {?} */
        var center;
        /** @type {?} */
        var sourceAspect = this.srcImage.height / this.srcImage.width;
        /** @type {?} */
        var cropBounds = this.getBounds();
        /** @type {?} */
        var cropAspect = cropBounds.height / cropBounds.width;
        /** @type {?} */
        var cX = this.canvas.width / 2;
        /** @type {?} */
        var cY = this.canvas.height / 2;
        if (cropAspect > sourceAspect) {
            /** @type {?} */
            var imageH = Math.min(w * sourceAspect, h);
            /** @type {?} */
            var cropW = imageH / cropAspect;
            tlPos = new PointPool().instance.borrow(cX - cropW / 2, cY + imageH / 2);
            trPos = new PointPool().instance.borrow(cX + cropW / 2, cY + imageH / 2);
            blPos = new PointPool().instance.borrow(cX - cropW / 2, cY - imageH / 2);
            brPos = new PointPool().instance.borrow(cX + cropW / 2, cY - imageH / 2);
        }
        else {
            /** @type {?} */
            var imageW = Math.min(h / sourceAspect, w);
            /** @type {?} */
            var cropH = imageW * cropAspect;
            tlPos = new PointPool().instance.borrow(cX - imageW / 2, cY + cropH / 2);
            trPos = new PointPool().instance.borrow(cX + imageW / 2, cY + cropH / 2);
            blPos = new PointPool().instance.borrow(cX - imageW / 2, cY - cropH / 2);
            brPos = new PointPool().instance.borrow(cX + imageW / 2, cY - cropH / 2);
        }
        center = new PointPool().instance.borrow(cX, cY);
        /** @type {?} */
        var positions = [tlPos, trPos, blPos, brPos, center];
        return positions;
    };
    /**
     * @private
     * @param {?} cropPosition
     * @return {?}
     */
    ImageCropper.prototype.getCropPositionFromBounds = /**
     * @private
     * @param {?} cropPosition
     * @return {?}
     */
    function (cropPosition) {
        /** @type {?} */
        var marginTop = 0;
        /** @type {?} */
        var marginLeft = 0;
        /** @type {?} */
        var canvasAspect = this.canvasHeight / this.canvasWidth;
        /** @type {?} */
        var sourceAspect = this.srcImage.height / this.srcImage.width;
        if (canvasAspect > sourceAspect) {
            marginTop =
                this.buffer.height / 2 - (this.canvasWidth * sourceAspect) / 2;
        }
        else {
            marginLeft = this.buffer.width / 2 - this.canvasHeight / sourceAspect / 2;
        }
        /** @type {?} */
        var ratioW = (this.canvasWidth - marginLeft * 2) / this.srcImage.width;
        /** @type {?} */
        var ratioH = (this.canvasHeight - marginTop * 2) / this.srcImage.height;
        /** @type {?} */
        var actualH = cropPosition.height * ratioH;
        /** @type {?} */
        var actualW = cropPosition.width * ratioW;
        /** @type {?} */
        var actualX = cropPosition.left * ratioW + marginLeft;
        /** @type {?} */
        var actualY = cropPosition.top * ratioH + marginTop;
        if (this.keepAspect) {
            /** @type {?} */
            var scaledW = actualH / this.aspectRatio;
            /** @type {?} */
            var scaledH = actualW * this.aspectRatio;
            if (this.getCropBounds().height === cropPosition.height) {
                // only width changed
                actualH = scaledH;
            }
            else if (this.getCropBounds().width === cropPosition.width) {
                // only height changed
                actualW = scaledW;
            }
            else {
                // height and width changed
                if (Math.abs(scaledH - actualH) < Math.abs(scaledW - actualW)) {
                    actualW = scaledW;
                }
                else {
                    actualH = scaledH;
                }
            }
        }
        /** @type {?} */
        var tlPos = new PointPool().instance.borrow(actualX, actualY + actualH);
        /** @type {?} */
        var trPos = new PointPool().instance.borrow(actualX + actualW, actualY + actualH);
        /** @type {?} */
        var blPos = new PointPool().instance.borrow(actualX, actualY);
        /** @type {?} */
        var brPos = new PointPool().instance.borrow(actualX + actualW, actualY);
        /** @type {?} */
        var center = new PointPool().instance.borrow(actualX + actualW / 2, actualY + actualH / 2);
        /** @type {?} */
        var positions = [tlPos, trPos, blPos, brPos, center];
        return positions;
    };
    /**
     * @param {?=} preserveSize
     * @param {?=} fillWidth
     * @param {?=} fillHeight
     * @return {?}
     */
    ImageCropper.prototype.getCroppedImageHelper = /**
     * @param {?=} preserveSize
     * @param {?=} fillWidth
     * @param {?=} fillHeight
     * @return {?}
     */
    function (preserveSize, fillWidth, fillHeight) {
        if (this.cropperSettings.cropOnResize) {
            return this.getCroppedImage(preserveSize, fillWidth, fillHeight);
        }
        return this.croppedImage
            ? this.croppedImage
            : document.createElement('img');
    };
    // todo: Unused parameters?
    // todo: Unused parameters?
    /**
     * @param {?=} preserveSize
     * @param {?=} fillWidth
     * @param {?=} fillHeight
     * @return {?}
     */
    ImageCropper.prototype.getCroppedImage = 
    // todo: Unused parameters?
    /**
     * @param {?=} preserveSize
     * @param {?=} fillWidth
     * @param {?=} fillHeight
     * @return {?}
     */
    function (preserveSize, fillWidth, fillHeight) {
        /** @type {?} */
        var bounds = this.getBounds();
        if (!this.srcImage) {
            return document.createElement('img');
        }
        else {
            /** @type {?} */
            var sourceAspect = this.srcImage.height / this.srcImage.width;
            /** @type {?} */
            var canvasAspect = this.canvas.height / this.canvas.width;
            /** @type {?} */
            var w = this.canvas.width;
            /** @type {?} */
            var h = this.canvas.height;
            if (canvasAspect > sourceAspect) {
                w = this.canvas.width;
                h = this.canvas.width * sourceAspect;
            }
            else {
                if (canvasAspect < sourceAspect) {
                    h = this.canvas.height;
                    w = this.canvas.height / sourceAspect;
                }
                else {
                    h = this.canvas.height;
                    w = this.canvas.width;
                }
            }
            this.ratioW = w / this.srcImage.width;
            this.ratioH = h / this.srcImage.height;
            /** @type {?} */
            var offsetH = (this.buffer.height - h) / 2 / this.ratioH;
            /** @type {?} */
            var offsetW = (this.buffer.width - w) / 2 / this.ratioW;
            /** @type {?} */
            var ctx = (/** @type {?} */ (this.cropCanvas.getContext('2d')));
            if (this.cropperSettings.preserveSize || preserveSize) {
                /** @type {?} */
                var width = Math.round(bounds.right / this.ratioW - bounds.left / this.ratioW);
                /** @type {?} */
                var height = Math.round(bounds.bottom / this.ratioH - bounds.top / this.ratioH);
                this.cropCanvas.width = width;
                this.cropCanvas.height = height;
                this.cropperSettings.croppedWidth = this.cropCanvas.width;
                this.cropperSettings.croppedHeight = this.cropCanvas.height;
            }
            else {
                this.cropCanvas.width = this.cropWidth;
                this.cropCanvas.height = this.cropHeight;
            }
            ctx.clearRect(0, 0, this.cropCanvas.width, this.cropCanvas.height);
            this.drawImageIOSFix(ctx, this.srcImage, Math.max(Math.round(bounds.left / this.ratioW - offsetW), 0), Math.max(Math.round(bounds.top / this.ratioH - offsetH), 0), Math.max(Math.round(bounds.width / this.ratioW), 1), Math.max(Math.round(bounds.height / this.ratioH), 1), 0, 0, this.cropCanvas.width, this.cropCanvas.height);
            if (this.cropperSettings.resampleFn) {
                this.cropperSettings.resampleFn(this.cropCanvas);
            }
            this.croppedImage.width = this.cropCanvas.width;
            this.croppedImage.height = this.cropCanvas.height;
            this.croppedImage.src = this.cropCanvas.toDataURL(this.fileType, this.cropperSettings.compressRatio);
            return this.croppedImage;
        }
    };
    /**
     * @return {?}
     */
    ImageCropper.prototype.getBounds = /**
     * @return {?}
     */
    function () {
        var e_3, _a;
        /** @type {?} */
        var minX = Number.MAX_VALUE;
        /** @type {?} */
        var minY = Number.MAX_VALUE;
        /** @type {?} */
        var maxX = -Number.MAX_VALUE;
        /** @type {?} */
        var maxY = -Number.MAX_VALUE;
        try {
            for (var _b = tslib_1.__values(this.markers), _c = _b.next(); !_c.done; _c = _b.next()) {
                var marker = _c.value;
                if (marker.position.x < minX) {
                    minX = marker.position.x;
                }
                if (marker.position.x > maxX) {
                    maxX = marker.position.x;
                }
                if (marker.position.y < minY) {
                    minY = marker.position.y;
                }
                if (marker.position.y > maxY) {
                    maxY = marker.position.y;
                }
            }
        }
        catch (e_3_1) { e_3 = { error: e_3_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_3) throw e_3.error; }
        }
        /** @type {?} */
        var bounds = new Bounds();
        bounds.left = minX;
        bounds.right = maxX;
        bounds.top = minY;
        bounds.bottom = maxY;
        return bounds;
    };
    /**
     * @param {?} bounds
     * @return {?}
     */
    ImageCropper.prototype.setBounds = /**
     * @param {?} bounds
     * @return {?}
     */
    function (bounds) {
        // const topLeft: CornerMarker;
        // const topRight: CornerMarker;
        // const bottomLeft: CornerMarker;
        // const bottomRight: CornerMarker;
        var e_4, _a;
        // const topLeft: CornerMarker;
        // const topRight: CornerMarker;
        // const bottomLeft: CornerMarker;
        // const bottomRight: CornerMarker;
        /** @type {?} */
        var currentBounds = this.getBounds();
        try {
            for (var _b = tslib_1.__values(this.markers), _c = _b.next(); !_c.done; _c = _b.next()) {
                var marker = _c.value;
                if (marker.position.x === currentBounds.left) {
                    if (marker.position.y === currentBounds.top) {
                        marker.setPosition(bounds.left, bounds.top);
                    }
                    else {
                        marker.setPosition(bounds.left, bounds.bottom);
                    }
                }
                else {
                    if (marker.position.y === currentBounds.top) {
                        marker.setPosition(bounds.right, bounds.top);
                    }
                    else {
                        marker.setPosition(bounds.right, bounds.bottom);
                    }
                }
            }
        }
        catch (e_4_1) { e_4 = { error: e_4_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_4) throw e_4.error; }
        }
        this.center.recalculatePosition(bounds);
        this.center.draw(this.ctx);
        this.draw(this.ctx); // we need to redraw all canvas if we have changed bounds
    };
    /**
     * @param {?} event
     * @return {?}
     */
    ImageCropper.prototype.onTouchMove = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (this.crop.isImageSet()) {
            if (event.touches.length === 1) {
                if (this.isMouseDown) {
                    event.preventDefault();
                    // tslint:disable-next-line:prefer-for-of
                    for (var i = 0; i < event.touches.length; i++) {
                        /** @type {?} */
                        var touch = event.touches[i];
                        /** @type {?} */
                        var touchPosition = this.getTouchPos(this.canvas, touch);
                        /** @type {?} */
                        var cropTouch = new CropTouch(touchPosition.x, touchPosition.y, touch.identifier);
                        new PointPool().instance.returnPoint(touchPosition);
                        this.move(cropTouch);
                    }
                }
            }
            else {
                if (event.touches.length === 2) {
                    event.preventDefault();
                    /** @type {?} */
                    var distance = (event.touches[0].clientX - event.touches[1].clientX) *
                        (event.touches[0].clientX - event.touches[1].clientX) +
                        (event.touches[0].clientY - event.touches[1].clientY) *
                            (event.touches[0].clientY - event.touches[1].clientY);
                    if (this.previousDistance && this.previousDistance !== distance) {
                        /** @type {?} */
                        var bounds = this.getBounds();
                        if (distance < this.previousDistance) {
                            bounds.top += 1;
                            bounds.left += 1;
                            bounds.right -= 1;
                            bounds.bottom -= 1;
                        }
                        if (distance > this.previousDistance) {
                            if (bounds.top !== this.minYClamp &&
                                bounds.bottom !== this.maxYClamp &&
                                bounds.left !== this.minXClamp &&
                                bounds.right !== this.maxXClamp) {
                                // none
                                bounds.top -= 1;
                                bounds.left -= 1;
                                bounds.right += 1;
                                bounds.bottom += 1;
                            }
                            else if (bounds.top !== this.minYClamp &&
                                bounds.bottom !== this.maxYClamp &&
                                bounds.left === this.minXClamp &&
                                bounds.right !== this.maxXClamp) {
                                // left
                                bounds.top -= 1;
                                bounds.right += 2;
                                bounds.bottom += 1;
                            }
                            else if (bounds.top !== this.minYClamp &&
                                bounds.bottom !== this.maxYClamp &&
                                bounds.left !== this.minXClamp &&
                                bounds.right === this.maxXClamp) {
                                // right
                                bounds.top -= 1;
                                bounds.left -= 2;
                                bounds.bottom += 1;
                            }
                            else if (bounds.top === this.minYClamp &&
                                bounds.bottom !== this.maxYClamp &&
                                bounds.left !== this.minXClamp &&
                                bounds.right !== this.maxXClamp) {
                                // top
                                bounds.left -= 1;
                                bounds.right += 1;
                                bounds.bottom += 2;
                            }
                            else if (bounds.top !== this.minYClamp &&
                                bounds.bottom === this.maxYClamp &&
                                bounds.left !== this.minXClamp &&
                                bounds.right !== this.maxXClamp) {
                                // bottom
                                bounds.top -= 2;
                                bounds.left -= 1;
                                bounds.right += 1;
                            }
                            else if (bounds.top === this.minYClamp &&
                                bounds.bottom !== this.maxYClamp &&
                                bounds.left === this.minXClamp &&
                                bounds.right !== this.maxXClamp) {
                                // top left
                                bounds.right += 2;
                                bounds.bottom += 2;
                            }
                            else if (bounds.top === this.minYClamp &&
                                bounds.bottom !== this.maxYClamp &&
                                bounds.left !== this.minXClamp &&
                                bounds.right === this.maxXClamp) {
                                // top right
                                bounds.left -= 2;
                                bounds.bottom += 2;
                            }
                            else if (bounds.top !== this.minYClamp &&
                                bounds.bottom === this.maxYClamp &&
                                bounds.left === this.minXClamp &&
                                bounds.right !== this.maxXClamp) {
                                // bottom left
                                bounds.top -= 2;
                                bounds.right += 2;
                            }
                            else if (bounds.top !== this.minYClamp &&
                                bounds.bottom === this.maxYClamp &&
                                bounds.left !== this.minXClamp &&
                                bounds.right === this.maxXClamp) {
                                // bottom right
                                bounds.top -= 2;
                                bounds.left -= 2;
                            }
                        }
                        if (bounds.top < this.minYClamp) {
                            bounds.top = this.minYClamp;
                        }
                        if (bounds.bottom > this.maxYClamp) {
                            bounds.bottom = this.maxYClamp;
                        }
                        if (bounds.left < this.minXClamp) {
                            bounds.left = this.minXClamp;
                        }
                        if (bounds.right > this.maxXClamp) {
                            bounds.right = this.maxXClamp;
                        }
                        this.setBounds(bounds);
                    }
                    this.previousDistance = distance;
                }
            }
            this.draw(this.ctx);
        }
    };
    /**
     * @param {?} e
     * @return {?}
     */
    ImageCropper.prototype.onMouseMove = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        if (this.crop.isImageSet() && this.isMouseDown) {
            /** @type {?} */
            var mousePosition = this.getMousePos(this.canvas, e);
            this.move(new CropTouch(mousePosition.x, mousePosition.y, 0));
            /** @type {?} */
            var dragTouch = this.getDragTouchForID(0);
            if (dragTouch) {
                dragTouch.x = mousePosition.x;
                dragTouch.y = mousePosition.y;
            }
            else {
                dragTouch = new CropTouch(mousePosition.x, mousePosition.y, 0);
            }
            new PointPool().instance.returnPoint(mousePosition);
            this.drawCursors(dragTouch);
            this.draw(this.ctx);
        }
    };
    /**
     * @param {?} cropTouch
     * @return {?}
     */
    ImageCropper.prototype.move = /**
     * @param {?} cropTouch
     * @return {?}
     */
    function (cropTouch) {
        if (this.isMouseDown) {
            this.handleMove(cropTouch);
        }
    };
    /**
     * @param {?} id
     * @return {?}
     */
    ImageCropper.prototype.getDragTouchForID = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        // tslint:disable-next-line:prefer-for-of
        for (var i = 0; i < this.currentDragTouches.length; i++) {
            if (id === this.currentDragTouches[i].id) {
                return this.currentDragTouches[i];
            }
        }
        return undefined;
    };
    /**
     * @param {?} cropTouch
     * @return {?}
     */
    ImageCropper.prototype.drawCursors = /**
     * @param {?} cropTouch
     * @return {?}
     */
    function (cropTouch) {
        /** @type {?} */
        var cursorDrawn = false;
        if (cropTouch != null) {
            if (cropTouch.dragHandle === this.center) {
                this.imageCropperDataShare.setStyle(this.canvas, 'move');
                cursorDrawn = true;
            }
            if (cropTouch.dragHandle !== null &&
                cropTouch.dragHandle instanceof CornerMarker) {
                this.drawCornerCursor(cropTouch.dragHandle, cropTouch.dragHandle.position.x, cropTouch.dragHandle.position.y);
                cursorDrawn = true;
            }
        }
        /** @type {?} */
        var didDraw = false;
        if (!cursorDrawn) {
            // tslint:disable-next-line:prefer-for-of
            for (var i = 0; i < this.markers.length; i++) {
                didDraw =
                    didDraw ||
                        this.drawCornerCursor(this.markers[i], cropTouch.x, cropTouch.y);
            }
            if (!didDraw) {
                this.imageCropperDataShare.setStyle(this.canvas, 'initial');
            }
        }
        if (!didDraw &&
            !cursorDrawn &&
            this.center.touchInBounds(cropTouch.x, cropTouch.y)) {
            this.center.setOver(true);
            this.imageCropperDataShare.setOver(this.canvas);
            this.imageCropperDataShare.setStyle(this.canvas, 'move');
        }
        else {
            this.center.setOver(false);
        }
    };
    /**
     * @param {?} marker
     * @param {?} x
     * @param {?} y
     * @return {?}
     */
    ImageCropper.prototype.drawCornerCursor = /**
     * @param {?} marker
     * @param {?} x
     * @param {?} y
     * @return {?}
     */
    function (marker, x, y) {
        if (marker.touchInBounds(x, y)) {
            marker.setOver(true);
            if (marker.getHorizontalNeighbour().position.x > marker.position.x) {
                if (marker.getVerticalNeighbour().position.y > marker.position.y) {
                    this.imageCropperDataShare.setOver(this.canvas);
                    this.imageCropperDataShare.setStyle(this.canvas, 'nwse-resize');
                }
                else {
                    this.imageCropperDataShare.setOver(this.canvas);
                    this.imageCropperDataShare.setStyle(this.canvas, 'nesw-resize');
                }
            }
            else {
                if (marker.getVerticalNeighbour().position.y > marker.position.y) {
                    this.imageCropperDataShare.setOver(this.canvas);
                    this.imageCropperDataShare.setStyle(this.canvas, 'nesw-resize');
                }
                else {
                    this.imageCropperDataShare.setOver(this.canvas);
                    this.imageCropperDataShare.setStyle(this.canvas, 'nwse-resize');
                }
            }
            return true;
        }
        marker.setOver(false);
        return false;
    };
    /**
     * @param {?} event
     * @return {?}
     */
    ImageCropper.prototype.onTouchStart = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var e_5, _a;
        if (this.crop.isImageSet()) {
            /** @type {?} */
            var touch = event.touches[0];
            /** @type {?} */
            var touchPosition = this.getTouchPos(this.canvas, touch);
            /** @type {?} */
            var cropTouch = new CropTouch(touchPosition.x, touchPosition.y, touch.identifier);
            new PointPool().instance.returnPoint(touchPosition);
            this.isMouseDown = false;
            try {
                for (var _b = tslib_1.__values(this.markers), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var marker = _c.value;
                    if (marker.touchInBounds(cropTouch.x, cropTouch.y)) {
                        this.isMouseDown = true;
                    }
                }
            }
            catch (e_5_1) { e_5 = { error: e_5_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_5) throw e_5.error; }
            }
            if (this.center.touchInBounds(cropTouch.x, cropTouch.y)) {
                this.isMouseDown = true;
            }
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    ImageCropper.prototype.onTouchEnd = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (this.crop.isImageSet()) {
            // tslint:disable-next-line:prefer-for-of
            for (var i = 0; i < event.changedTouches.length; i++) {
                /** @type {?} */
                var touch = event.changedTouches[i];
                /** @type {?} */
                var dragTouch = this.getDragTouchForID(touch.identifier);
                if (dragTouch && dragTouch !== undefined) {
                    if (dragTouch.dragHandle instanceof CornerMarker ||
                        dragTouch.dragHandle instanceof DragMarker) {
                        dragTouch.dragHandle.setOver(false);
                    }
                    this.handleRelease(dragTouch);
                }
            }
            if (this.currentDragTouches.length === 0) {
                this.isMouseDown = false;
                this.currentlyInteracting = false;
            }
        }
    };
    // http://stackoverflow.com/questions/11929099/html5-canvas-drawimage-ratio-bug-ios
    // http://stackoverflow.com/questions/11929099/html5-canvas-drawimage-ratio-bug-ios
    /**
     * @param {?} ctx
     * @param {?} img
     * @param {?} sx
     * @param {?} sy
     * @param {?} sw
     * @param {?} sh
     * @param {?} dx
     * @param {?} dy
     * @param {?} dw
     * @param {?} dh
     * @return {?}
     */
    ImageCropper.prototype.drawImageIOSFix = 
    // http://stackoverflow.com/questions/11929099/html5-canvas-drawimage-ratio-bug-ios
    /**
     * @param {?} ctx
     * @param {?} img
     * @param {?} sx
     * @param {?} sy
     * @param {?} sw
     * @param {?} sh
     * @param {?} dx
     * @param {?} dy
     * @param {?} dw
     * @param {?} dh
     * @return {?}
     */
    function (ctx, img, sx, sy, sw, sh, dx, dy, dw, dh) {
        // Works only if whole image is displayed:
        // ctx.drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh / vertSquashRatio);
        // The following works correct also when only a part of the image is displayed:
        // ctx.drawImage(img, sx * this.vertSquashRatio, sy * this.vertSquashRatio, sw * this.vertSquashRatio, sh *
        // this.vertSquashRatio, dx, dy, dw, dh);
        ctx.drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    ImageCropper.prototype.onMouseDown = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (this.crop.isImageSet()) {
            this.isMouseDown = true;
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    ImageCropper.prototype.onMouseUp = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (this.crop.isImageSet()) {
            this.imageCropperDataShare.setReleased(this.canvas);
            this.isMouseDown = false;
            this.handleRelease(new CropTouch(0, 0, 0));
        }
    };
    return ImageCropper;
}(ImageCropperModel));
export { ImageCropper };
if (false) {
    /**
     * @type {?}
     * @private
     */
    ImageCropper.prototype.crop;
    /**
     * @type {?}
     * @private
     */
    ImageCropper.prototype.cropperSettings;
    /**
     * @type {?}
     * @private
     */
    ImageCropper.prototype.previousDistance;
    /**
     * @type {?}
     * @private
     */
    ImageCropper.prototype.imageCropperDataShare;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2VDcm9wcGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWltZy1jcm9wcGVyLyIsInNvdXJjZXMiOlsibGliL2ltYWdlLWNyb3BwZXIvaW1hZ2VDcm9wcGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3hDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFOUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQzlELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUk5QztJQUFrQyx3Q0FBaUI7SUFNakQsc0JBQVksZUFBZ0M7UUFBNUMsWUFDRSxpQkFBTyxTQXNGUjtRQXJGQyxLQUFJLENBQUMscUJBQXFCLEdBQUcsSUFBSSxxQkFBcUIsRUFBRSxDQUFDOztZQUNuRCxDQUFDLEdBQUcsQ0FBQzs7WUFDTCxDQUFDLEdBQUcsQ0FBQzs7WUFDTCxLQUFLLEdBQVcsZUFBZSxDQUFDLEtBQUs7O1lBQ3JDLE1BQU0sR0FBVyxlQUFlLENBQUMsTUFBTTs7WUFDdkMsVUFBVSxHQUFZLGVBQWUsQ0FBQyxVQUFVOztZQUNoRCxXQUFXLEdBQVcsZUFBZSxDQUFDLFdBQVc7O1lBQ2pELGlCQUFpQixHQUFXLGVBQWUsQ0FBQyxpQkFBaUI7O1lBQzdELFFBQVEsR0FBVyxlQUFlLENBQUMsUUFBUTs7WUFDM0MsU0FBUyxHQUFXLGVBQWUsQ0FBQyxTQUFTOztZQUM3QyxZQUFZLEdBQVcsZUFBZSxDQUFDLFlBQVk7O1lBQ25ELGFBQWEsR0FBVyxlQUFlLENBQUMsYUFBYTtR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QyxNQUFNLEdBQUcsQ0FBQztRQUNwQyxJQUFJLEtBQUssSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQzNCLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1NBQ3ZDO1FBQ0QsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUMxQixDQUFDLEdBQUcsTUFBTSxDQUFDLEtBQUssR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQztTQUN2QztRQUNELElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDeEIsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7U0FDeEM7UUFDRCxJQUFJLE1BQU0sSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQzVCLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1NBQ3hDO1FBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDckMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDckMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDckMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDckMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDM0IsQ0FBQzs7Ozs7OztJQUVNLHFDQUFjOzs7Ozs7SUFBckIsVUFBc0IsQ0FBUyxFQUFFLENBQVMsRUFBRSxNQUFvQjs7WUFDeEQsT0FBTyxHQUFHLENBQUMsR0FBRyxNQUFNLENBQUMsc0JBQXNCLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQzs7WUFDeEQsT0FBTyxHQUFHLENBQUMsR0FBRyxNQUFNLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQzs7WUFDdEQsS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUM7O1lBQ3pDLEtBQUssR0FBRyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDO1FBRWhELElBQUksT0FBTyxLQUFLLENBQUMsSUFBSSxPQUFPLEtBQUssQ0FBQyxFQUFFO1lBQ2xDLENBQUMsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUN0QixDQUFDLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFFdEIsT0FBTyxJQUFJLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQzlDO1FBRUQsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ25CLElBQUksS0FBSyxHQUFHLENBQUMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLEVBQUU7Z0JBQzdDLElBQUksS0FBSyxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFO29CQUNwQyxJQUFJLE9BQU8sR0FBRyxDQUFDLEVBQUU7d0JBQ2YsQ0FBQyxJQUFJLEtBQUssQ0FBQzt3QkFFWCxJQUFJLE9BQU8sR0FBRyxDQUFDLEVBQUU7NEJBQ2YsQ0FBQyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO3lCQUMvQjs2QkFBTTs0QkFDTCxDQUFDLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7eUJBQy9CO3FCQUNGO3lCQUFNO3dCQUNMLENBQUMsSUFBSSxLQUFLLENBQUM7d0JBQ1gsSUFBSSxPQUFPLEdBQUcsQ0FBQyxFQUFFOzRCQUNmLENBQUMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQzt5QkFDL0I7NkJBQU07NEJBQ0wsQ0FBQyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO3lCQUMvQjtxQkFDRjtpQkFDRjtxQkFBTTtvQkFDTCxJQUFJLE9BQU8sR0FBRyxDQUFDLEVBQUU7d0JBQ2YsQ0FBQyxJQUFJLEtBQUssQ0FBQzt3QkFFWCxJQUFJLE9BQU8sR0FBRyxDQUFDLEVBQUU7NEJBQ2YsQ0FBQyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO3lCQUMvQjs2QkFBTTs0QkFDTCxDQUFDLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7eUJBQy9CO3FCQUNGO3lCQUFNO3dCQUNMLENBQUMsSUFBSSxLQUFLLENBQUM7d0JBQ1gsSUFBSSxPQUFPLEdBQUcsQ0FBQyxFQUFFOzRCQUNmLENBQUMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQzt5QkFDL0I7NkJBQU07NEJBQ0wsQ0FBQyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO3lCQUMvQjtxQkFDRjtpQkFDRjthQUNGO2lCQUFNO2dCQUNMLElBQUksS0FBSyxHQUFHLENBQUMsRUFBRTtvQkFDYixJQUFJLE9BQU8sR0FBRyxDQUFDLEVBQUU7d0JBQ2YsQ0FBQyxJQUFJLEtBQUssQ0FBQzt3QkFDWCxJQUFJLE9BQU8sR0FBRyxDQUFDLEVBQUU7NEJBQ2YsQ0FBQyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO3lCQUMvQjs2QkFBTTs0QkFDTCxDQUFDLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7eUJBQy9CO3FCQUNGO3lCQUFNO3dCQUNMLENBQUMsSUFBSSxLQUFLLENBQUM7d0JBQ1gsSUFBSSxPQUFPLEdBQUcsQ0FBQyxFQUFFOzRCQUNmLENBQUMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQzt5QkFDL0I7NkJBQU07NEJBQ0wsQ0FBQyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO3lCQUMvQjtxQkFDRjtpQkFDRjtxQkFBTTtvQkFDTCxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUU7d0JBQ2IsSUFBSSxPQUFPLEdBQUcsQ0FBQyxFQUFFOzRCQUNmLENBQUMsSUFBSSxLQUFLLENBQUM7NEJBRVgsSUFBSSxPQUFPLEdBQUcsQ0FBQyxFQUFFO2dDQUNmLENBQUMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQzs2QkFDL0I7aUNBQU07Z0NBQ0wsQ0FBQyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDOzZCQUMvQjt5QkFDRjs2QkFBTTs0QkFDTCxDQUFDLElBQUksS0FBSyxDQUFDOzRCQUNYLElBQUksT0FBTyxHQUFHLENBQUMsRUFBRTtnQ0FDZixDQUFDLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7NkJBQy9CO2lDQUFNO2dDQUNMLENBQUMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQzs2QkFDL0I7eUJBQ0Y7cUJBQ0Y7aUJBQ0Y7YUFDRjtTQUNGO2FBQU07WUFDTCxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUU7Z0JBQ2IsSUFBSSxPQUFPLEdBQUcsQ0FBQyxFQUFFO29CQUNmLENBQUMsSUFBSSxLQUFLLENBQUM7aUJBQ1o7cUJBQU07b0JBQ0wsQ0FBQyxJQUFJLEtBQUssQ0FBQztpQkFDWjthQUNGO1lBQ0QsSUFBSSxLQUFLLEdBQUcsQ0FBQyxFQUFFO2dCQUNiLElBQUksT0FBTyxHQUFHLENBQUMsRUFBRTtvQkFDZixDQUFDLElBQUksS0FBSyxDQUFDO2lCQUNaO3FCQUFNO29CQUNMLENBQUMsSUFBSSxLQUFLLENBQUM7aUJBQ1o7YUFDRjtTQUNGO1FBRUQsSUFDRSxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVM7WUFDbEIsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTO1lBQ2xCLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUztZQUNsQixDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFDbEI7WUFDQSxDQUFDLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDdEIsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1NBQ3ZCO1FBRUQsT0FBTyxJQUFJLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQy9DLENBQUM7Ozs7Ozs7SUFFTSxpQ0FBVTs7Ozs7O0lBQWpCLFVBQWtCLENBQVMsRUFBRSxDQUFTLEVBQUUsTUFBb0I7O1lBQ3RELEVBQUUsR0FBRyxDQUFDOztZQUNOLEVBQUUsR0FBRyxDQUFDOztZQUNOLEVBQUUsR0FBRyxDQUFDOztZQUNOLEVBQUUsR0FBRyxDQUFDOztZQUNOLFNBQVMsR0FBRyxDQUFDOztZQUNiLFFBQVEsR0FBRyxDQUFDOztZQUNaLElBQUksR0FBRyxDQUFDOztZQUNSLElBQUksR0FBRyxDQUFDOztZQUNSLFlBQTBCOztZQUMxQixJQUFJLEdBQUcsQ0FBQztRQUVaLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNuQixZQUFZLEdBQUcsTUFBTSxDQUFDLHNCQUFzQixFQUFFLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztZQUN0RSxFQUFFLEdBQUcsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDN0IsRUFBRSxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQzdCLElBQUksQ0FBQyxJQUFJLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFO2dCQUNoQyxJQUFJLENBQUMsSUFBSSxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRTtvQkFDaEMsRUFBRSxHQUFHLEVBQUUsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztvQkFDakMsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztvQkFDdEQsSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQ2pCLElBQUksU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQ3ZDLFlBQVksQ0FBQyxRQUFRLEVBQ3JCLElBQUksU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQ3RDLENBQUM7b0JBQ0YsSUFBSSxJQUFJLEdBQUcsQ0FBQyxFQUFFO3dCQUNaLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO3dCQUNsRCxRQUFRLEdBQUcsU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7d0JBQ3hDLElBQUksR0FBRyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxTQUFTLENBQUM7d0JBQzNDLElBQUksR0FBRyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUM7OzRCQUNwQyxHQUFHLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQzt3QkFDbkQsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDMUIsSUFBSSxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO3FCQUMzQzt5QkFBTTt3QkFDTCxJQUFJLElBQUksR0FBRyxDQUFDLEVBQUU7NEJBQ1osUUFBUSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7NEJBQ2pELFNBQVMsR0FBRyxRQUFRLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQzs0QkFDeEMsSUFBSSxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLFNBQVMsQ0FBQzs0QkFDM0MsSUFBSSxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLFFBQVEsQ0FBQzs7Z0NBQ3BDLEdBQUcsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDOzRCQUNuRCxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDOzRCQUMxQixJQUFJLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7eUJBQzNDO3FCQUNGO2lCQUNGO3FCQUFNO29CQUNMLEVBQUUsR0FBRyxFQUFFLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7b0JBQ2pDLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7b0JBQ3RELElBQUksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUNqQixJQUFJLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUN2QyxZQUFZLENBQUMsUUFBUSxFQUNyQixJQUFJLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUN0QyxDQUFDO29CQUNGLElBQUksSUFBSSxHQUFHLENBQUMsRUFBRTt3QkFDWixRQUFRLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQzt3QkFDakQsU0FBUyxHQUFHLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO3dCQUN4QyxJQUFJLEdBQUcsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsU0FBUyxDQUFDO3dCQUMzQyxJQUFJLEdBQUcsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsUUFBUSxDQUFDOzs0QkFDcEMsR0FBRyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUM7d0JBQ25ELE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQzFCLElBQUksU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztxQkFDM0M7eUJBQU07d0JBQ0wsSUFBSSxJQUFJLEdBQUcsQ0FBQyxFQUFFOzRCQUNaLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDOzRCQUNsRCxRQUFRLEdBQUcsU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7NEJBQ3hDLElBQUksR0FBRyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxTQUFTLENBQUM7NEJBQzNDLElBQUksR0FBRyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUM7O2dDQUNwQyxHQUFHLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQzs0QkFDbkQsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQzs0QkFDMUIsSUFBSSxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO3lCQUMzQztxQkFDRjtpQkFDRjthQUNGO2lCQUFNO2dCQUNMLElBQUksQ0FBQyxJQUFJLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFO29CQUNoQyxFQUFFLEdBQUcsRUFBRSxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO29CQUNqQyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO29CQUN0RCxJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FDakIsSUFBSSxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFDdkMsWUFBWSxDQUFDLFFBQVEsRUFDckIsSUFBSSxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FDdEMsQ0FBQztvQkFDRixJQUFJLElBQUksR0FBRyxDQUFDLEVBQUU7d0JBQ1osU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7d0JBQ2xELFFBQVEsR0FBRyxTQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQzt3QkFDeEMsSUFBSSxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLFNBQVMsQ0FBQzt3QkFDM0MsSUFBSSxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLFFBQVEsQ0FBQzs7NEJBQ3BDLEdBQUcsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDO3dCQUNuRCxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUMxQixJQUFJLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7cUJBQzNDO3lCQUFNO3dCQUNMLElBQUksSUFBSSxHQUFHLENBQUMsRUFBRTs0QkFDWixRQUFRLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQzs0QkFDakQsU0FBUyxHQUFHLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDOzRCQUN4QyxJQUFJLEdBQUcsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsU0FBUyxDQUFDOzRCQUMzQyxJQUFJLEdBQUcsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsUUFBUSxDQUFDOztnQ0FDcEMsR0FBRyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUM7NEJBQ25ELE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7NEJBQzFCLElBQUksU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQzt5QkFDM0M7cUJBQ0Y7aUJBQ0Y7cUJBQU07b0JBQ0wsRUFBRSxHQUFHLEVBQUUsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztvQkFDakMsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztvQkFDdEQsSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQ2pCLElBQUksU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQ3ZDLFlBQVksQ0FBQyxRQUFRLEVBQ3JCLElBQUksU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQ3RDLENBQUM7b0JBQ0YsSUFBSSxJQUFJLEdBQUcsQ0FBQyxFQUFFO3dCQUNaLFFBQVEsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO3dCQUNqRCxTQUFTLEdBQUcsUUFBUSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7d0JBQ3hDLElBQUksR0FBRyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxTQUFTLENBQUM7d0JBQzNDLElBQUksR0FBRyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUM7OzRCQUNwQyxHQUFHLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQzt3QkFDbkQsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDMUIsSUFBSSxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO3FCQUMzQzt5QkFBTTt3QkFDTCxJQUFJLElBQUksR0FBRyxDQUFDLEVBQUU7NEJBQ1osU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7NEJBQ2xELFFBQVEsR0FBRyxTQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQzs0QkFDeEMsSUFBSSxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLFNBQVMsQ0FBQzs0QkFDM0MsSUFBSSxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLFFBQVEsQ0FBQzs7Z0NBQ3BDLEdBQUcsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDOzRCQUNuRCxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDOzRCQUMxQixJQUFJLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7eUJBQzNDO3FCQUNGO2lCQUNGO2FBQ0Y7U0FDRjthQUFNOztnQkFDQyxHQUFHLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQztZQUM3QyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzFCLElBQUksU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUMzQztRQUNELElBQUksQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUM7SUFDcEQsQ0FBQzs7Ozs7OztJQUVNLDhCQUFPOzs7Ozs7SUFBZCxVQUFlLENBQVEsRUFBRSxDQUFRLEVBQUUsQ0FBUTs7WUFDbkMsQ0FBQyxHQUFXLElBQUksQ0FBQyxJQUFJLENBQ3pCLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQ3REO1FBRUQsZ0VBQWdFO1FBQ2hFLElBQUksU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4QyxJQUFJLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEMsT0FBTyxDQUFDLENBQUM7SUFDWCxDQUFDOzs7OztJQUVNLG9DQUFhOzs7O0lBQXBCLFVBQXFCLFlBQXVCO1FBQzFDLElBQUksWUFBWSxJQUFJLElBQUksRUFBRTtZQUN4QixPQUFPO1NBQ1I7O1lBQ0csS0FBSyxHQUFHLENBQUM7UUFDYixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUN2RCxJQUFJLFlBQVksQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtnQkFDckQsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3JELEtBQUssR0FBRyxDQUFDLENBQUM7YUFDWDtTQUNGO1FBQ0QsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDdEIsQ0FBQzs7Ozs7SUFFTSxpQ0FBVTs7OztJQUFqQixVQUFrQixZQUF1Qjs7O1lBQ25DLE9BQU8sR0FBRyxLQUFLO1FBQ25CLHlDQUF5QztRQUN6QyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUN2RCxJQUNFLFlBQVksQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUU7Z0JBQ2pELElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLElBQUksSUFBSSxFQUM3Qzs7b0JBQ00sU0FBUyxHQUFjLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUM7O29CQUNqRCxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUN6QyxZQUFZLENBQUMsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsRUFDOUMsWUFBWSxDQUFDLENBQUMsR0FBRyxTQUFTLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQy9DO2dCQUNELFlBQVksQ0FBQyxDQUFDLEdBQUcsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO2dCQUNwQyxZQUFZLENBQUMsQ0FBQyxHQUFHLGdCQUFnQixDQUFDLENBQUMsQ0FBQztnQkFDcEMsSUFBSSxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLENBQUM7Z0JBQ3ZELElBQUksU0FBUyxDQUFDLFVBQVUsWUFBWSxZQUFZLEVBQUU7b0JBQ2hELElBQUksQ0FBQyxVQUFVLENBQ2IsWUFBWSxDQUFDLENBQUMsRUFDZCxZQUFZLENBQUMsQ0FBQyxFQUNkLG1CQUFBLFNBQVMsQ0FBQyxVQUFVLEVBQWdCLENBQ3JDLENBQUM7aUJBQ0g7cUJBQU07b0JBQ0wsSUFBSSxDQUFDLFVBQVUsQ0FDYixZQUFZLENBQUMsQ0FBQyxFQUNkLFlBQVksQ0FBQyxDQUFDLEVBQ2QsbUJBQUEsU0FBUyxDQUFDLFVBQVUsRUFBYyxDQUNuQyxDQUFDO2lCQUNIO2dCQUNELElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUM7Z0JBQ2pDLE9BQU8sR0FBRyxJQUFJLENBQUM7Z0JBQ2YsSUFBSSxDQUFDLHFCQUFxQixDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ25ELE1BQU07YUFDUDtTQUNGO1FBQ0QsSUFBSSxDQUFDLE9BQU8sRUFBRTs7Z0JBQ1osS0FBcUIsSUFBQSxLQUFBLGlCQUFBLElBQUksQ0FBQyxPQUFPLENBQUEsZ0JBQUEsNEJBQUU7b0JBQTlCLElBQU0sTUFBTSxXQUFBO29CQUNmLElBQUksTUFBTSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsQ0FBQyxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUMsRUFBRTt3QkFDeEQsWUFBWSxDQUFDLFVBQVUsR0FBRyxNQUFNLENBQUM7d0JBQ2pDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7d0JBQzNDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7d0JBQ3JCLFlBQVksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7NEJBQzlCLFlBQVksQ0FBQyxDQUFDLEdBQUcsWUFBWSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO3dCQUN0RCxZQUFZLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDOzRCQUM5QixZQUFZLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQzt3QkFDdEQsSUFBSSxDQUFDLFVBQVUsQ0FDYixZQUFZLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsRUFDakQsWUFBWSxDQUFDLENBQUMsR0FBRyxZQUFZLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQ2pELG1CQUFBLFlBQVksQ0FBQyxVQUFVLEVBQWdCLENBQ3hDLENBQUM7d0JBQ0YsTUFBTTtxQkFDUDtpQkFDRjs7Ozs7Ozs7O1lBQ0QsSUFDRSxZQUFZLENBQUMsVUFBVSxLQUFLLElBQUk7Z0JBQ2hDLE9BQU8sWUFBWSxDQUFDLFVBQVUsS0FBSyxXQUFXLEVBQzlDO2dCQUNBLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLENBQUMsRUFBRSxZQUFZLENBQUMsQ0FBQyxDQUFDLEVBQUU7b0JBQzdELFlBQVksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztvQkFDdEMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztvQkFDM0MsWUFBWSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ3RDLFlBQVksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7d0JBQzlCLFlBQVksQ0FBQyxDQUFDLEdBQUcsWUFBWSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO29CQUN0RCxZQUFZLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO3dCQUM5QixZQUFZLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztvQkFDdEQsSUFBSSxDQUFDLFVBQVUsQ0FDYixZQUFZLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsRUFDakQsWUFBWSxDQUFDLENBQUMsR0FBRyxZQUFZLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQ2pELG1CQUFBLFlBQVksQ0FBQyxVQUFVLEVBQWMsQ0FDdEMsQ0FBQztpQkFDSDthQUNGO1NBQ0Y7SUFDSCxDQUFDOzs7O0lBRU0sd0NBQWlCOzs7SUFBeEI7O1lBQ1EsWUFBWSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSzs7WUFDekQsWUFBWSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSzs7WUFDdkQsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSzs7WUFDckIsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTTtRQUMxQixJQUFJLFlBQVksR0FBRyxZQUFZLEVBQUU7WUFDL0IsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO1lBQ3RCLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxZQUFZLENBQUM7U0FDdEM7YUFBTTtZQUNMLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQztZQUN2QixDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsWUFBWSxDQUFDO1NBQ3ZDO1FBQ0QsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMvQyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2hELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDL0MsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNsRCxDQUFDOzs7O0lBRU0sb0NBQWE7OztJQUFwQjs7WUFDUSxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRTtRQUMvQixNQUFNLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDckUsTUFBTSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzNFLE1BQU0sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN2RSxNQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDekUsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQzs7Ozs7O0lBRU0sb0NBQWE7Ozs7O0lBQXBCLFVBQXFCLENBQVMsRUFBRSxDQUFTO1FBQ3ZDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDdEIsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7U0FDcEI7UUFDRCxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ3RCLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1NBQ3BCO1FBQ0QsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUN0QixDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQztTQUNwQjtRQUNELElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDdEIsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7U0FDcEI7UUFDRCxPQUFPLElBQUksU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDL0MsQ0FBQzs7OztJQUVNLGlDQUFVOzs7SUFBakI7UUFDRSxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDdkIsQ0FBQzs7Ozs7SUFFTSwrQkFBUTs7OztJQUFmLFVBQWdCLEdBQVE7UUFDdEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUM7UUFDcEIsSUFBSSxDQUFDLEdBQUcsRUFBRTtZQUNSLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO1lBQ3RCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQ3JCO2FBQU07WUFDTCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztZQUNyQixJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7O2dCQUMxRCxhQUFhLEdBQUcsbUJBQUEsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQzFDLElBQUksQ0FDTCxFQUE0QjtZQUM3QixhQUFhLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUVyRSxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLEVBQUU7Z0JBQ2xDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUNsRDtZQUVELElBQUksSUFBSSxDQUFDLGVBQWUsQ0FBQywyQkFBMkIsRUFBRTtnQkFDcEQsSUFBSSxDQUFDLFFBQVE7b0JBQ1gsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQzt3QkFDbkQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUM7Z0JBQ3RCLElBQUksQ0FBQyxTQUFTO29CQUNaLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUM7d0JBQ3JELElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDO2FBQ3hCO1lBRUQsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDekIsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztZQUNyQyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDOztnQkFFakMsWUFBWSxHQUFZLElBQUksQ0FBQywwQkFBMEIsRUFBRTtZQUMvRCxJQUFJLENBQUMsZUFBZSxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQ3BDO0lBQ0gsQ0FBQzs7Ozs7SUFFTSx5Q0FBa0I7Ozs7SUFBekIsVUFBMEIsVUFBa0I7O1lBQ3BDLFlBQVksR0FBWSxJQUFJLENBQUMseUJBQXlCLENBQUMsVUFBVSxDQUFDO1FBQ3hFLElBQUksQ0FBQyxlQUFlLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDckMsQ0FBQzs7Ozs7O0lBRU8sc0NBQWU7Ozs7O0lBQXZCLFVBQXdCLFlBQXFCOztRQUMzQyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxRCxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxRCxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxRCxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxRCxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzs7WUFFOUQsS0FBdUIsSUFBQSxpQkFBQSxpQkFBQSxZQUFZLENBQUEsMENBQUEsb0VBQUU7Z0JBQWhDLElBQU0sUUFBUSx5QkFBQTtnQkFDakIsSUFBSSxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQ2hEOzs7Ozs7Ozs7UUFFRCxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDaEUsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDcEIsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQzVDLEtBQUssRUFDTCxJQUFJLENBQUMsU0FBUyxFQUNkLElBQUksQ0FBQyxVQUFVLENBQ2hCLENBQUM7SUFDSixDQUFDOzs7OztJQUVPLGlEQUEwQjs7OztJQUFsQzs7WUFDUSxDQUFDLEdBQVcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLOztZQUM3QixDQUFDLEdBQVcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNOztZQUNoQyxLQUFZOztZQUNaLEtBQVk7O1lBQ1osS0FBWTs7WUFDWixLQUFZOztZQUNaLE1BQWE7O1lBQ1gsWUFBWSxHQUFXLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSzs7WUFDakUsVUFBVSxHQUFXLElBQUksQ0FBQyxTQUFTLEVBQUU7O1lBQ3JDLFVBQVUsR0FBVyxVQUFVLENBQUMsTUFBTSxHQUFHLFVBQVUsQ0FBQyxLQUFLOztZQUN6RCxFQUFFLEdBQVcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsQ0FBQzs7WUFDbEMsRUFBRSxHQUFXLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUM7UUFFekMsSUFBSSxVQUFVLEdBQUcsWUFBWSxFQUFFOztnQkFDdkIsTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLFlBQVksRUFBRSxDQUFDLENBQUM7O2dCQUN0QyxLQUFLLEdBQUcsTUFBTSxHQUFHLFVBQVU7WUFDakMsS0FBSyxHQUFHLElBQUksU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEdBQUcsS0FBSyxHQUFHLENBQUMsRUFBRSxFQUFFLEdBQUcsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3pFLEtBQUssR0FBRyxJQUFJLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxHQUFHLEtBQUssR0FBRyxDQUFDLEVBQUUsRUFBRSxHQUFHLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztZQUN6RSxLQUFLLEdBQUcsSUFBSSxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsR0FBRyxLQUFLLEdBQUcsQ0FBQyxFQUFFLEVBQUUsR0FBRyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDekUsS0FBSyxHQUFHLElBQUksU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEdBQUcsS0FBSyxHQUFHLENBQUMsRUFBRSxFQUFFLEdBQUcsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1NBQzFFO2FBQU07O2dCQUNDLE1BQU0sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxZQUFZLEVBQUUsQ0FBQyxDQUFDOztnQkFDdEMsS0FBSyxHQUFHLE1BQU0sR0FBRyxVQUFVO1lBQ2pDLEtBQUssR0FBRyxJQUFJLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxHQUFHLE1BQU0sR0FBRyxDQUFDLEVBQUUsRUFBRSxHQUFHLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztZQUN6RSxLQUFLLEdBQUcsSUFBSSxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsR0FBRyxNQUFNLEdBQUcsQ0FBQyxFQUFFLEVBQUUsR0FBRyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDekUsS0FBSyxHQUFHLElBQUksU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEdBQUcsTUFBTSxHQUFHLENBQUMsRUFBRSxFQUFFLEdBQUcsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3pFLEtBQUssR0FBRyxJQUFJLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxHQUFHLE1B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ViwwQ0FBMEM7UUFDMUMsd0VBQXdFO1FBQ3hFLCtFQUErRTtRQUMvRSwyR0FBMkc7UUFDM0cseUNBQXlDO1FBQ3pDLEdBQUcsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNyRCxDQUFDOzs7OztJQUVNLGtDQUFXOzs7O0lBQWxCLFVBQW1CLEtBQWlCO1FBQ2xDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsRUFBRTtZQUMxQixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztTQUN6QjtJQUNILENBQUM7Ozs7O0lBRU0sZ0NBQVM7Ozs7SUFBaEIsVUFBaUIsS0FBaUI7UUFDaEMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxFQUFFO1lBQzFCLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3BELElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO1lBQ3pCLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQzVDO0lBQ0gsQ0FBQztJQUNILG1CQUFDO0FBQUQsQ0FBQyxBQXg0Q0QsQ0FBa0MsaUJBQWlCLEdBdzRDbEQ7Ozs7Ozs7SUF2NENDLDRCQUEyQjs7Ozs7SUFDM0IsdUNBQXlDOzs7OztJQUN6Qyx3Q0FBaUM7Ozs7O0lBQ2pDLDZDQUFxRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJvdW5kcyB9IGZyb20gJy4vbW9kZWwvYm91bmRzJztcclxuaW1wb3J0IHsgQ29ybmVyTWFya2VyIH0gZnJvbSAnLi9tb2RlbC9jb3JuZXJNYXJrZXInO1xyXG5pbXBvcnQgeyBDcm9wVG91Y2ggfSBmcm9tICcuL21vZGVsL2Nyb3BUb3VjaCc7XHJcbmltcG9ydCB7IENyb3BwZXJTZXR0aW5ncyB9IGZyb20gJy4vY3JvcHBlci1zZXR0aW5ncyc7XHJcbmltcG9ydCB7IERyYWdNYXJrZXIgfSBmcm9tICcuL21vZGVsL2RyYWdNYXJrZXInO1xyXG5pbXBvcnQgeyBJbWFnZUNyb3BwZXJNb2RlbCB9IGZyb20gJy4vbW9kZWwvaW1hZ2VDcm9wcGVyTW9kZWwnO1xyXG5pbXBvcnQgeyBJbWFnZUNyb3BwZXJEYXRhU2hhcmUgfSBmcm9tICcuL2ltYWdlQ3JvcHBlckRhdGFTaGFyZSc7XHJcbmltcG9ydCB7IFBvaW50UG9vbCB9IGZyb20gJy4vbW9kZWwvcG9pbnRQb29sJztcclxuaW1wb3J0IHsgUG9pbnQgfSBmcm9tICcuL21vZGVsL3BvaW50JztcclxuaW1wb3J0IHsgSUNvcm5lck1hcmtlciB9IGZyb20gJy4vbW9kZWwvY29ybmVyTWFya2VyJztcclxuXHJcbmV4cG9ydCBjbGFzcyBJbWFnZUNyb3BwZXIgZXh0ZW5kcyBJbWFnZUNyb3BwZXJNb2RlbCB7XHJcbiAgcHJpdmF0ZSBjcm9wOiBJbWFnZUNyb3BwZXI7XHJcbiAgcHJpdmF0ZSBjcm9wcGVyU2V0dGluZ3M6IENyb3BwZXJTZXR0aW5ncztcclxuICBwcml2YXRlIHByZXZpb3VzRGlzdGFuY2U6IG51bWJlcjtcclxuICBwcml2YXRlIGltYWdlQ3JvcHBlckRhdGFTaGFyZTogSW1hZ2VDcm9wcGVyRGF0YVNoYXJlO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihjcm9wcGVyU2V0dGluZ3M6IENyb3BwZXJTZXR0aW5ncykge1xyXG4gICAgc3VwZXIoKTtcclxuICAgIHRoaXMuaW1hZ2VDcm9wcGVyRGF0YVNoYXJlID0gbmV3IEltYWdlQ3JvcHBlckRhdGFTaGFyZSgpO1xyXG4gICAgY29uc3QgeCA9IDA7XHJcbiAgICBjb25zdCB5ID0gMDtcclxuICAgIGNvbnN0IHdpZHRoOiBudW1iZXIgPSBjcm9wcGVyU2V0dGluZ3Mud2lkdGg7XHJcbiAgICBjb25zdCBoZWlnaHQ6IG51bWJlciA9IGNyb3BwZXJTZXR0aW5ncy5oZWlnaHQ7XHJcbiAgICBjb25zdCBrZWVwQXNwZWN0OiBib29sZWFuID0gY3JvcHBlclNldHRpbmdzLmtlZXBBc3BlY3Q7XHJcbiAgICBjb25zdCB0b3VjaFJhZGl1czogbnVtYmVyID0gY3JvcHBlclNldHRpbmdzLnRvdWNoUmFkaXVzO1xyXG4gICAgY29uc3QgY2VudGVyVG91Y2hSYWRpdXM6IG51bWJlciA9IGNyb3BwZXJTZXR0aW5ncy5jZW50ZXJUb3VjaFJhZGl1cztcclxuICAgIGNvbnN0IG1pbldpZHRoOiBudW1iZXIgPSBjcm9wcGVyU2V0dGluZ3MubWluV2lkdGg7XHJcbiAgICBjb25zdCBtaW5IZWlnaHQ6IG51bWJlciA9IGNyb3BwZXJTZXR0aW5ncy5taW5IZWlnaHQ7XHJcbiAgICBjb25zdCBjcm9wcGVkV2lkdGg6IG51bWJlciA9IGNyb3BwZXJTZXR0aW5ncy5jcm9wcGVkV2lkdGg7XHJcbiAgICBjb25zdCBjcm9wcGVkSGVpZ2h0OiBudW1iZXIgPSBjcm9wcGVyU2V0dGluZ3MuY3JvcHBlZEhlaWdodDtcclxuXHJcbiAgICB0aGlzLmNyb3BwZXJTZXR0aW5ncyA9IGNyb3BwZXJTZXR0aW5ncztcclxuXHJcbiAgICB0aGlzLmNyb3AgPSB0aGlzO1xyXG4gICAgdGhpcy54ID0geDtcclxuICAgIHRoaXMueSA9IHk7XHJcblxyXG4gICAgdGhpcy5jYW52YXNIZWlnaHQgPSBjcm9wcGVyU2V0dGluZ3MuY2FudmFzSGVpZ2h0O1xyXG4gICAgdGhpcy5jYW52YXNXaWR0aCA9IGNyb3BwZXJTZXR0aW5ncy5jYW52YXNXaWR0aDtcclxuXHJcbiAgICB0aGlzLndpZHRoID0gd2lkdGg7XHJcbiAgICBpZiAod2lkdGggPT09IHZvaWQgMCkge1xyXG4gICAgICB0aGlzLndpZHRoID0gMTAwO1xyXG4gICAgfVxyXG4gICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XHJcbiAgICBpZiAoaGVpZ2h0ID09PSB2b2lkIDApIHtcclxuICAgICAgdGhpcy5oZWlnaHQgPSA1MDtcclxuICAgIH1cclxuICAgIHRoaXMua2VlcEFzcGVjdCA9IGtlZXBBc3BlY3Q7XHJcbiAgICBpZiAoa2VlcEFzcGVjdCA9PT0gdm9pZCAwKSB7XHJcbiAgICAgIHRoaXMua2VlcEFzcGVjdCA9IHRydWU7XHJcbiAgICB9XHJcbiAgICB0aGlzLnRvdWNoUmFkaXVzID0gdG91Y2hSYWRpdXM7XHJcbiAgICBpZiAodG91Y2hSYWRpdXMgPT09IHZvaWQgMCkge1xyXG4gICAgICB0aGlzLnRvdWNoUmFkaXVzID0gMjA7XHJcbiAgICB9XHJcbiAgICB0aGlzLm1pbldpZHRoID0gbWluV2lkdGg7XHJcbiAgICB0aGlzLm1pbkhlaWdodCA9IG1pbkhlaWdodDtcclxuICAgIHRoaXMuYXNwZWN0UmF0aW8gPSAwO1xyXG4gICAgdGhpcy5jdXJyZW50RHJhZ1RvdWNoZXMgPSBbXTtcclxuICAgIHRoaXMuaXNNb3VzZURvd24gPSBmYWxzZTtcclxuICAgIHRoaXMucmF0aW9XID0gMTtcclxuICAgIHRoaXMucmF0aW9IID0gMTtcclxuICAgIHRoaXMuZmlsZVR5cGUgPSBjcm9wcGVyU2V0dGluZ3MuZmlsZVR5cGU7XHJcbiAgICB0aGlzLmltYWdlU2V0ID0gZmFsc2U7XHJcbiAgICB0aGlzLnBvaW50UG9vbCA9IG5ldyBQb2ludFBvb2woMjAwKTtcclxuXHJcbiAgICB0aGlzLnRsID0gbmV3IENvcm5lck1hcmtlcih4LCB5LCB0b3VjaFJhZGl1cywgdGhpcy5jcm9wcGVyU2V0dGluZ3MpO1xyXG4gICAgdGhpcy50ciA9IG5ldyBDb3JuZXJNYXJrZXIoeCArIHdpZHRoLCB5LCB0b3VjaFJhZGl1cywgdGhpcy5jcm9wcGVyU2V0dGluZ3MpO1xyXG4gICAgdGhpcy5ibCA9IG5ldyBDb3JuZXJNYXJrZXIoXHJcbiAgICAgIHgsXHJcbiAgICAgIHkgKyBoZWlnaHQsXHJcbiAgICAgIHRvdWNoUmFkaXVzLFxyXG4gICAgICB0aGlzLmNyb3BwZXJTZXR0aW5nc1xyXG4gICAgKTtcclxuICAgIHRoaXMuYnIgPSBuZXcgQ29ybmVyTWFya2VyKFxyXG4gICAgICB4ICsgd2lkdGgsXHJcbiAgICAgIHkgKyBoZWlnaHQsXHJcbiAgICAgIHRvdWNoUmFkaXVzLFxyXG4gICAgICB0aGlzLmNyb3BwZXJTZXR0aW5nc1xyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLnRsLmFkZEhvcml6b250YWxOZWlnaGJvdXIodGhpcy50cik7XHJcbiAgICB0aGlzLnRsLmFkZFZlcnRpY2FsTmVpZ2hib3VyKHRoaXMuYmwpO1xyXG4gICAgdGhpcy50ci5hZGRIb3Jpem9udGFsTmVpZ2hib3VyKHRoaXMudGwpO1xyXG4gICAgdGhpcy50ci5hZGRWZXJ0aWNhbE5laWdoYm91cih0aGlzLmJyKTtcclxuICAgIHRoaXMuYmwuYWRkSG9yaXpvbnRhbE5laWdoYm91cih0aGlzLmJyKTtcclxuICAgIHRoaXMuYmwuYWRkVmVydGljYWxOZWlnaGJvdXIodGhpcy50bCk7XHJcbiAgICB0aGlzLmJyLmFkZEhvcml6b250YWxOZWlnaGJvdXIodGhpcy5ibCk7XHJcbiAgICB0aGlzLmJyLmFkZFZlcnRpY2FsTmVpZ2hib3VyKHRoaXMudHIpO1xyXG4gICAgdGhpcy5tYXJrZXJzID0gW3RoaXMudGwsIHRoaXMudHIsIHRoaXMuYmwsIHRoaXMuYnJdO1xyXG5cclxuICAgIHRoaXMuY2VudGVyID0gbmV3IERyYWdNYXJrZXIoXHJcbiAgICAgIHggKyB3aWR0aCAvIDIsXHJcbiAgICAgIHkgKyBoZWlnaHQgLyAyLFxyXG4gICAgICBjZW50ZXJUb3VjaFJhZGl1cyxcclxuICAgICAgdGhpcy5jcm9wcGVyU2V0dGluZ3NcclxuICAgICk7XHJcbiAgICB0aGlzLmFzcGVjdFJhdGlvID0gaGVpZ2h0IC8gd2lkdGg7XHJcbiAgICB0aGlzLmNyb3BwZWRJbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgdGhpcy5jdXJyZW50bHlJbnRlcmFjdGluZyA9IGZhbHNlO1xyXG4gICAgdGhpcy5jcm9wV2lkdGggPSBjcm9wcGVkV2lkdGg7XHJcbiAgICB0aGlzLmNyb3BIZWlnaHQgPSBjcm9wcGVkSGVpZ2h0O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzaWduKHg6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICBpZiAoK3ggPT09IHgpIHtcclxuICAgICAgcmV0dXJuIHggPT09IDAgPyB4IDogeCA+IDAgPyAxIDogLTE7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gTmFOO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRNb3VzZVBvcyhjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50LCBldnQ6IE1vdXNlRXZlbnQpOiBQb2ludCB7XHJcbiAgICBjb25zdCByZWN0ID0gY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgcmV0dXJuIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coXHJcbiAgICAgIGV2dC5jbGllbnRYIC0gcmVjdC5sZWZ0LFxyXG4gICAgICBldnQuY2xpZW50WSAtIHJlY3QudG9wXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRUb3VjaFBvcyhjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50LCB0b3VjaDogVG91Y2gpOiBQb2ludCB7XHJcbiAgICBjb25zdCByZWN0ID0gY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgcmV0dXJuIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coXHJcbiAgICAgIHRvdWNoLmNsaWVudFggLSByZWN0LmxlZnQsXHJcbiAgICAgIHRvdWNoLmNsaWVudFkgLSByZWN0LnRvcFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZGV0ZWN0VmVydGljYWxTcXVhc2goXHJcbiAgICBpbWc6IEhUTUxJbWFnZUVsZW1lbnQgfCBIVE1MQ2FudmFzRWxlbWVudCB8IEhUTUxWaWRlb0VsZW1lbnRcclxuICApIHtcclxuICAgIGNvbnN0IGloID0gaW1nLmhlaWdodDtcclxuICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG4gICAgY2FudmFzLndpZHRoID0gMTtcclxuICAgIGNhbnZhcy5oZWlnaHQgPSBpaDtcclxuICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpIGFzIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcclxuICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwKTtcclxuICAgIGNvbnN0IGltYWdlRGF0YTogYW55ID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCAxLCBpaCk7XHJcbiAgICBpZiAoaW1hZ2VEYXRhKSB7XHJcbiAgICAgIGNvbnN0IGRhdGEgPSBpbWFnZURhdGEuZGF0YTtcclxuICAgICAgLy8gc2VhcmNoIGltYWdlIGVkZ2UgcGl4ZWwgcG9zaXRpb24gaW4gY2FzZSBpdCBpcyBzcXVhc2hlZCB2ZXJ0aWNhbGx5LlxyXG4gICAgICBsZXQgc3kgPSAwO1xyXG4gICAgICBsZXQgZXkgPSBpaDtcclxuICAgICAgbGV0IHB5ID0gaWg7XHJcbiAgICAgIHdoaWxlIChweSA+IHN5KSB7XHJcbiAgICAgICAgY29uc3QgYWxwaGEgPSBkYXRhWyhweSAtIDEpICogNCArIDNdO1xyXG4gICAgICAgIGlmIChhbHBoYSA9PT0gMCkge1xyXG4gICAgICAgICAgZXkgPSBweTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgc3kgPSBweTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWJpdHdpc2VcclxuICAgICAgICBweSA9IChleSArIHN5KSA+PiAxO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IHJhdGlvID0gcHkgLyBpaDtcclxuICAgICAgcmV0dXJuIHJhdGlvID09PSAwID8gMSA6IHJhdGlvO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIDE7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldERhdGFVcmlNaW1lVHlwZShkYXRhVXJpOiBzdHJpbmcpIHtcclxuICAgIC8vIEdldCBhIHN1YnN0cmluZyBiZWNhdXNlIHRoZSByZWdleCBkb2VzIG5vdCBwZXJmb3JtIHdlbGwgb24gdmVyeSBsYXJnZSBzdHJpbmdzLlxyXG4gICAgLy8gQ2F0ZXIgZm9yIG9wdGlvbmFsIGNoYXJzZXQuIExlbmd0aCA1MCBzaG9vdWxkIGJlIGVub3VnaC5cclxuICAgIGNvbnN0IGRhdGFVcmlTdWJzdHJpbmcgPSBkYXRhVXJpLnN1YnN0cmluZygwLCA1MCk7XHJcbiAgICBsZXQgbWltZVR5cGUgPSAnaW1hZ2UvcG5nJztcclxuICAgIC8vIGRhdGEtdXJpIHNjaGVtZVxyXG4gICAgLy8gZGF0YTpbPG1lZGlhIHR5cGU+XVs7Y2hhcnNldD08Y2hhcmFjdGVyIHNldD5dWztiYXNlNjRdLDxkYXRhPlxyXG4gICAgY29uc3QgcmVnRXggPSBSZWdFeHAoXHJcbiAgICAgIC9eKGRhdGE6KShbXFx3XFwvXFwrXSspOyhjaGFyc2V0PVtcXHctXSt8YmFzZTY0KS4qLCguKikvZ2lcclxuICAgICk7XHJcbiAgICBjb25zdCBtYXRjaGVzID0gcmVnRXguZXhlYyhkYXRhVXJpU3Vic3RyaW5nKTtcclxuICAgIGlmIChtYXRjaGVzICYmIG1hdGNoZXNbMl0pIHtcclxuICAgICAgbWltZVR5cGUgPSBtYXRjaGVzWzJdO1xyXG4gICAgICBpZiAobWltZVR5cGUgPT09ICdpbWFnZS9qcGcnKSB7XHJcbiAgICAgICAgbWltZVR5cGUgPSAnaW1hZ2UvanBlZyc7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBtaW1lVHlwZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBwcmVwYXJlKGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQpIHtcclxuICAgIHRoaXMuYnVmZmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XHJcbiAgICB0aGlzLmNyb3BDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcclxuXHJcbiAgICAvLyB0b2RvIGdldCBtb3JlIHJlbGlhYmxlIHBhcmVudCB3aWR0aCB2YWx1ZS5cclxuICAgIGNvbnN0IHJlc3BvbnNpdmVXaWR0aDogbnVtYmVyID0gY2FudmFzLnBhcmVudEVsZW1lbnRcclxuICAgICAgPyBjYW52YXMucGFyZW50RWxlbWVudC5jbGllbnRXaWR0aFxyXG4gICAgICA6IDA7XHJcbiAgICBpZiAocmVzcG9uc2l2ZVdpZHRoID4gMCAmJiB0aGlzLmNyb3BwZXJTZXR0aW5ncy5keW5hbWljU2l6aW5nKSB7XHJcbiAgICAgIHRoaXMuY3JvcENhbnZhcy53aWR0aCA9IHJlc3BvbnNpdmVXaWR0aDtcclxuICAgICAgdGhpcy5idWZmZXIud2lkdGggPSByZXNwb25zaXZlV2lkdGg7XHJcbiAgICAgIGNhbnZhcy53aWR0aCA9IHJlc3BvbnNpdmVXaWR0aDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuY3JvcENhbnZhcy53aWR0aCA9IHRoaXMuY3JvcFdpZHRoO1xyXG4gICAgICB0aGlzLmJ1ZmZlci53aWR0aCA9IGNhbnZhcy53aWR0aDtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNyb3BDYW52YXMuaGVpZ2h0ID0gdGhpcy5jcm9wSGVpZ2h0O1xyXG4gICAgdGhpcy5idWZmZXIuaGVpZ2h0ID0gY2FudmFzLmhlaWdodDtcclxuICAgIHRoaXMuY2FudmFzID0gY2FudmFzO1xyXG4gICAgdGhpcy5jdHggPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpIGFzIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcclxuXHJcbiAgICB0aGlzLmRyYXcodGhpcy5jdHgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHVwZGF0ZVNldHRpbmdzKGNyb3BwZXJTZXR0aW5nczogQ3JvcHBlclNldHRpbmdzKSB7XHJcbiAgICB0aGlzLmNyb3BwZXJTZXR0aW5ncyA9IGNyb3BwZXJTZXR0aW5ncztcclxuICB9XHJcblxyXG4gIHB1YmxpYyByZXNpemVDYW52YXMoXHJcbiAgICB3aWR0aDogbnVtYmVyLFxyXG4gICAgaGVpZ2h0OiBudW1iZXIsXHJcbiAgICBzZXRJbWFnZTogYm9vbGVhbiA9IGZhbHNlXHJcbiAgKTogdm9pZCB7XHJcbiAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHRoaXMuY3JvcENhbnZhcy53aWR0aCA9IHRoaXMud2lkdGggPSB0aGlzLmNhbnZhc1dpZHRoID0gdGhpcy5idWZmZXIud2lkdGggPSB3aWR0aDtcclxuICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHRoaXMuY3JvcENhbnZhcy5oZWlnaHQgPSB0aGlzLmhlaWdodCA9IHRoaXMuY2FudmFzSGVpZ2h0ID0gdGhpcy5idWZmZXIuaGVpZ2h0ID0gaGVpZ2h0O1xyXG4gICAgaWYgKHNldEltYWdlKSB7XHJcbiAgICAgIHRoaXMuc2V0SW1hZ2UodGhpcy5zcmNJbWFnZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVzZXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLnNldEltYWdlKHVuZGVmaW5lZCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZHJhdyhjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCk6IHZvaWQge1xyXG4gICAgY29uc3QgYm91bmRzOiBCb3VuZHMgPSB0aGlzLmdldEJvdW5kcygpO1xyXG4gICAgaWYgKHRoaXMuc3JjSW1hZ2UpIHtcclxuICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmNhbnZhc1dpZHRoLCB0aGlzLmNhbnZhc0hlaWdodCk7XHJcbiAgICAgIGNvbnN0IHNvdXJjZUFzcGVjdDogbnVtYmVyID0gdGhpcy5zcmNJbWFnZS5oZWlnaHQgLyB0aGlzLnNyY0ltYWdlLndpZHRoO1xyXG4gICAgICBjb25zdCBjYW52YXNBc3BlY3Q6IG51bWJlciA9IHRoaXMuY2FudmFzSGVpZ2h0IC8gdGhpcy5jYW52YXNXaWR0aDtcclxuICAgICAgbGV0IHc6IG51bWJlciA9IHRoaXMuY2FudmFzV2lkdGg7XHJcbiAgICAgIGxldCBoOiBudW1iZXIgPSB0aGlzLmNhbnZhc0hlaWdodDtcclxuICAgICAgaWYgKGNhbnZhc0FzcGVjdCA+IHNvdXJjZUFzcGVjdCkge1xyXG4gICAgICAgIHcgPSB0aGlzLmNhbnZhc1dpZHRoO1xyXG4gICAgICAgIGggPSB0aGlzLmNhbnZhc1dpZHRoICogc291cmNlQXNwZWN0O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGggPSB0aGlzLmNhbnZhc0hlaWdodDtcclxuICAgICAgICB3ID0gdGhpcy5jYW52YXNIZWlnaHQgLyBzb3VyY2VBc3BlY3Q7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5yYXRpb1cgPSB3IC8gdGhpcy5zcmNJbWFnZS53aWR0aDtcclxuICAgICAgdGhpcy5yYXRpb0ggPSBoIC8gdGhpcy5zcmNJbWFnZS5oZWlnaHQ7XHJcbiAgICAgIGlmIChjYW52YXNBc3BlY3QgPCBzb3VyY2VBc3BlY3QpIHtcclxuICAgICAgICB0aGlzLmRyYXdJbWFnZUlPU0ZpeChcclxuICAgICAgICAgIGN0eCxcclxuICAgICAgICAgIHRoaXMuc3JjSW1hZ2UsXHJcbiAgICAgICAgICAwLFxyXG4gICAgICAgICAgMCxcclxuICAgICAgICAgIHRoaXMuc3JjSW1hZ2Uud2lkdGgsXHJcbiAgICAgICAgICB0aGlzLnNyY0ltYWdlLmhlaWdodCxcclxuICAgICAgICAgIHRoaXMuYnVmZmVyLndpZHRoIC8gMiAtIHcgLyAyLFxyXG4gICAgICAgICAgMCxcclxuICAgICAgICAgIHcsXHJcbiAgICAgICAgICBoXHJcbiAgICAgICAgKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmRyYXdJbWFnZUlPU0ZpeChcclxuICAgICAgICAgIGN0eCxcclxuICAgICAgICAgIHRoaXMuc3JjSW1hZ2UsXHJcbiAgICAgICAgICAwLFxyXG4gICAgICAgICAgMCxcclxuICAgICAgICAgIHRoaXMuc3JjSW1hZ2Uud2lkdGgsXHJcbiAgICAgICAgICB0aGlzLnNyY0ltYWdlLmhlaWdodCxcclxuICAgICAgICAgIDAsXHJcbiAgICAgICAgICB0aGlzLmJ1ZmZlci5oZWlnaHQgLyAyIC0gaCAvIDIsXHJcbiAgICAgICAgICB3LFxyXG4gICAgICAgICAgaFxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICAgKHRoaXMuYnVmZmVyLmdldENvbnRleHQoJzJkJykgYXMgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKS5kcmF3SW1hZ2UoXHJcbiAgICAgICAgdGhpcy5jYW52YXMsXHJcbiAgICAgICAgMCxcclxuICAgICAgICAwLFxyXG4gICAgICAgIHRoaXMuY2FudmFzV2lkdGgsXHJcbiAgICAgICAgdGhpcy5jYW52YXNIZWlnaHRcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGN0eC5saW5lV2lkdGggPSB0aGlzLmNyb3BwZXJTZXR0aW5ncy5jcm9wcGVyRHJhd1NldHRpbmdzLnN0cm9rZVdpZHRoO1xyXG4gICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmNyb3BwZXJTZXR0aW5ncy5jcm9wcGVyRHJhd1NldHRpbmdzLnN0cm9rZUNvbG9yO1xyXG5cclxuICAgICAgY3R4LmZpbGxTdHlsZSA9IHRoaXMuY3JvcHBlclNldHRpbmdzLmNyb3BwZXJEcmF3U2V0dGluZ3MuYmFja2dyb3VuZEZpbGxDb2xvcjtcclxuICAgICAgaWYgKCF0aGlzLmNyb3BwZXJTZXR0aW5ncy5yb3VuZGVkKSB7XHJcbiAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIHRoaXMuY2FudmFzV2lkdGgsIHRoaXMuY2FudmFzSGVpZ2h0KTtcclxuICAgICAgICBjdHguZHJhd0ltYWdlKFxyXG4gICAgICAgICAgdGhpcy5idWZmZXIsXHJcbiAgICAgICAgICBib3VuZHMubGVmdCxcclxuICAgICAgICAgIGJvdW5kcy50b3AsXHJcbiAgICAgICAgICBNYXRoLm1heChib3VuZHMud2lkdGgsIDEpLFxyXG4gICAgICAgICAgTWF0aC5tYXgoYm91bmRzLmhlaWdodCwgMSksXHJcbiAgICAgICAgICBib3VuZHMubGVmdCxcclxuICAgICAgICAgIGJvdW5kcy50b3AsXHJcbiAgICAgICAgICBib3VuZHMud2lkdGgsXHJcbiAgICAgICAgICBib3VuZHMuaGVpZ2h0XHJcbiAgICAgICAgKTtcclxuICAgICAgICBjdHguc3Ryb2tlUmVjdChib3VuZHMubGVmdCwgYm91bmRzLnRvcCwgYm91bmRzLndpZHRoLCBib3VuZHMuaGVpZ2h0KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XHJcbiAgICAgICAgY3R4LnNhdmUoKTtcclxuICAgICAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgY3R4LmFyYyhcclxuICAgICAgICAgIGJvdW5kcy5sZWZ0ICsgYm91bmRzLndpZHRoIC8gMixcclxuICAgICAgICAgIGJvdW5kcy50b3AgKyBib3VuZHMuaGVpZ2h0IC8gMixcclxuICAgICAgICAgIGJvdW5kcy53aWR0aCAvIDIsXHJcbiAgICAgICAgICAwLFxyXG4gICAgICAgICAgMiAqIE1hdGguUElcclxuICAgICAgICApO1xyXG4gICAgICAgIGN0eC5zdHJva2UoKTtcclxuICAgICAgICBjdHguY2xpcCgpO1xyXG4gICAgICAgIGlmIChjYW52YXNBc3BlY3QgPCBzb3VyY2VBc3BlY3QpIHtcclxuICAgICAgICAgIHRoaXMuZHJhd0ltYWdlSU9TRml4KFxyXG4gICAgICAgICAgICBjdHgsXHJcbiAgICAgICAgICAgIHRoaXMuc3JjSW1hZ2UsXHJcbiAgICAgICAgICAgIDAsXHJcbiAgICAgICAgICAgIDAsXHJcbiAgICAgICAgICAgIHRoaXMuc3JjSW1hZ2Uud2lkdGgsXHJcbiAgICAgICAgICAgIHRoaXMuc3JjSW1hZ2UuaGVpZ2h0LFxyXG4gICAgICAgICAgICB0aGlzLmJ1ZmZlci53aWR0aCAvIDIgLSB3IC8gMixcclxuICAgICAgICAgICAgMCxcclxuICAgICAgICAgICAgdyxcclxuICAgICAgICAgICAgaFxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5kcmF3SW1hZ2VJT1NGaXgoXHJcbiAgICAgICAgICAgIGN0eCxcclxuICAgICAgICAgICAgdGhpcy5zcmNJbWFnZSxcclxuICAgICAgICAgICAgMCxcclxuICAgICAgICAgICAgMCxcclxuICAgICAgICAgICAgdGhpcy5zcmNJbWFnZS53aWR0aCxcclxuICAgICAgICAgICAgdGhpcy5zcmNJbWFnZS5oZWlnaHQsXHJcbiAgICAgICAgICAgIDAsXHJcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyLmhlaWdodCAvIDIgLSBoIC8gMixcclxuICAgICAgICAgICAgdyxcclxuICAgICAgICAgICAgaFxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY3R4LnJlc3RvcmUoKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgbGV0IG1hcmtlcjogQ29ybmVyTWFya2VyO1xyXG5cclxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnByZWZlci1mb3Itb2ZcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm1hcmtlcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBtYXJrZXIgPSB0aGlzLm1hcmtlcnNbaV07XHJcbiAgICAgICAgbWFya2VyLmRyYXcoY3R4KTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmNlbnRlci5kcmF3KGN0eCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoMTkyLDE5MiwxOTIsMSknO1xyXG4gICAgICBjdHguZmlsbFJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZHJhZ0NlbnRlcih4OiBudW1iZXIsIHk6IG51bWJlciwgbWFya2VyOiBEcmFnTWFya2VyKSB7XHJcbiAgICBjb25zdCBib3VuZHMgPSB0aGlzLmdldEJvdW5kcygpO1xyXG4gICAgY29uc3QgbGVmdCA9IHggLSBib3VuZHMud2lkdGggLyAyO1xyXG4gICAgY29uc3QgcmlnaHQgPSB4ICsgYm91bmRzLndpZHRoIC8gMjtcclxuICAgIGNvbnN0IHRvcCA9IHkgLSBib3VuZHMuaGVpZ2h0IC8gMjtcclxuICAgIGNvbnN0IGJvdHRvbSA9IHkgKyBib3VuZHMuaGVpZ2h0IC8gMjtcclxuICAgIGlmIChyaWdodCA+PSB0aGlzLm1heFhDbGFtcCkge1xyXG4gICAgICB4ID0gdGhpcy5tYXhYQ2xhbXAgLSBib3VuZHMud2lkdGggLyAyO1xyXG4gICAgfVxyXG4gICAgaWYgKGxlZnQgPD0gdGhpcy5taW5YQ2xhbXApIHtcclxuICAgICAgeCA9IGJvdW5kcy53aWR0aCAvIDIgKyB0aGlzLm1pblhDbGFtcDtcclxuICAgIH1cclxuICAgIGlmICh0b3AgPCB0aGlzLm1pbllDbGFtcCkge1xyXG4gICAgICB5ID0gYm91bmRzLmhlaWdodCAvIDIgKyB0aGlzLm1pbllDbGFtcDtcclxuICAgIH1cclxuICAgIGlmIChib3R0b20gPj0gdGhpcy5tYXhZQ2xhbXApIHtcclxuICAgICAgeSA9IHRoaXMubWF4WUNsYW1wIC0gYm91bmRzLmhlaWdodCAvIDI7XHJcbiAgICB9XHJcbiAgICB0aGlzLnRsLm1vdmVYKHggLSBib3VuZHMud2lkdGggLyAyKTtcclxuICAgIHRoaXMudGwubW92ZVkoeSAtIGJvdW5kcy5oZWlnaHQgLyAyKTtcclxuICAgIHRoaXMudHIubW92ZVgoeCArIGJvdW5kcy53aWR0aCAvIDIpO1xyXG4gICAgdGhpcy50ci5tb3ZlWSh5IC0gYm91bmRzLmhlaWdodCAvIDIpO1xyXG4gICAgdGhpcy5ibC5tb3ZlWCh4IC0gYm91bmRzLndpZHRoIC8gMik7XHJcbiAgICB0aGlzLmJsLm1vdmVZKHkgKyBib3VuZHMuaGVpZ2h0IC8gMik7XHJcbiAgICB0aGlzLmJyLm1vdmVYKHggKyBib3VuZHMud2lkdGggLyAyKTtcclxuICAgIHRoaXMuYnIubW92ZVkoeSArIGJvdW5kcy5oZWlnaHQgLyAyKTtcclxuICAgIG1hcmtlci5zZXRQb3NpdGlvbih4LCB5KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBlbmZvcmNlTWluU2l6ZSh4OiBudW1iZXIsIHk6IG51bWJlciwgbWFya2VyOiBDb3JuZXJNYXJrZXIpIHtcclxuICAgIGNvbnN0IHhMZW5ndGggPSB4IC0gbWFya2VyLmdldEhvcml6b250YWxOZWlnaGJvdXIoKS5wb3NpdGlvbi54O1xyXG4gICAgY29uc3QgeUxlbmd0aCA9IHkgLSBtYXJrZXIuZ2V0VmVydGljYWxOZWlnaGJvdXIoKS5wb3NpdGlvbi55O1xyXG4gICAgY29uc3QgeE92ZXIgPSB0aGlzLm1pbldpZHRoIC0gTWF0aC5hYnMoeExlbmd0aCk7XHJcbiAgICBjb25zdCB5T3ZlciA9IHRoaXMubWluSGVpZ2h0IC0gTWF0aC5hYnMoeUxlbmd0aCk7XHJcblxyXG4gICAgaWYgKHhMZW5ndGggPT09IDAgfHwgeUxlbmd0aCA9PT0gMCkge1xyXG4gICAgICB4ID0gbWFya2VyLnBvc2l0aW9uLng7XHJcbiAgICAgIHkgPSBtYXJrZXIucG9zaXRpb24ueTtcclxuXHJcbiAgICAgIHJldHVybiBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KHgsIHkpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmtlZXBBc3BlY3QpIHtcclxuICAgICAgaWYgKHhPdmVyID4gMCAmJiB5T3ZlciAvIHRoaXMuYXNwZWN0UmF0aW8gPiAwKSB7XHJcbiAgICAgICAgaWYgKHhPdmVyID4geU92ZXIgLyB0aGlzLmFzcGVjdFJhdGlvKSB7XHJcbiAgICAgICAgICBpZiAoeExlbmd0aCA8IDApIHtcclxuICAgICAgICAgICAgeCAtPSB4T3ZlcjtcclxuXHJcbiAgICAgICAgICAgIGlmICh5TGVuZ3RoIDwgMCkge1xyXG4gICAgICAgICAgICAgIHkgLT0geE92ZXIgKiB0aGlzLmFzcGVjdFJhdGlvO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIHkgKz0geE92ZXIgKiB0aGlzLmFzcGVjdFJhdGlvO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB4ICs9IHhPdmVyO1xyXG4gICAgICAgICAgICBpZiAoeUxlbmd0aCA8IDApIHtcclxuICAgICAgICAgICAgICB5IC09IHhPdmVyICogdGhpcy5hc3BlY3RSYXRpbztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICB5ICs9IHhPdmVyICogdGhpcy5hc3BlY3RSYXRpbztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpZiAoeUxlbmd0aCA8IDApIHtcclxuICAgICAgICAgICAgeSAtPSB5T3ZlcjtcclxuXHJcbiAgICAgICAgICAgIGlmICh4TGVuZ3RoIDwgMCkge1xyXG4gICAgICAgICAgICAgIHggLT0geU92ZXIgLyB0aGlzLmFzcGVjdFJhdGlvO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIHggKz0geU92ZXIgLyB0aGlzLmFzcGVjdFJhdGlvO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB5ICs9IHlPdmVyO1xyXG4gICAgICAgICAgICBpZiAoeExlbmd0aCA8IDApIHtcclxuICAgICAgICAgICAgICB4IC09IHlPdmVyIC8gdGhpcy5hc3BlY3RSYXRpbztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICB4ICs9IHlPdmVyIC8gdGhpcy5hc3BlY3RSYXRpbztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpZiAoeE92ZXIgPiAwKSB7XHJcbiAgICAgICAgICBpZiAoeExlbmd0aCA8IDApIHtcclxuICAgICAgICAgICAgeCAtPSB4T3ZlcjtcclxuICAgICAgICAgICAgaWYgKHlMZW5ndGggPCAwKSB7XHJcbiAgICAgICAgICAgICAgeSAtPSB4T3ZlciAqIHRoaXMuYXNwZWN0UmF0aW87XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgeSArPSB4T3ZlciAqIHRoaXMuYXNwZWN0UmF0aW87XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHggKz0geE92ZXI7XHJcbiAgICAgICAgICAgIGlmICh5TGVuZ3RoIDwgMCkge1xyXG4gICAgICAgICAgICAgIHkgLT0geE92ZXIgKiB0aGlzLmFzcGVjdFJhdGlvO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIHkgKz0geE92ZXIgKiB0aGlzLmFzcGVjdFJhdGlvO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGlmICh5T3ZlciA+IDApIHtcclxuICAgICAgICAgICAgaWYgKHlMZW5ndGggPCAwKSB7XHJcbiAgICAgICAgICAgICAgeSAtPSB5T3ZlcjtcclxuXHJcbiAgICAgICAgICAgICAgaWYgKHhMZW5ndGggPCAwKSB7XHJcbiAgICAgICAgICAgICAgICB4IC09IHlPdmVyIC8gdGhpcy5hc3BlY3RSYXRpbztcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgeCArPSB5T3ZlciAvIHRoaXMuYXNwZWN0UmF0aW87XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIHkgKz0geU92ZXI7XHJcbiAgICAgICAgICAgICAgaWYgKHhMZW5ndGggPCAwKSB7XHJcbiAgICAgICAgICAgICAgICB4IC09IHlPdmVyIC8gdGhpcy5hc3BlY3RSYXRpbztcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgeCArPSB5T3ZlciAvIHRoaXMuYXNwZWN0UmF0aW87XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAoeE92ZXIgPiAwKSB7XHJcbiAgICAgICAgaWYgKHhMZW5ndGggPCAwKSB7XHJcbiAgICAgICAgICB4IC09IHhPdmVyO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB4ICs9IHhPdmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBpZiAoeU92ZXIgPiAwKSB7XHJcbiAgICAgICAgaWYgKHlMZW5ndGggPCAwKSB7XHJcbiAgICAgICAgICB5IC09IHlPdmVyO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB5ICs9IHlPdmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChcclxuICAgICAgeCA8IHRoaXMubWluWENsYW1wIHx8XHJcbiAgICAgIHggPiB0aGlzLm1heFhDbGFtcCB8fFxyXG4gICAgICB5IDwgdGhpcy5taW5ZQ2xhbXAgfHxcclxuICAgICAgeSA+IHRoaXMubWF4WUNsYW1wXHJcbiAgICApIHtcclxuICAgICAgeCA9IG1hcmtlci5wb3NpdGlvbi54O1xyXG4gICAgICB5ID0gbWFya2VyLnBvc2l0aW9uLnk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coeCwgeSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZHJhZ0Nvcm5lcih4OiBudW1iZXIsIHk6IG51bWJlciwgbWFya2VyOiBDb3JuZXJNYXJrZXIpIHtcclxuICAgIGxldCBpWCA9IDA7XHJcbiAgICBsZXQgaVkgPSAwO1xyXG4gICAgbGV0IGF4ID0gMDtcclxuICAgIGxldCBheSA9IDA7XHJcbiAgICBsZXQgbmV3SGVpZ2h0ID0gMDtcclxuICAgIGxldCBuZXdXaWR0aCA9IDA7XHJcbiAgICBsZXQgbmV3WSA9IDA7XHJcbiAgICBsZXQgbmV3WCA9IDA7XHJcbiAgICBsZXQgYW5jaG9yTWFya2VyOiBDb3JuZXJNYXJrZXI7XHJcbiAgICBsZXQgZm9sZCA9IDA7XHJcblxyXG4gICAgaWYgKHRoaXMua2VlcEFzcGVjdCkge1xyXG4gICAgICBhbmNob3JNYXJrZXIgPSBtYXJrZXIuZ2V0SG9yaXpvbnRhbE5laWdoYm91cigpLmdldFZlcnRpY2FsTmVpZ2hib3VyKCk7XHJcbiAgICAgIGF4ID0gYW5jaG9yTWFya2VyLnBvc2l0aW9uLng7XHJcbiAgICAgIGF5ID0gYW5jaG9yTWFya2VyLnBvc2l0aW9uLnk7XHJcbiAgICAgIGlmICh4IDw9IGFuY2hvck1hcmtlci5wb3NpdGlvbi54KSB7XHJcbiAgICAgICAgaWYgKHkgPD0gYW5jaG9yTWFya2VyLnBvc2l0aW9uLnkpIHtcclxuICAgICAgICAgIGlYID0gYXggLSAxMDAgLyB0aGlzLmFzcGVjdFJhdGlvO1xyXG4gICAgICAgICAgaVkgPSBheSAtICgxMDAgLyB0aGlzLmFzcGVjdFJhdGlvKSAqIHRoaXMuYXNwZWN0UmF0aW87XHJcbiAgICAgICAgICBmb2xkID0gdGhpcy5nZXRTaWRlKFxyXG4gICAgICAgICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KGlYLCBpWSksXHJcbiAgICAgICAgICAgIGFuY2hvck1hcmtlci5wb3NpdGlvbixcclxuICAgICAgICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyh4LCB5KVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICAgIGlmIChmb2xkID4gMCkge1xyXG4gICAgICAgICAgICBuZXdIZWlnaHQgPSBNYXRoLmFicyhhbmNob3JNYXJrZXIucG9zaXRpb24ueSAtIHkpO1xyXG4gICAgICAgICAgICBuZXdXaWR0aCA9IG5ld0hlaWdodCAvIHRoaXMuYXNwZWN0UmF0aW87XHJcbiAgICAgICAgICAgIG5ld1kgPSBhbmNob3JNYXJrZXIucG9zaXRpb24ueSAtIG5ld0hlaWdodDtcclxuICAgICAgICAgICAgbmV3WCA9IGFuY2hvck1hcmtlci5wb3NpdGlvbi54IC0gbmV3V2lkdGg7XHJcbiAgICAgICAgICAgIGNvbnN0IG1pbiA9IHRoaXMuZW5mb3JjZU1pblNpemUobmV3WCwgbmV3WSwgbWFya2VyKTtcclxuICAgICAgICAgICAgbWFya2VyLm1vdmUobWluLngsIG1pbi55KTtcclxuICAgICAgICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLnJldHVyblBvaW50KG1pbik7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoZm9sZCA8IDApIHtcclxuICAgICAgICAgICAgICBuZXdXaWR0aCA9IE1hdGguYWJzKGFuY2hvck1hcmtlci5wb3NpdGlvbi54IC0geCk7XHJcbiAgICAgICAgICAgICAgbmV3SGVpZ2h0ID0gbmV3V2lkdGggKiB0aGlzLmFzcGVjdFJhdGlvO1xyXG4gICAgICAgICAgICAgIG5ld1kgPSBhbmNob3JNYXJrZXIucG9zaXRpb24ueSAtIG5ld0hlaWdodDtcclxuICAgICAgICAgICAgICBuZXdYID0gYW5jaG9yTWFya2VyLnBvc2l0aW9uLnggLSBuZXdXaWR0aDtcclxuICAgICAgICAgICAgICBjb25zdCBtaW4gPSB0aGlzLmVuZm9yY2VNaW5TaXplKG5ld1gsIG5ld1ksIG1hcmtlcik7XHJcbiAgICAgICAgICAgICAgbWFya2VyLm1vdmUobWluLngsIG1pbi55KTtcclxuICAgICAgICAgICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UucmV0dXJuUG9pbnQobWluKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpWCA9IGF4IC0gMTAwIC8gdGhpcy5hc3BlY3RSYXRpbztcclxuICAgICAgICAgIGlZID0gYXkgKyAoMTAwIC8gdGhpcy5hc3BlY3RSYXRpbykgKiB0aGlzLmFzcGVjdFJhdGlvO1xyXG4gICAgICAgICAgZm9sZCA9IHRoaXMuZ2V0U2lkZShcclxuICAgICAgICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhpWCwgaVkpLFxyXG4gICAgICAgICAgICBhbmNob3JNYXJrZXIucG9zaXRpb24sXHJcbiAgICAgICAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coeCwgeSlcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICBpZiAoZm9sZCA+IDApIHtcclxuICAgICAgICAgICAgbmV3V2lkdGggPSBNYXRoLmFicyhhbmNob3JNYXJrZXIucG9zaXRpb24ueCAtIHgpO1xyXG4gICAgICAgICAgICBuZXdIZWlnaHQgPSBuZXdXaWR0aCAqIHRoaXMuYXNwZWN0UmF0aW87XHJcbiAgICAgICAgICAgIG5ld1kgPSBhbmNob3JNYXJrZXIucG9zaXRpb24ueSArIG5ld0hlaWdodDtcclxuICAgICAgICAgICAgbmV3WCA9IGFuY2hvck1hcmtlci5wb3NpdGlvbi54IC0gbmV3V2lkdGg7XHJcbiAgICAgICAgICAgIGNvbnN0IG1pbiA9IHRoaXMuZW5mb3JjZU1pblNpemUobmV3WCwgbmV3WSwgbWFya2VyKTtcclxuICAgICAgICAgICAgbWFya2VyLm1vdmUobWluLngsIG1pbi55KTtcclxuICAgICAgICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLnJldHVyblBvaW50KG1pbik7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoZm9sZCA8IDApIHtcclxuICAgICAgICAgICAgICBuZXdIZWlnaHQgPSBNYXRoLmFicyhhbmNob3JNYXJrZXIucG9zaXRpb24ueSAtIHkpO1xyXG4gICAgICAgICAgICAgIG5ld1dpZHRoID0gbmV3SGVpZ2h0IC8gdGhpcy5hc3BlY3RSYXRpbztcclxuICAgICAgICAgICAgICBuZXdZID0gYW5jaG9yTWFya2VyLnBvc2l0aW9uLnkgKyBuZXdIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgbmV3WCA9IGFuY2hvck1hcmtlci5wb3NpdGlvbi54IC0gbmV3V2lkdGg7XHJcbiAgICAgICAgICAgICAgY29uc3QgbWluID0gdGhpcy5lbmZvcmNlTWluU2l6ZShuZXdYLCBuZXdZLCBtYXJrZXIpO1xyXG4gICAgICAgICAgICAgIG1hcmtlci5tb3ZlKG1pbi54LCBtaW4ueSk7XHJcbiAgICAgICAgICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLnJldHVyblBvaW50KG1pbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKHkgPD0gYW5jaG9yTWFya2VyLnBvc2l0aW9uLnkpIHtcclxuICAgICAgICAgIGlYID0gYXggKyAxMDAgLyB0aGlzLmFzcGVjdFJhdGlvO1xyXG4gICAgICAgICAgaVkgPSBheSAtICgxMDAgLyB0aGlzLmFzcGVjdFJhdGlvKSAqIHRoaXMuYXNwZWN0UmF0aW87XHJcbiAgICAgICAgICBmb2xkID0gdGhpcy5nZXRTaWRlKFxyXG4gICAgICAgICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KGlYLCBpWSksXHJcbiAgICAgICAgICAgIGFuY2hvck1hcmtlci5wb3NpdGlvbixcclxuICAgICAgICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyh4LCB5KVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICAgIGlmIChmb2xkIDwgMCkge1xyXG4gICAgICAgICAgICBuZXdIZWlnaHQgPSBNYXRoLmFicyhhbmNob3JNYXJrZXIucG9zaXRpb24ueSAtIHkpO1xyXG4gICAgICAgICAgICBuZXdXaWR0aCA9IG5ld0hlaWdodCAvIHRoaXMuYXNwZWN0UmF0aW87XHJcbiAgICAgICAgICAgIG5ld1kgPSBhbmNob3JNYXJrZXIucG9zaXRpb24ueSAtIG5ld0hlaWdodDtcclxuICAgICAgICAgICAgbmV3WCA9IGFuY2hvck1hcmtlci5wb3NpdGlvbi54ICsgbmV3V2lkdGg7XHJcbiAgICAgICAgICAgIGNvbnN0IG1pbiA9IHRoaXMuZW5mb3JjZU1pblNpemUobmV3WCwgbmV3WSwgbWFya2VyKTtcclxuICAgICAgICAgICAgbWFya2VyLm1vdmUobWluLngsIG1pbi55KTtcclxuICAgICAgICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLnJldHVyblBvaW50KG1pbik7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoZm9sZCA+IDApIHtcclxuICAgICAgICAgICAgICBuZXdXaWR0aCA9IE1hdGguYWJzKGFuY2hvck1hcmtlci5wb3NpdGlvbi54IC0geCk7XHJcbiAgICAgICAgICAgICAgbmV3SGVpZ2h0ID0gbmV3V2lkdGggKiB0aGlzLmFzcGVjdFJhdGlvO1xyXG4gICAgICAgICAgICAgIG5ld1kgPSBhbmNob3JNYXJrZXIucG9zaXRpb24ueSAtIG5ld0hlaWdodDtcclxuICAgICAgICAgICAgICBuZXdYID0gYW5jaG9yTWFya2VyLnBvc2l0aW9uLnggKyBuZXdXaWR0aDtcclxuICAgICAgICAgICAgICBjb25zdCBtaW4gPSB0aGlzLmVuZm9yY2VNaW5TaXplKG5ld1gsIG5ld1ksIG1hcmtlcik7XHJcbiAgICAgICAgICAgICAgbWFya2VyLm1vdmUobWluLngsIG1pbi55KTtcclxuICAgICAgICAgICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UucmV0dXJuUG9pbnQobWluKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpWCA9IGF4ICsgMTAwIC8gdGhpcy5hc3BlY3RSYXRpbztcclxuICAgICAgICAgIGlZID0gYXkgKyAoMTAwIC8gdGhpcy5hc3BlY3RSYXRpbykgKiB0aGlzLmFzcGVjdFJhdGlvO1xyXG4gICAgICAgICAgZm9sZCA9IHRoaXMuZ2V0U2lkZShcclxuICAgICAgICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhpWCwgaVkpLFxyXG4gICAgICAgICAgICBhbmNob3JNYXJrZXIucG9zaXRpb24sXHJcbiAgICAgICAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coeCwgeSlcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICBpZiAoZm9sZCA8IDApIHtcclxuICAgICAgICAgICAgbmV3V2lkdGggPSBNYXRoLmFicyhhbmNob3JNYXJrZXIucG9zaXRpb24ueCAtIHgpO1xyXG4gICAgICAgICAgICBuZXdIZWlnaHQgPSBuZXdXaWR0aCAqIHRoaXMuYXNwZWN0UmF0aW87XHJcbiAgICAgICAgICAgIG5ld1kgPSBhbmNob3JNYXJrZXIucG9zaXRpb24ueSArIG5ld0hlaWdodDtcclxuICAgICAgICAgICAgbmV3WCA9IGFuY2hvck1hcmtlci5wb3NpdGlvbi54ICsgbmV3V2lkdGg7XHJcbiAgICAgICAgICAgIGNvbnN0IG1pbiA9IHRoaXMuZW5mb3JjZU1pblNpemUobmV3WCwgbmV3WSwgbWFya2VyKTtcclxuICAgICAgICAgICAgbWFya2VyLm1vdmUobWluLngsIG1pbi55KTtcclxuICAgICAgICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLnJldHVyblBvaW50KG1pbik7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoZm9sZCA+IDApIHtcclxuICAgICAgICAgICAgICBuZXdIZWlnaHQgPSBNYXRoLmFicyhhbmNob3JNYXJrZXIucG9zaXRpb24ueSAtIHkpO1xyXG4gICAgICAgICAgICAgIG5ld1dpZHRoID0gbmV3SGVpZ2h0IC8gdGhpcy5hc3BlY3RSYXRpbztcclxuICAgICAgICAgICAgICBuZXdZID0gYW5jaG9yTWFya2VyLnBvc2l0aW9uLnkgKyBuZXdIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgbmV3WCA9IGFuY2hvck1hcmtlci5wb3NpdGlvbi54ICsgbmV3V2lkdGg7XHJcbiAgICAgICAgICAgICAgY29uc3QgbWluID0gdGhpcy5lbmZvcmNlTWluU2l6ZShuZXdYLCBuZXdZLCBtYXJrZXIpO1xyXG4gICAgICAgICAgICAgIG1hcmtlci5tb3ZlKG1pbi54LCBtaW4ueSk7XHJcbiAgICAgICAgICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLnJldHVyblBvaW50KG1pbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IG1pbiA9IHRoaXMuZW5mb3JjZU1pblNpemUoeCwgeSwgbWFya2VyKTtcclxuICAgICAgbWFya2VyLm1vdmUobWluLngsIG1pbi55KTtcclxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLnJldHVyblBvaW50KG1pbik7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNlbnRlci5yZWNhbGN1bGF0ZVBvc2l0aW9uKHRoaXMuZ2V0Qm91bmRzKCkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFNpZGUoYTogUG9pbnQsIGI6IFBvaW50LCBjOiBQb2ludCk6IG51bWJlciB7XHJcbiAgICBjb25zdCBuOiBudW1iZXIgPSB0aGlzLnNpZ24oXHJcbiAgICAgIChiLnggLSBhLngpICogKGMueSAtIGEueSkgLSAoYi55IC0gYS55KSAqIChjLnggLSBhLngpXHJcbiAgICApO1xyXG5cclxuICAgIC8vIFRPRE8gbW92ZSB0aGUgcmV0dXJuIG9mIHRoZSBwb29scyB0byBvdXRzaWRlIG9mIHRoaXMgZnVuY3Rpb25cclxuICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5yZXR1cm5Qb2ludChhKTtcclxuICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5yZXR1cm5Qb2ludChjKTtcclxuICAgIHJldHVybiBuO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGhhbmRsZVJlbGVhc2UobmV3Q3JvcFRvdWNoOiBDcm9wVG91Y2gpIHtcclxuICAgIGlmIChuZXdDcm9wVG91Y2ggPT0gbnVsbCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsZXQgaW5kZXggPSAwO1xyXG4gICAgZm9yIChsZXQgayA9IDA7IGsgPCB0aGlzLmN1cnJlbnREcmFnVG91Y2hlcy5sZW5ndGg7IGsrKykge1xyXG4gICAgICBpZiAobmV3Q3JvcFRvdWNoLmlkID09PSB0aGlzLmN1cnJlbnREcmFnVG91Y2hlc1trXS5pZCkge1xyXG4gICAgICAgIHRoaXMuY3VycmVudERyYWdUb3VjaGVzW2tdLmRyYWdIYW5kbGUuc2V0RHJhZyhmYWxzZSk7XHJcbiAgICAgICAgaW5kZXggPSBrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmN1cnJlbnREcmFnVG91Y2hlcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgdGhpcy5kcmF3KHRoaXMuY3R4KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBoYW5kbGVNb3ZlKG5ld0Nyb3BUb3VjaDogQ3JvcFRvdWNoKSB7XHJcbiAgICBsZXQgbWF0Y2hlZCA9IGZhbHNlO1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnByZWZlci1mb3Itb2ZcclxuICAgIGZvciAobGV0IGsgPSAwOyBrIDwgdGhpcy5jdXJyZW50RHJhZ1RvdWNoZXMubGVuZ3RoOyBrKyspIHtcclxuICAgICAgaWYgKFxyXG4gICAgICAgIG5ld0Nyb3BUb3VjaC5pZCA9PT0gdGhpcy5jdXJyZW50RHJhZ1RvdWNoZXNba10uaWQgJiZcclxuICAgICAgICB0aGlzLmN1cnJlbnREcmFnVG91Y2hlc1trXS5kcmFnSGFuZGxlICE9IG51bGxcclxuICAgICAgKSB7XHJcbiAgICAgICAgY29uc3QgZHJhZ1RvdWNoOiBDcm9wVG91Y2ggPSB0aGlzLmN1cnJlbnREcmFnVG91Y2hlc1trXTtcclxuICAgICAgICBjb25zdCBjbGFtcGVkUG9zaXRpb25zID0gdGhpcy5jbGFtcFBvc2l0aW9uKFxyXG4gICAgICAgICAgbmV3Q3JvcFRvdWNoLnggLSBkcmFnVG91Y2guZHJhZ0hhbmRsZS5vZmZzZXQueCxcclxuICAgICAgICAgIG5ld0Nyb3BUb3VjaC55IC0gZHJhZ1RvdWNoLmRyYWdIYW5kbGUub2Zmc2V0LnlcclxuICAgICAgICApO1xyXG4gICAgICAgIG5ld0Nyb3BUb3VjaC54ID0gY2xhbXBlZFBvc2l0aW9ucy54O1xyXG4gICAgICAgIG5ld0Nyb3BUb3VjaC55ID0gY2xhbXBlZFBvc2l0aW9ucy55O1xyXG4gICAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5yZXR1cm5Qb2ludChjbGFtcGVkUG9zaXRpb25zKTtcclxuICAgICAgICBpZiAoZHJhZ1RvdWNoLmRyYWdIYW5kbGUgaW5zdGFuY2VvZiBDb3JuZXJNYXJrZXIpIHtcclxuICAgICAgICAgIHRoaXMuZHJhZ0Nvcm5lcihcclxuICAgICAgICAgICAgbmV3Q3JvcFRvdWNoLngsXHJcbiAgICAgICAgICAgIG5ld0Nyb3BUb3VjaC55LFxyXG4gICAgICAgICAgICBkcmFnVG91Y2guZHJhZ0hhbmRsZSBhcyBDb3JuZXJNYXJrZXJcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuZHJhZ0NlbnRlcihcclxuICAgICAgICAgICAgbmV3Q3JvcFRvdWNoLngsXHJcbiAgICAgICAgICAgIG5ld0Nyb3BUb3VjaC55LFxyXG4gICAgICAgICAgICBkcmFnVG91Y2guZHJhZ0hhbmRsZSBhcyBEcmFnTWFya2VyXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmN1cnJlbnRseUludGVyYWN0aW5nID0gdHJ1ZTtcclxuICAgICAgICBtYXRjaGVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmltYWdlQ3JvcHBlckRhdGFTaGFyZS5zZXRQcmVzc2VkKHRoaXMuY2FudmFzKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKCFtYXRjaGVkKSB7XHJcbiAgICAgIGZvciAoY29uc3QgbWFya2VyIG9mIHRoaXMubWFya2Vycykge1xyXG4gICAgICAgIGlmIChtYXJrZXIudG91Y2hJbkJvdW5kcyhuZXdDcm9wVG91Y2gueCwgbmV3Q3JvcFRvdWNoLnkpKSB7XHJcbiAgICAgICAgICBuZXdDcm9wVG91Y2guZHJhZ0hhbmRsZSA9IG1hcmtlcjtcclxuICAgICAgICAgIHRoaXMuY3VycmVudERyYWdUb3VjaGVzLnB1c2gobmV3Q3JvcFRvdWNoKTtcclxuICAgICAgICAgIG1hcmtlci5zZXREcmFnKHRydWUpO1xyXG4gICAgICAgICAgbmV3Q3JvcFRvdWNoLmRyYWdIYW5kbGUub2Zmc2V0LnggPVxyXG4gICAgICAgICAgICBuZXdDcm9wVG91Y2gueCAtIG5ld0Nyb3BUb3VjaC5kcmFnSGFuZGxlLnBvc2l0aW9uLng7XHJcbiAgICAgICAgICBuZXdDcm9wVG91Y2guZHJhZ0hhbmRsZS5vZmZzZXQueSA9XHJcbiAgICAgICAgICAgIG5ld0Nyb3BUb3VjaC55IC0gbmV3Q3JvcFRvdWNoLmRyYWdIYW5kbGUucG9zaXRpb24ueTtcclxuICAgICAgICAgIHRoaXMuZHJhZ0Nvcm5lcihcclxuICAgICAgICAgICAgbmV3Q3JvcFRvdWNoLnggLSBuZXdDcm9wVG91Y2guZHJhZ0hhbmRsZS5vZmZzZXQueCxcclxuICAgICAgICAgICAgbmV3Q3JvcFRvdWNoLnkgLSBuZXdDcm9wVG91Y2guZHJhZ0hhbmRsZS5vZmZzZXQueSxcclxuICAgICAgICAgICAgbmV3Q3JvcFRvdWNoLmRyYWdIYW5kbGUgYXMgQ29ybmVyTWFya2VyXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGlmIChcclxuICAgICAgICBuZXdDcm9wVG91Y2guZHJhZ0hhbmRsZSA9PT0gbnVsbCB8fFxyXG4gICAgICAgIHR5cGVvZiBuZXdDcm9wVG91Y2guZHJhZ0hhbmRsZSA9PT0gJ3VuZGVmaW5lZCdcclxuICAgICAgKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY2VudGVyLnRvdWNoSW5Cb3VuZHMobmV3Q3JvcFRvdWNoLngsIG5ld0Nyb3BUb3VjaC55KSkge1xyXG4gICAgICAgICAgbmV3Q3JvcFRvdWNoLmRyYWdIYW5kbGUgPSB0aGlzLmNlbnRlcjtcclxuICAgICAgICAgIHRoaXMuY3VycmVudERyYWdUb3VjaGVzLnB1c2gobmV3Q3JvcFRvdWNoKTtcclxuICAgICAgICAgIG5ld0Nyb3BUb3VjaC5kcmFnSGFuZGxlLnNldERyYWcodHJ1ZSk7XHJcbiAgICAgICAgICBuZXdDcm9wVG91Y2guZHJhZ0hhbmRsZS5vZmZzZXQueCA9XHJcbiAgICAgICAgICAgIG5ld0Nyb3BUb3VjaC54IC0gbmV3Q3JvcFRvdWNoLmRyYWdIYW5kbGUucG9zaXRpb24ueDtcclxuICAgICAgICAgIG5ld0Nyb3BUb3VjaC5kcmFnSGFuZGxlLm9mZnNldC55ID1cclxuICAgICAgICAgICAgbmV3Q3JvcFRvdWNoLnkgLSBuZXdDcm9wVG91Y2guZHJhZ0hhbmRsZS5wb3NpdGlvbi55O1xyXG4gICAgICAgICAgdGhpcy5kcmFnQ2VudGVyKFxyXG4gICAgICAgICAgICBuZXdDcm9wVG91Y2gueCAtIG5ld0Nyb3BUb3VjaC5kcmFnSGFuZGxlLm9mZnNldC54LFxyXG4gICAgICAgICAgICBuZXdDcm9wVG91Y2gueSAtIG5ld0Nyb3BUb3VjaC5kcmFnSGFuZGxlLm9mZnNldC55LFxyXG4gICAgICAgICAgICBuZXdDcm9wVG91Y2guZHJhZ0hhbmRsZSBhcyBEcmFnTWFya2VyXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIHVwZGF0ZUNsYW1wQm91bmRzKCkge1xyXG4gICAgY29uc3Qgc291cmNlQXNwZWN0ID0gdGhpcy5zcmNJbWFnZS5oZWlnaHQgLyB0aGlzLnNyY0ltYWdlLndpZHRoO1xyXG4gICAgY29uc3QgY2FudmFzQXNwZWN0ID0gdGhpcy5jYW52YXMuaGVpZ2h0IC8gdGhpcy5jYW52YXMud2lkdGg7XHJcbiAgICBsZXQgdyA9IHRoaXMuY2FudmFzLndpZHRoO1xyXG4gICAgbGV0IGggPSB0aGlzLmNhbnZhcy5oZWlnaHQ7XHJcbiAgICBpZiAoY2FudmFzQXNwZWN0ID4gc291cmNlQXNwZWN0KSB7XHJcbiAgICAgIHcgPSB0aGlzLmNhbnZhcy53aWR0aDtcclxuICAgICAgaCA9IHRoaXMuY2FudmFzLndpZHRoICogc291cmNlQXNwZWN0O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaCA9IHRoaXMuY2FudmFzLmhlaWdodDtcclxuICAgICAgdyA9IHRoaXMuY2FudmFzLmhlaWdodCAvIHNvdXJjZUFzcGVjdDtcclxuICAgIH1cclxuICAgIHRoaXMubWluWENsYW1wID0gdGhpcy5jYW52YXMud2lkdGggLyAyIC0gdyAvIDI7XHJcbiAgICB0aGlzLm1pbllDbGFtcCA9IHRoaXMuY2FudmFzLmhlaWdodCAvIDIgLSBoIC8gMjtcclxuICAgIHRoaXMubWF4WENsYW1wID0gdGhpcy5jYW52YXMud2lkdGggLyAyICsgdyAvIDI7XHJcbiAgICB0aGlzLm1heFlDbGFtcCA9IHRoaXMuY2FudmFzLmhlaWdodCAvIDIgKyBoIC8gMjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRDcm9wQm91bmRzKCkge1xyXG4gICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMoKTtcclxuICAgIGJvdW5kcy50b3AgPSBNYXRoLnJvdW5kKChib3VuZHMudG9wIC0gdGhpcy5taW5ZQ2xhbXApIC8gdGhpcy5yYXRpb0gpO1xyXG4gICAgYm91bmRzLmJvdHRvbSA9IE1hdGgucm91bmQoKGJvdW5kcy5ib3R0b20gLSB0aGlzLm1pbllDbGFtcCkgLyB0aGlzLnJhdGlvSCk7XHJcbiAgICBib3VuZHMubGVmdCA9IE1hdGgucm91bmQoKGJvdW5kcy5sZWZ0IC0gdGhpcy5taW5YQ2xhbXApIC8gdGhpcy5yYXRpb1cpO1xyXG4gICAgYm91bmRzLnJpZ2h0ID0gTWF0aC5yb3VuZCgoYm91bmRzLnJpZ2h0IC0gdGhpcy5taW5YQ2xhbXApIC8gdGhpcy5yYXRpb1cpO1xyXG4gICAgcmV0dXJuIGJvdW5kcztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjbGFtcFBvc2l0aW9uKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XHJcbiAgICBpZiAoeCA8IHRoaXMubWluWENsYW1wKSB7XHJcbiAgICAgIHggPSB0aGlzLm1pblhDbGFtcDtcclxuICAgIH1cclxuICAgIGlmICh4ID4gdGhpcy5tYXhYQ2xhbXApIHtcclxuICAgICAgeCA9IHRoaXMubWF4WENsYW1wO1xyXG4gICAgfVxyXG4gICAgaWYgKHkgPCB0aGlzLm1pbllDbGFtcCkge1xyXG4gICAgICB5ID0gdGhpcy5taW5ZQ2xhbXA7XHJcbiAgICB9XHJcbiAgICBpZiAoeSA+IHRoaXMubWF4WUNsYW1wKSB7XHJcbiAgICAgIHkgPSB0aGlzLm1heFlDbGFtcDtcclxuICAgIH1cclxuICAgIHJldHVybiBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KHgsIHkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGlzSW1hZ2VTZXQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5pbWFnZVNldDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXRJbWFnZShpbWc6IGFueSkge1xyXG4gICAgdGhpcy5zcmNJbWFnZSA9IGltZztcclxuICAgIGlmICghaW1nKSB7XHJcbiAgICAgIHRoaXMuaW1hZ2VTZXQgPSBmYWxzZTtcclxuICAgICAgdGhpcy5kcmF3KHRoaXMuY3R4KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuaW1hZ2VTZXQgPSB0cnVlO1xyXG4gICAgICB0aGlzLmN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XHJcbiAgICAgIGNvbnN0IGJ1ZmZlckNvbnRleHQgPSB0aGlzLmJ1ZmZlci5nZXRDb250ZXh0KFxyXG4gICAgICAgICcyZCdcclxuICAgICAgKSBhcyBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XHJcbiAgICAgIGJ1ZmZlckNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHRoaXMuYnVmZmVyLndpZHRoLCB0aGlzLmJ1ZmZlci5oZWlnaHQpO1xyXG5cclxuICAgICAgaWYgKCF0aGlzLmNyb3BwZXJTZXR0aW5ncy5maWxlVHlwZSkge1xyXG4gICAgICAgIHRoaXMuZmlsZVR5cGUgPSB0aGlzLmdldERhdGFVcmlNaW1lVHlwZShpbWcuc3JjKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHRoaXMuY3JvcHBlclNldHRpbmdzLm1pbldpdGhSZWxhdGl2ZVRvUmVzb2x1dGlvbikge1xyXG4gICAgICAgIHRoaXMubWluV2lkdGggPVxyXG4gICAgICAgICAgKHRoaXMuY2FudmFzLndpZHRoICogdGhpcy5jcm9wcGVyU2V0dGluZ3MubWluV2lkdGgpIC9cclxuICAgICAgICAgIHRoaXMuc3JjSW1hZ2Uud2lkdGg7XHJcbiAgICAgICAgdGhpcy5taW5IZWlnaHQgPVxyXG4gICAgICAgICAgKHRoaXMuY2FudmFzLmhlaWdodCAqIHRoaXMuY3JvcHBlclNldHRpbmdzLm1pbkhlaWdodCkgL1xyXG4gICAgICAgICAgdGhpcy5zcmNJbWFnZS5oZWlnaHQ7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMudXBkYXRlQ2xhbXBCb3VuZHMoKTtcclxuICAgICAgdGhpcy5jYW52YXNXaWR0aCA9IHRoaXMuY2FudmFzLndpZHRoO1xyXG4gICAgICB0aGlzLmNhbnZhc0hlaWdodCA9IHRoaXMuY2FudmFzLmhlaWdodDtcclxuXHJcbiAgICAgIGNvbnN0IGNyb3BQb3NpdGlvbjogUG9pbnRbXSA9IHRoaXMuZ2V0Q3JvcFBvc2l0aW9uRnJvbU1hcmtlcnMoKTtcclxuICAgICAgdGhpcy5zZXRDcm9wUG9zaXRpb24oY3JvcFBvc2l0aW9uKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyB1cGRhdGVDcm9wUG9zaXRpb24oY3JvcEJvdW5kczogQm91bmRzKTogdm9pZCB7XHJcbiAgICBjb25zdCBjcm9wUG9zaXRpb246IFBvaW50W10gPSB0aGlzLmdldENyb3BQb3NpdGlvbkZyb21Cb3VuZHMoY3JvcEJvdW5kcyk7XHJcbiAgICB0aGlzLnNldENyb3BQb3NpdGlvbihjcm9wUG9zaXRpb24pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXRDcm9wUG9zaXRpb24oY3JvcFBvc2l0aW9uOiBQb2ludFtdKTogdm9pZCB7XHJcbiAgICB0aGlzLnRsLnNldFBvc2l0aW9uKGNyb3BQb3NpdGlvblswXS54LCBjcm9wUG9zaXRpb25bMF0ueSk7XHJcbiAgICB0aGlzLnRyLnNldFBvc2l0aW9uKGNyb3BQb3NpdGlvblsxXS54LCBjcm9wUG9zaXRpb25bMV0ueSk7XHJcbiAgICB0aGlzLmJsLnNldFBvc2l0aW9uKGNyb3BQb3NpdGlvblsyXS54LCBjcm9wUG9zaXRpb25bMl0ueSk7XHJcbiAgICB0aGlzLmJyLnNldFBvc2l0aW9uKGNyb3BQb3NpdGlvblszXS54LCBjcm9wUG9zaXRpb25bM10ueSk7XHJcbiAgICB0aGlzLmNlbnRlci5zZXRQb3NpdGlvbihjcm9wUG9zaXRpb25bNF0ueCwgY3JvcFBvc2l0aW9uWzRdLnkpO1xyXG5cclxuICAgIGZvciAoY29uc3QgcG9zaXRpb24gb2YgY3JvcFBvc2l0aW9uKSB7XHJcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5yZXR1cm5Qb2ludChwb3NpdGlvbik7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy52ZXJ0U3F1YXNoUmF0aW8gPSB0aGlzLmRldGVjdFZlcnRpY2FsU3F1YXNoKHRoaXMuc3JjSW1hZ2UpO1xyXG4gICAgdGhpcy5kcmF3KHRoaXMuY3R4KTtcclxuICAgIHRoaXMuY3JvcHBlZEltYWdlID0gdGhpcy5nZXRDcm9wcGVkSW1hZ2VIZWxwZXIoXHJcbiAgICAgIGZhbHNlLFxyXG4gICAgICB0aGlzLmNyb3BXaWR0aCxcclxuICAgICAgdGhpcy5jcm9wSGVpZ2h0XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRDcm9wUG9zaXRpb25Gcm9tTWFya2VycygpOiBQb2ludFtdIHtcclxuICAgIGNvbnN0IHc6IG51bWJlciA9IHRoaXMuY2FudmFzLndpZHRoO1xyXG4gICAgY29uc3QgaDogbnVtYmVyID0gdGhpcy5jYW52YXMuaGVpZ2h0O1xyXG4gICAgbGV0IHRsUG9zOiBQb2ludDtcclxuICAgIGxldCB0clBvczogUG9pbnQ7XHJcbiAgICBsZXQgYmxQb3M6IFBvaW50O1xyXG4gICAgbGV0IGJyUG9zOiBQb2ludDtcclxuICAgIGxldCBjZW50ZXI6IFBvaW50O1xyXG4gICAgY29uc3Qgc291cmNlQXNwZWN0OiBudW1iZXIgPSB0aGlzLnNyY0ltYWdlLmhlaWdodCAvIHRoaXMuc3JjSW1hZ2Uud2lkdGg7XHJcbiAgICBjb25zdCBjcm9wQm91bmRzOiBCb3VuZHMgPSB0aGlzLmdldEJvdW5kcygpO1xyXG4gICAgY29uc3QgY3JvcEFzcGVjdDogbnVtYmVyID0gY3JvcEJvdW5kcy5oZWlnaHQgLyBjcm9wQm91bmRzLndpZHRoO1xyXG4gICAgY29uc3QgY1g6IG51bWJlciA9IHRoaXMuY2FudmFzLndpZHRoIC8gMjtcclxuICAgIGNvbnN0IGNZOiBudW1iZXIgPSB0aGlzLmNhbnZhcy5oZWlnaHQgLyAyO1xyXG5cclxuICAgIGlmIChjcm9wQXNwZWN0ID4gc291cmNlQXNwZWN0KSB7XHJcbiAgICAgIGNvbnN0IGltYWdlSCA9IE1hdGgubWluKHcgKiBzb3VyY2VBc3BlY3QsIGgpO1xyXG4gICAgICBjb25zdCBjcm9wVyA9IGltYWdlSCAvIGNyb3BBc3BlY3Q7XHJcbiAgICAgIHRsUG9zID0gbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhjWCAtIGNyb3BXIC8gMiwgY1kgKyBpbWFnZUggLyAyKTtcclxuICAgICAgdHJQb3MgPSBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KGNYICsgY3JvcFcgLyAyLCBjWSArIGltYWdlSCAvIDIpO1xyXG4gICAgICBibFBvcyA9IG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coY1ggLSBjcm9wVyAvIDIsIGNZIC0gaW1hZ2VIIC8gMik7XHJcbiAgICAgIGJyUG9zID0gbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhjWCArIGNyb3BXIC8gMiwgY1kgLSBpbWFnZUggLyAyKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGltYWdlVyA9IE1hdGgubWluKGggLyBzb3VyY2VBc3BlY3QsIHcpO1xyXG4gICAgICBjb25zdCBjcm9wSCA9IGltYWdlVyAqIGNyb3BBc3BlY3Q7XHJcbiAgICAgIHRsUG9zID0gbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhjWCAtIGltYWdlVyAvIDIsIGNZICsgY3JvcEggLyAyKTtcclxuICAgICAgdHJQb3MgPSBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KGNYICsgaW1hZ2VXIC8gMiwgY1kgKyBjcm9wSCAvIDIpO1xyXG4gICAgICBibFBvcyA9IG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coY1ggLSBpbWFnZVcgLyAyLCBjWSAtIGNyb3BIIC8gMik7XHJcbiAgICAgIGJyUG9zID0gbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhjWCArIGltYWdlVyAvIDIsIGNZIC0gY3JvcEggLyAyKTtcclxuICAgIH1cclxuXHJcbiAgICBjZW50ZXIgPSBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KGNYLCBjWSk7XHJcbiAgICBjb25zdCBwb3NpdGlvbnM6IFBvaW50W10gPSBbdGxQb3MsIHRyUG9zLCBibFBvcywgYnJQb3MsIGNlbnRlcl07XHJcbiAgICByZXR1cm4gcG9zaXRpb25zO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRDcm9wUG9zaXRpb25Gcm9tQm91bmRzKGNyb3BQb3NpdGlvbjogQm91bmRzKTogUG9pbnRbXSB7XHJcbiAgICBsZXQgbWFyZ2luVG9wID0gMDtcclxuICAgIGxldCBtYXJnaW5MZWZ0ID0gMDtcclxuICAgIGNvbnN0IGNhbnZhc0FzcGVjdDogbnVtYmVyID0gdGhpcy5jYW52YXNIZWlnaHQgLyB0aGlzLmNhbnZhc1dpZHRoO1xyXG4gICAgY29uc3Qgc291cmNlQXNwZWN0OiBudW1iZXIgPSB0aGlzLnNyY0ltYWdlLmhlaWdodCAvIHRoaXMuc3JjSW1hZ2Uud2lkdGg7XHJcblxyXG4gICAgaWYgKGNhbnZhc0FzcGVjdCA+IHNvdXJjZUFzcGVjdCkge1xyXG4gICAgICBtYXJnaW5Ub3AgPVxyXG4gICAgICAgIHRoaXMuYnVmZmVyLmhlaWdodCAvIDIgLSAodGhpcy5jYW52YXNXaWR0aCAqIHNvdXJjZUFzcGVjdCkgLyAyO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbWFyZ2luTGVmdCA9IHRoaXMuYnVmZmVyLndpZHRoIC8gMiAtIHRoaXMuY2FudmFzSGVpZ2h0IC8gc291cmNlQXNwZWN0IC8gMjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCByYXRpb1c6IG51bWJlciA9XHJcbiAgICAgICh0aGlzLmNhbnZhc1dpZHRoIC0gbWFyZ2luTGVmdCAqIDIpIC8gdGhpcy5zcmNJbWFnZS53aWR0aDtcclxuICAgIGNvbnN0IHJhdGlvSDogbnVtYmVyID1cclxuICAgICAgKHRoaXMuY2FudmFzSGVpZ2h0IC0gbWFyZ2luVG9wICogMikgLyB0aGlzLnNyY0ltYWdlLmhlaWdodDtcclxuXHJcbiAgICBsZXQgYWN0dWFsSDogbnVtYmVyID0gY3JvcFBvc2l0aW9uLmhlaWdodCAqIHJhdGlvSDtcclxuICAgIGxldCBhY3R1YWxXOiBudW1iZXIgPSBjcm9wUG9zaXRpb24ud2lkdGggKiByYXRpb1c7XHJcbiAgICBjb25zdCBhY3R1YWxYOiBudW1iZXIgPSBjcm9wUG9zaXRpb24ubGVmdCAqIHJhdGlvVyArIG1hcmdpbkxlZnQ7XHJcbiAgICBjb25zdCBhY3R1YWxZOiBudW1iZXIgPSBjcm9wUG9zaXRpb24udG9wICogcmF0aW9IICsgbWFyZ2luVG9wO1xyXG5cclxuICAgIGlmICh0aGlzLmtlZXBBc3BlY3QpIHtcclxuICAgICAgY29uc3Qgc2NhbGVkVzogbnVtYmVyID0gYWN0dWFsSCAvIHRoaXMuYXNwZWN0UmF0aW87XHJcbiAgICAgIGNvbnN0IHNjYWxlZEg6IG51bWJlciA9IGFjdHVhbFcgKiB0aGlzLmFzcGVjdFJhdGlvO1xyXG5cclxuICAgICAgaWYgKHRoaXMuZ2V0Q3JvcEJvdW5kcygpLmhlaWdodCA9PT0gY3JvcFBvc2l0aW9uLmhlaWdodCkge1xyXG4gICAgICAgIC8vIG9ubHkgd2lkdGggY2hhbmdlZFxyXG4gICAgICAgIGFjdHVhbEggPSBzY2FsZWRIO1xyXG4gICAgICB9IGVsc2UgaWYgKHRoaXMuZ2V0Q3JvcEJvdW5kcygpLndpZHRoID09PSBjcm9wUG9zaXRpb24ud2lkdGgpIHtcclxuICAgICAgICAvLyBvbmx5IGhlaWdodCBjaGFuZ2VkXHJcbiAgICAgICAgYWN0dWFsVyA9IHNjYWxlZFc7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gaGVpZ2h0IGFuZCB3aWR0aCBjaGFuZ2VkXHJcbiAgICAgICAgaWYgKE1hdGguYWJzKHNjYWxlZEggLSBhY3R1YWxIKSA8IE1hdGguYWJzKHNjYWxlZFcgLSBhY3R1YWxXKSkge1xyXG4gICAgICAgICAgYWN0dWFsVyA9IHNjYWxlZFc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGFjdHVhbEggPSBzY2FsZWRIO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRsUG9zOiBQb2ludCA9IG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coXHJcbiAgICAgIGFjdHVhbFgsXHJcbiAgICAgIGFjdHVhbFkgKyBhY3R1YWxIXHJcbiAgICApO1xyXG4gICAgY29uc3QgdHJQb3M6IFBvaW50ID0gbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhcclxuICAgICAgYWN0dWFsWCArIGFjdHVhbFcsXHJcbiAgICAgIGFjdHVhbFkgKyBhY3R1YWxIXHJcbiAgICApO1xyXG4gICAgY29uc3QgYmxQb3M6IFBvaW50ID0gbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhhY3R1YWxYLCBhY3R1YWxZKTtcclxuICAgIGNvbnN0IGJyUG9zOiBQb2ludCA9IG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coXHJcbiAgICAgIGFjdHVhbFggKyBhY3R1YWxXLFxyXG4gICAgICBhY3R1YWxZXHJcbiAgICApO1xyXG4gICAgY29uc3QgY2VudGVyOiBQb2ludCA9IG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coXHJcbiAgICAgIGFjdHVhbFggKyBhY3R1YWxXIC8gMixcclxuICAgICAgYWN0dWFsWSArIGFjdHVhbEggLyAyXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IHBvc2l0aW9uczogUG9pbnRbXSA9IFt0bFBvcywgdHJQb3MsIGJsUG9zLCBiclBvcywgY2VudGVyXTtcclxuICAgIHJldHVybiBwb3NpdGlvbnM7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0Q3JvcHBlZEltYWdlSGVscGVyKFxyXG4gICAgcHJlc2VydmVTaXplPzogYm9vbGVhbixcclxuICAgIGZpbGxXaWR0aD86IG51bWJlcixcclxuICAgIGZpbGxIZWlnaHQ/OiBudW1iZXJcclxuICApOiBIVE1MSW1hZ2VFbGVtZW50IHtcclxuICAgIGlmICh0aGlzLmNyb3BwZXJTZXR0aW5ncy5jcm9wT25SZXNpemUpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZ2V0Q3JvcHBlZEltYWdlKHByZXNlcnZlU2l6ZSwgZmlsbFdpZHRoLCBmaWxsSGVpZ2h0KTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmNyb3BwZWRJbWFnZVxyXG4gICAgICA/IHRoaXMuY3JvcHBlZEltYWdlXHJcbiAgICAgIDogZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XHJcbiAgfVxyXG5cclxuICAvLyB0b2RvOiBVbnVzZWQgcGFyYW1ldGVycz9cclxuICBwdWJsaWMgZ2V0Q3JvcHBlZEltYWdlKFxyXG4gICAgcHJlc2VydmVTaXplPzogYm9vbGVhbixcclxuICAgIGZpbGxXaWR0aD86IG51bWJlcixcclxuICAgIGZpbGxIZWlnaHQ/OiBudW1iZXJcclxuICApOiBIVE1MSW1hZ2VFbGVtZW50IHtcclxuICAgIGNvbnN0IGJvdW5kczogQm91bmRzID0gdGhpcy5nZXRCb3VuZHMoKTtcclxuICAgIGlmICghdGhpcy5zcmNJbWFnZSkge1xyXG4gICAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBzb3VyY2VBc3BlY3Q6IG51bWJlciA9IHRoaXMuc3JjSW1hZ2UuaGVpZ2h0IC8gdGhpcy5zcmNJbWFnZS53aWR0aDtcclxuICAgICAgY29uc3QgY2FudmFzQXNwZWN0OiBudW1iZXIgPSB0aGlzLmNhbnZhcy5oZWlnaHQgLyB0aGlzLmNhbnZhcy53aWR0aDtcclxuICAgICAgbGV0IHc6IG51bWJlciA9IHRoaXMuY2FudmFzLndpZHRoO1xyXG4gICAgICBsZXQgaDogbnVtYmVyID0gdGhpcy5jYW52YXMuaGVpZ2h0O1xyXG4gICAgICBpZiAoY2FudmFzQXNwZWN0ID4gc291cmNlQXNwZWN0KSB7XHJcbiAgICAgICAgdyA9IHRoaXMuY2FudmFzLndpZHRoO1xyXG4gICAgICAgIGggPSB0aGlzLmNhbnZhcy53aWR0aCAqIHNvdXJjZUFzcGVjdDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpZiAoY2FudmFzQXNwZWN0IDwgc291cmNlQXNwZWN0KSB7XHJcbiAgICAgICAgICBoID0gdGhpcy5jYW52YXMuaGVpZ2h0O1xyXG4gICAgICAgICAgdyA9IHRoaXMuY2FudmFzLmhlaWdodCAvIHNvdXJjZUFzcGVjdDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgaCA9IHRoaXMuY2FudmFzLmhlaWdodDtcclxuICAgICAgICAgIHcgPSB0aGlzLmNhbnZhcy53aWR0aDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5yYXRpb1cgPSB3IC8gdGhpcy5zcmNJbWFnZS53aWR0aDtcclxuICAgICAgdGhpcy5yYXRpb0ggPSBoIC8gdGhpcy5zcmNJbWFnZS5oZWlnaHQ7XHJcbiAgICAgIGNvbnN0IG9mZnNldEg6IG51bWJlciA9ICh0aGlzLmJ1ZmZlci5oZWlnaHQgLSBoKSAvIDIgLyB0aGlzLnJhdGlvSDtcclxuICAgICAgY29uc3Qgb2Zmc2V0VzogbnVtYmVyID0gKHRoaXMuYnVmZmVyLndpZHRoIC0gdykgLyAyIC8gdGhpcy5yYXRpb1c7XHJcblxyXG4gICAgICBjb25zdCBjdHggPSB0aGlzLmNyb3BDYW52YXMuZ2V0Q29udGV4dCgnMmQnKSBhcyBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XHJcblxyXG4gICAgICBpZiAodGhpcy5jcm9wcGVyU2V0dGluZ3MucHJlc2VydmVTaXplIHx8IHByZXNlcnZlU2l6ZSkge1xyXG4gICAgICAgIGNvbnN0IHdpZHRoID0gTWF0aC5yb3VuZChcclxuICAgICAgICAgIGJvdW5kcy5yaWdodCAvIHRoaXMucmF0aW9XIC0gYm91bmRzLmxlZnQgLyB0aGlzLnJhdGlvV1xyXG4gICAgICAgICk7XHJcbiAgICAgICAgY29uc3QgaGVpZ2h0ID0gTWF0aC5yb3VuZChcclxuICAgICAgICAgIGJvdW5kcy5ib3R0b20gLyB0aGlzLnJhdGlvSCAtIGJvdW5kcy50b3AgLyB0aGlzLnJhdGlvSFxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIHRoaXMuY3JvcENhbnZhcy53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgIHRoaXMuY3JvcENhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XHJcblxyXG4gICAgICAgIHRoaXMuY3JvcHBlclNldHRpbmdzLmNyb3BwZWRXaWR0aCA9IHRoaXMuY3JvcENhbnZhcy53aWR0aDtcclxuICAgICAgICB0aGlzLmNyb3BwZXJTZXR0aW5ncy5jcm9wcGVkSGVpZ2h0ID0gdGhpcy5jcm9wQ2FudmFzLmhlaWdodDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmNyb3BDYW52YXMud2lkdGggPSB0aGlzLmNyb3BXaWR0aDtcclxuICAgICAgICB0aGlzLmNyb3BDYW52YXMuaGVpZ2h0ID0gdGhpcy5jcm9wSGVpZ2h0O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMuY3JvcENhbnZhcy53aWR0aCwgdGhpcy5jcm9wQ2FudmFzLmhlaWdodCk7XHJcbiAgICAgIHRoaXMuZHJhd0ltYWdlSU9TRml4KFxyXG4gICAgICAgIGN0eCxcclxuICAgICAgICB0aGlzLnNyY0ltYWdlLFxyXG4gICAgICAgIE1hdGgubWF4KE1hdGgucm91bmQoYm91bmRzLmxlZnQgLyB0aGlzLnJhdGlvVyAtIG9mZnNldFcpLCAwKSxcclxuICAgICAgICBNYXRoLm1heChNYXRoLnJvdW5kKGJvdW5kcy50b3AgLyB0aGlzLnJhdGlvSCAtIG9mZnNldEgpLCAwKSxcclxuICAgICAgICBNYXRoLm1heChNYXRoLnJvdW5kKGJvdW5kcy53aWR0aCAvIHRoaXMucmF0aW9XKSwgMSksXHJcbiAgICAgICAgTWF0aC5tYXgoTWF0aC5yb3VuZChib3VuZHMuaGVpZ2h0IC8gdGhpcy5yYXRpb0gpLCAxKSxcclxuICAgICAgICAwLFxyXG4gICAgICAgIDAsXHJcbiAgICAgICAgdGhpcy5jcm9wQ2FudmFzLndpZHRoLFxyXG4gICAgICAgIHRoaXMuY3JvcENhbnZhcy5oZWlnaHRcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGlmICh0aGlzLmNyb3BwZXJTZXR0aW5ncy5yZXNhbXBsZUZuKSB7XHJcbiAgICAgICAgdGhpcy5jcm9wcGVyU2V0dGluZ3MucmVzYW1wbGVGbih0aGlzLmNyb3BDYW52YXMpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLmNyb3BwZWRJbWFnZS53aWR0aCA9IHRoaXMuY3JvcENhbnZhcy53aWR0aDtcclxuICAgICAgdGhpcy5jcm9wcGVkSW1hZ2UuaGVpZ2h0ID0gdGhpcy5jcm9wQ2FudmFzLmhlaWdodDtcclxuICAgICAgdGhpcy5jcm9wcGVkSW1hZ2Uuc3JjID0gdGhpcy5jcm9wQ2FudmFzLnRvRGF0YVVSTChcclxuICAgICAgICB0aGlzLmZpbGVUeXBlLFxyXG4gICAgICAgIHRoaXMuY3JvcHBlclNldHRpbmdzLmNvbXByZXNzUmF0aW9cclxuICAgICAgKTtcclxuICAgICAgcmV0dXJuIHRoaXMuY3JvcHBlZEltYWdlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldEJvdW5kcygpOiBCb3VuZHMge1xyXG4gICAgbGV0IG1pblggPSBOdW1iZXIuTUFYX1ZBTFVFO1xyXG4gICAgbGV0IG1pblkgPSBOdW1iZXIuTUFYX1ZBTFVFO1xyXG4gICAgbGV0IG1heFggPSAtTnVtYmVyLk1BWF9WQUxVRTtcclxuICAgIGxldCBtYXhZID0gLU51bWJlci5NQVhfVkFMVUU7XHJcbiAgICBmb3IgKGNvbnN0IG1hcmtlciBvZiB0aGlzLm1hcmtlcnMpIHtcclxuICAgICAgaWYgKG1hcmtlci5wb3NpdGlvbi54IDwgbWluWCkge1xyXG4gICAgICAgIG1pblggPSBtYXJrZXIucG9zaXRpb24ueDtcclxuICAgICAgfVxyXG4gICAgICBpZiAobWFya2VyLnBvc2l0aW9uLnggPiBtYXhYKSB7XHJcbiAgICAgICAgbWF4WCA9IG1hcmtlci5wb3NpdGlvbi54O1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChtYXJrZXIucG9zaXRpb24ueSA8IG1pblkpIHtcclxuICAgICAgICBtaW5ZID0gbWFya2VyLnBvc2l0aW9uLnk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG1hcmtlci5wb3NpdGlvbi55ID4gbWF4WSkge1xyXG4gICAgICAgIG1heFkgPSBtYXJrZXIucG9zaXRpb24ueTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgYm91bmRzOiBCb3VuZHMgPSBuZXcgQm91bmRzKCk7XHJcbiAgICBib3VuZHMubGVmdCA9IG1pblg7XHJcbiAgICBib3VuZHMucmlnaHQgPSBtYXhYO1xyXG4gICAgYm91bmRzLnRvcCA9IG1pblk7XHJcbiAgICBib3VuZHMuYm90dG9tID0gbWF4WTtcclxuICAgIHJldHVybiBib3VuZHM7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0Qm91bmRzKGJvdW5kczogYW55KSB7XHJcbiAgICAvLyBjb25zdCB0b3BMZWZ0OiBDb3JuZXJNYXJrZXI7XHJcbiAgICAvLyBjb25zdCB0b3BSaWdodDogQ29ybmVyTWFya2VyO1xyXG4gICAgLy8gY29uc3QgYm90dG9tTGVmdDogQ29ybmVyTWFya2VyO1xyXG4gICAgLy8gY29uc3QgYm90dG9tUmlnaHQ6IENvcm5lck1hcmtlcjtcclxuXHJcbiAgICBjb25zdCBjdXJyZW50Qm91bmRzID0gdGhpcy5nZXRCb3VuZHMoKTtcclxuICAgIGZvciAoY29uc3QgbWFya2VyIG9mIHRoaXMubWFya2Vycykge1xyXG4gICAgICBpZiAobWFya2VyLnBvc2l0aW9uLnggPT09IGN1cnJlbnRCb3VuZHMubGVmdCkge1xyXG4gICAgICAgIGlmIChtYXJrZXIucG9zaXRpb24ueSA9PT0gY3VycmVudEJvdW5kcy50b3ApIHtcclxuICAgICAgICAgIG1hcmtlci5zZXRQb3NpdGlvbihib3VuZHMubGVmdCwgYm91bmRzLnRvcCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIG1hcmtlci5zZXRQb3NpdGlvbihib3VuZHMubGVmdCwgYm91bmRzLmJvdHRvbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmIChtYXJrZXIucG9zaXRpb24ueSA9PT0gY3VycmVudEJvdW5kcy50b3ApIHtcclxuICAgICAgICAgIG1hcmtlci5zZXRQb3NpdGlvbihib3VuZHMucmlnaHQsIGJvdW5kcy50b3ApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBtYXJrZXIuc2V0UG9zaXRpb24oYm91bmRzLnJpZ2h0LCBib3VuZHMuYm90dG9tKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNlbnRlci5yZWNhbGN1bGF0ZVBvc2l0aW9uKGJvdW5kcyk7XHJcbiAgICB0aGlzLmNlbnRlci5kcmF3KHRoaXMuY3R4KTtcclxuICAgIHRoaXMuZHJhdyh0aGlzLmN0eCk7IC8vIHdlIG5lZWQgdG8gcmVkcmF3IGFsbCBjYW52YXMgaWYgd2UgaGF2ZSBjaGFuZ2VkIGJvdW5kc1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG9uVG91Y2hNb3ZlKGV2ZW50OiBUb3VjaEV2ZW50KSB7XHJcbiAgICBpZiAodGhpcy5jcm9wLmlzSW1hZ2VTZXQoKSkge1xyXG4gICAgICBpZiAoZXZlbnQudG91Y2hlcy5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICBpZiAodGhpcy5pc01vdXNlRG93bikge1xyXG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpwcmVmZXItZm9yLW9mXHJcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV2ZW50LnRvdWNoZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgdG91Y2ggPSBldmVudC50b3VjaGVzW2ldO1xyXG4gICAgICAgICAgICBjb25zdCB0b3VjaFBvc2l0aW9uID0gdGhpcy5nZXRUb3VjaFBvcyh0aGlzLmNhbnZhcywgdG91Y2gpO1xyXG4gICAgICAgICAgICBjb25zdCBjcm9wVG91Y2ggPSBuZXcgQ3JvcFRvdWNoKFxyXG4gICAgICAgICAgICAgIHRvdWNoUG9zaXRpb24ueCxcclxuICAgICAgICAgICAgICB0b3VjaFBvc2l0aW9uLnksXHJcbiAgICAgICAgICAgICAgdG91Y2guaWRlbnRpZmllclxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UucmV0dXJuUG9pbnQodG91Y2hQb3NpdGlvbik7XHJcbiAgICAgICAgICAgIHRoaXMubW92ZShjcm9wVG91Y2gpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpZiAoZXZlbnQudG91Y2hlcy5sZW5ndGggPT09IDIpIHtcclxuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgY29uc3QgZGlzdGFuY2UgPVxyXG4gICAgICAgICAgICAoZXZlbnQudG91Y2hlc1swXS5jbGllbnRYIC0gZXZlbnQudG91Y2hlc1sxXS5jbGllbnRYKSAqXHJcbiAgICAgICAgICAgICAgKGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WCAtIGV2ZW50LnRvdWNoZXNbMV0uY2xpZW50WCkgK1xyXG4gICAgICAgICAgICAoZXZlbnQudG91Y2hlc1swXS5jbGllbnRZIC0gZXZlbnQudG91Y2hlc1sxXS5jbGllbnRZKSAqXHJcbiAgICAgICAgICAgICAgKGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WSAtIGV2ZW50LnRvdWNoZXNbMV0uY2xpZW50WSk7XHJcbiAgICAgICAgICBpZiAodGhpcy5wcmV2aW91c0Rpc3RhbmNlICYmIHRoaXMucHJldmlvdXNEaXN0YW5jZSAhPT0gZGlzdGFuY2UpIHtcclxuICAgICAgICAgICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChkaXN0YW5jZSA8IHRoaXMucHJldmlvdXNEaXN0YW5jZSkge1xyXG4gICAgICAgICAgICAgIGJvdW5kcy50b3AgKz0gMTtcclxuICAgICAgICAgICAgICBib3VuZHMubGVmdCArPSAxO1xyXG4gICAgICAgICAgICAgIGJvdW5kcy5yaWdodCAtPSAxO1xyXG4gICAgICAgICAgICAgIGJvdW5kcy5ib3R0b20gLT0gMTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGRpc3RhbmNlID4gdGhpcy5wcmV2aW91c0Rpc3RhbmNlKSB7XHJcbiAgICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgICAgYm91bmRzLnRvcCAhPT0gdGhpcy5taW5ZQ2xhbXAgJiZcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5ib3R0b20gIT09IHRoaXMubWF4WUNsYW1wICYmXHJcbiAgICAgICAgICAgICAgICBib3VuZHMubGVmdCAhPT0gdGhpcy5taW5YQ2xhbXAgJiZcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5yaWdodCAhPT0gdGhpcy5tYXhYQ2xhbXBcclxuICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIC8vIG5vbmVcclxuICAgICAgICAgICAgICAgIGJvdW5kcy50b3AgLT0gMTtcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5sZWZ0IC09IDE7XHJcbiAgICAgICAgICAgICAgICBib3VuZHMucmlnaHQgKz0gMTtcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5ib3R0b20gKz0gMTtcclxuICAgICAgICAgICAgICB9IGVsc2UgaWYgKFxyXG4gICAgICAgICAgICAgICAgYm91bmRzLnRvcCAhPT0gdGhpcy5taW5ZQ2xhbXAgJiZcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5ib3R0b20gIT09IHRoaXMubWF4WUNsYW1wICYmXHJcbiAgICAgICAgICAgICAgICBib3VuZHMubGVmdCA9PT0gdGhpcy5taW5YQ2xhbXAgJiZcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5yaWdodCAhPT0gdGhpcy5tYXhYQ2xhbXBcclxuICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIC8vIGxlZnRcclxuICAgICAgICAgICAgICAgIGJvdW5kcy50b3AgLT0gMTtcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5yaWdodCArPSAyO1xyXG4gICAgICAgICAgICAgICAgYm91bmRzLmJvdHRvbSArPSAxO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoXHJcbiAgICAgICAgICAgICAgICBib3VuZHMudG9wICE9PSB0aGlzLm1pbllDbGFtcCAmJlxyXG4gICAgICAgICAgICAgICAgYm91bmRzLmJvdHRvbSAhPT0gdGhpcy5tYXhZQ2xhbXAgJiZcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5sZWZ0ICE9PSB0aGlzLm1pblhDbGFtcCAmJlxyXG4gICAgICAgICAgICAgICAgYm91bmRzLnJpZ2h0ID09PSB0aGlzLm1heFhDbGFtcFxyXG4gICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgLy8gcmlnaHRcclxuICAgICAgICAgICAgICAgIGJvdW5kcy50b3AgLT0gMTtcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5sZWZ0IC09IDI7XHJcbiAgICAgICAgICAgICAgICBib3VuZHMuYm90dG9tICs9IDE7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChcclxuICAgICAgICAgICAgICAgIGJvdW5kcy50b3AgPT09IHRoaXMubWluWUNsYW1wICYmXHJcbiAgICAgICAgICAgICAgICBib3VuZHMuYm90dG9tICE9PSB0aGlzLm1heFlDbGFtcCAmJlxyXG4gICAgICAgICAgICAgICAgYm91bmRzLmxlZnQgIT09IHRoaXMubWluWENsYW1wICYmXHJcbiAgICAgICAgICAgICAgICBib3VuZHMucmlnaHQgIT09IHRoaXMubWF4WENsYW1wXHJcbiAgICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0b3BcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5sZWZ0IC09IDE7XHJcbiAgICAgICAgICAgICAgICBib3VuZHMucmlnaHQgKz0gMTtcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5ib3R0b20gKz0gMjtcclxuICAgICAgICAgICAgICB9IGVsc2UgaWYgKFxyXG4gICAgICAgICAgICAgICAgYm91bmRzLnRvcCAhPT0gdGhpcy5taW5ZQ2xhbXAgJiZcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5ib3R0b20gPT09IHRoaXMubWF4WUNsYW1wICYmXHJcbiAgICAgICAgICAgICAgICBib3VuZHMubGVmdCAhPT0gdGhpcy5taW5YQ2xhbXAgJiZcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5yaWdodCAhPT0gdGhpcy5tYXhYQ2xhbXBcclxuICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIC8vIGJvdHRvbVxyXG4gICAgICAgICAgICAgICAgYm91bmRzLnRvcCAtPSAyO1xyXG4gICAgICAgICAgICAgICAgYm91bmRzLmxlZnQgLT0gMTtcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5yaWdodCArPSAxO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoXHJcbiAgICAgICAgICAgICAgICBib3VuZHMudG9wID09PSB0aGlzLm1pbllDbGFtcCAmJlxyXG4gICAgICAgICAgICAgICAgYm91bmRzLmJvdHRvbSAhPT0gdGhpcy5tYXhZQ2xhbXAgJiZcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5sZWZ0ID09PSB0aGlzLm1pblhDbGFtcCAmJlxyXG4gICAgICAgICAgICAgICAgYm91bmRzLnJpZ2h0ICE9PSB0aGlzLm1heFhDbGFtcFxyXG4gICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgLy8gdG9wIGxlZnRcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5yaWdodCArPSAyO1xyXG4gICAgICAgICAgICAgICAgYm91bmRzLmJvdHRvbSArPSAyO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoXHJcbiAgICAgICAgICAgICAgICBib3VuZHMudG9wID09PSB0aGlzLm1pbllDbGFtcCAmJlxyXG4gICAgICAgICAgICAgICAgYm91bmRzLmJvdHRvbSAhPT0gdGhpcy5tYXhZQ2xhbXAgJiZcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5sZWZ0ICE9PSB0aGlzLm1pblhDbGFtcCAmJlxyXG4gICAgICAgICAgICAgICAgYm91bmRzLnJpZ2h0ID09PSB0aGlzLm1heFhDbGFtcFxyXG4gICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgLy8gdG9wIHJpZ2h0XHJcbiAgICAgICAgICAgICAgICBib3VuZHMubGVmdCAtPSAyO1xyXG4gICAgICAgICAgICAgICAgYm91bmRzLmJvdHRvbSArPSAyO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoXHJcbiAgICAgICAgICAgICAgICBib3VuZHMudG9wICE9PSB0aGlzLm1pbllDbGFtcCAmJlxyXG4gICAgICAgICAgICAgICAgYm91bmRzLmJvdHRvbSA9PT0gdGhpcy5tYXhZQ2xhbXAgJiZcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5sZWZ0ID09PSB0aGlzLm1pblhDbGFtcCAmJlxyXG4gICAgICAgICAgICAgICAgYm91bmRzLnJpZ2h0ICE9PSB0aGlzLm1heFhDbGFtcFxyXG4gICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgLy8gYm90dG9tIGxlZnRcclxuICAgICAgICAgICAgICAgIGJvdW5kcy50b3AgLT0gMjtcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5yaWdodCArPSAyO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoXHJcbiAgICAgICAgICAgICAgICBib3VuZHMudG9wICE9PSB0aGlzLm1pbllDbGFtcCAmJlxyXG4gICAgICAgICAgICAgICAgYm91bmRzLmJvdHRvbSA9PT0gdGhpcy5tYXhZQ2xhbXAgJiZcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5sZWZ0ICE9PSB0aGlzLm1pblhDbGFtcCAmJlxyXG4gICAgICAgICAgICAgICAgYm91bmRzLnJpZ2h0ID09PSB0aGlzLm1heFhDbGFtcFxyXG4gICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgLy8gYm90dG9tIHJpZ2h0XHJcbiAgICAgICAgICAgICAgICBib3VuZHMudG9wIC09IDI7XHJcbiAgICAgICAgICAgICAgICBib3VuZHMubGVmdCAtPSAyO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGJvdW5kcy50b3AgPCB0aGlzLm1pbllDbGFtcCkge1xyXG4gICAgICAgICAgICAgIGJvdW5kcy50b3AgPSB0aGlzLm1pbllDbGFtcDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoYm91bmRzLmJvdHRvbSA+IHRoaXMubWF4WUNsYW1wKSB7XHJcbiAgICAgICAgICAgICAgYm91bmRzLmJvdHRvbSA9IHRoaXMubWF4WUNsYW1wO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChib3VuZHMubGVmdCA8IHRoaXMubWluWENsYW1wKSB7XHJcbiAgICAgICAgICAgICAgYm91bmRzLmxlZnQgPSB0aGlzLm1pblhDbGFtcDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoYm91bmRzLnJpZ2h0ID4gdGhpcy5tYXhYQ2xhbXApIHtcclxuICAgICAgICAgICAgICBib3VuZHMucmlnaHQgPSB0aGlzLm1heFhDbGFtcDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5zZXRCb3VuZHMoYm91bmRzKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMucHJldmlvdXNEaXN0YW5jZSA9IGRpc3RhbmNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICB0aGlzLmRyYXcodGhpcy5jdHgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIG9uTW91c2VNb3ZlKGU6IE1vdXNlRXZlbnQpIHtcclxuICAgIGlmICh0aGlzLmNyb3AuaXNJbWFnZVNldCgpICYmIHRoaXMuaXNNb3VzZURvd24pIHtcclxuICAgICAgY29uc3QgbW91c2VQb3NpdGlvbiA9IHRoaXMuZ2V0TW91c2VQb3ModGhpcy5jYW52YXMsIGUpO1xyXG4gICAgICB0aGlzLm1vdmUobmV3IENyb3BUb3VjaChtb3VzZVBvc2l0aW9uLngsIG1vdXNlUG9zaXRpb24ueSwgMCkpO1xyXG4gICAgICBsZXQgZHJhZ1RvdWNoID0gdGhpcy5nZXREcmFnVG91Y2hGb3JJRCgwKTtcclxuICAgICAgaWYgKGRyYWdUb3VjaCkge1xyXG4gICAgICAgIGRyYWdUb3VjaC54ID0gbW91c2VQb3NpdGlvbi54O1xyXG4gICAgICAgIGRyYWdUb3VjaC55ID0gbW91c2VQb3NpdGlvbi55O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGRyYWdUb3VjaCA9IG5ldyBDcm9wVG91Y2gobW91c2VQb3NpdGlvbi54LCBtb3VzZVBvc2l0aW9uLnksIDApO1xyXG4gICAgICB9XHJcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5yZXR1cm5Qb2ludChtb3VzZVBvc2l0aW9uKTtcclxuICAgICAgdGhpcy5kcmF3Q3Vyc29ycyhkcmFnVG91Y2gpO1xyXG4gICAgICB0aGlzLmRyYXcodGhpcy5jdHgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIG1vdmUoY3JvcFRvdWNoOiBDcm9wVG91Y2gpIHtcclxuICAgIGlmICh0aGlzLmlzTW91c2VEb3duKSB7XHJcbiAgICAgIHRoaXMuaGFuZGxlTW92ZShjcm9wVG91Y2gpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldERyYWdUb3VjaEZvcklEKGlkOiBhbnkpOiBDcm9wVG91Y2ggfCB1bmRlZmluZWQge1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnByZWZlci1mb3Itb2ZcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5jdXJyZW50RHJhZ1RvdWNoZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgaWYgKGlkID09PSB0aGlzLmN1cnJlbnREcmFnVG91Y2hlc1tpXS5pZCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnREcmFnVG91Y2hlc1tpXTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBkcmF3Q3Vyc29ycyhjcm9wVG91Y2g6IENyb3BUb3VjaCkge1xyXG4gICAgbGV0IGN1cnNvckRyYXduID0gZmFsc2U7XHJcbiAgICBpZiAoY3JvcFRvdWNoICE9IG51bGwpIHtcclxuICAgICAgaWYgKGNyb3BUb3VjaC5kcmFnSGFuZGxlID09PSB0aGlzLmNlbnRlcikge1xyXG4gICAgICAgIHRoaXMuaW1hZ2VDcm9wcGVyRGF0YVNoYXJlLnNldFN0eWxlKHRoaXMuY2FudmFzLCAnbW92ZScpO1xyXG4gICAgICAgIGN1cnNvckRyYXduID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoXHJcbiAgICAgICAgY3JvcFRvdWNoLmRyYWdIYW5kbGUgIT09IG51bGwgJiZcclxuICAgICAgICBjcm9wVG91Y2guZHJhZ0hhbmRsZSBpbnN0YW5jZW9mIENvcm5lck1hcmtlclxyXG4gICAgICApIHtcclxuICAgICAgICB0aGlzLmRyYXdDb3JuZXJDdXJzb3IoXHJcbiAgICAgICAgICBjcm9wVG91Y2guZHJhZ0hhbmRsZSxcclxuICAgICAgICAgIGNyb3BUb3VjaC5kcmFnSGFuZGxlLnBvc2l0aW9uLngsXHJcbiAgICAgICAgICBjcm9wVG91Y2guZHJhZ0hhbmRsZS5wb3NpdGlvbi55XHJcbiAgICAgICAgKTtcclxuICAgICAgICBjdXJzb3JEcmF3biA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGxldCBkaWREcmF3ID0gZmFsc2U7XHJcbiAgICBpZiAoIWN1cnNvckRyYXduKSB7XHJcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpwcmVmZXItZm9yLW9mXHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5tYXJrZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgZGlkRHJhdyA9XHJcbiAgICAgICAgICBkaWREcmF3IHx8XHJcbiAgICAgICAgICB0aGlzLmRyYXdDb3JuZXJDdXJzb3IodGhpcy5tYXJrZXJzW2ldLCBjcm9wVG91Y2gueCwgY3JvcFRvdWNoLnkpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICghZGlkRHJhdykge1xyXG4gICAgICAgIHRoaXMuaW1hZ2VDcm9wcGVyRGF0YVNoYXJlLnNldFN0eWxlKHRoaXMuY2FudmFzLCAnaW5pdGlhbCcpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoXHJcbiAgICAgICFkaWREcmF3ICYmXHJcbiAgICAgICFjdXJzb3JEcmF3biAmJlxyXG4gICAgICB0aGlzLmNlbnRlci50b3VjaEluQm91bmRzKGNyb3BUb3VjaC54LCBjcm9wVG91Y2gueSlcclxuICAgICkge1xyXG4gICAgICB0aGlzLmNlbnRlci5zZXRPdmVyKHRydWUpO1xyXG4gICAgICB0aGlzLmltYWdlQ3JvcHBlckRhdGFTaGFyZS5zZXRPdmVyKHRoaXMuY2FudmFzKTtcclxuICAgICAgdGhpcy5pbWFnZUNyb3BwZXJEYXRhU2hhcmUuc2V0U3R5bGUodGhpcy5jYW52YXMsICdtb3ZlJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmNlbnRlci5zZXRPdmVyKGZhbHNlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBkcmF3Q29ybmVyQ3Vyc29yKG1hcmtlcjogYW55LCB4OiBudW1iZXIsIHk6IG51bWJlcikge1xyXG4gICAgaWYgKG1hcmtlci50b3VjaEluQm91bmRzKHgsIHkpKSB7XHJcbiAgICAgIG1hcmtlci5zZXRPdmVyKHRydWUpO1xyXG4gICAgICBpZiAobWFya2VyLmdldEhvcml6b250YWxOZWlnaGJvdXIoKS5wb3NpdGlvbi54ID4gbWFya2VyLnBvc2l0aW9uLngpIHtcclxuICAgICAgICBpZiAobWFya2VyLmdldFZlcnRpY2FsTmVpZ2hib3VyKCkucG9zaXRpb24ueSA+IG1hcmtlci5wb3NpdGlvbi55KSB7XHJcbiAgICAgICAgICB0aGlzLmltYWdlQ3JvcHBlckRhdGFTaGFyZS5zZXRPdmVyKHRoaXMuY2FudmFzKTtcclxuICAgICAgICAgIHRoaXMuaW1hZ2VDcm9wcGVyRGF0YVNoYXJlLnNldFN0eWxlKHRoaXMuY2FudmFzLCAnbndzZS1yZXNpemUnKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5pbWFnZUNyb3BwZXJEYXRhU2hhcmUuc2V0T3Zlcih0aGlzLmNhbnZhcyk7XHJcbiAgICAgICAgICB0aGlzLmltYWdlQ3JvcHBlckRhdGFTaGFyZS5zZXRTdHlsZSh0aGlzLmNhbnZhcywgJ25lc3ctcmVzaXplJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmIChtYXJrZXIuZ2V0VmVydGljYWxOZWlnaGJvdXIoKS5wb3NpdGlvbi55ID4gbWFya2VyLnBvc2l0aW9uLnkpIHtcclxuICAgICAgICAgIHRoaXMuaW1hZ2VDcm9wcGVyRGF0YVNoYXJlLnNldE92ZXIodGhpcy5jYW52YXMpO1xyXG4gICAgICAgICAgdGhpcy5pbWFnZUNyb3BwZXJEYXRhU2hhcmUuc2V0U3R5bGUodGhpcy5jYW52YXMsICduZXN3LXJlc2l6ZScpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmltYWdlQ3JvcHBlckRhdGFTaGFyZS5zZXRPdmVyKHRoaXMuY2FudmFzKTtcclxuICAgICAgICAgIHRoaXMuaW1hZ2VDcm9wcGVyRGF0YVNoYXJlLnNldFN0eWxlKHRoaXMuY2FudmFzLCAnbndzZS1yZXNpemUnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBtYXJrZXIuc2V0T3ZlcihmYWxzZSk7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb25Ub3VjaFN0YXJ0KGV2ZW50OiBUb3VjaEV2ZW50KSB7XHJcbiAgICBpZiAodGhpcy5jcm9wLmlzSW1hZ2VTZXQoKSkge1xyXG4gICAgICBjb25zdCB0b3VjaCA9IGV2ZW50LnRvdWNoZXNbMF07XHJcbiAgICAgIGNvbnN0IHRvdWNoUG9zaXRpb24gPSB0aGlzLmdldFRvdWNoUG9zKHRoaXMuY2FudmFzLCB0b3VjaCk7XHJcbiAgICAgIGNvbnN0IGNyb3BUb3VjaCA9IG5ldyBDcm9wVG91Y2goXHJcbiAgICAgICAgdG91Y2hQb3NpdGlvbi54LFxyXG4gICAgICAgIHRvdWNoUG9zaXRpb24ueSxcclxuICAgICAgICB0b3VjaC5pZGVudGlmaWVyXHJcbiAgICAgICk7XHJcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5yZXR1cm5Qb2ludCh0b3VjaFBvc2l0aW9uKTtcclxuXHJcbiAgICAgIHRoaXMuaXNNb3VzZURvd24gPSBmYWxzZTtcclxuICAgICAgZm9yIChjb25zdCBtYXJrZXIgb2YgdGhpcy5tYXJrZXJzKSB7XHJcbiAgICAgICAgaWYgKG1hcmtlci50b3VjaEluQm91bmRzKGNyb3BUb3VjaC54LCBjcm9wVG91Y2gueSkpIHtcclxuICAgICAgICAgIHRoaXMuaXNNb3VzZURvd24gPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy5jZW50ZXIudG91Y2hJbkJvdW5kcyhjcm9wVG91Y2gueCwgY3JvcFRvdWNoLnkpKSB7XHJcbiAgICAgICAgdGhpcy5pc01vdXNlRG93biA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBvblRvdWNoRW5kKGV2ZW50OiBUb3VjaEV2ZW50KSB7XHJcbiAgICBpZiAodGhpcy5jcm9wLmlzSW1hZ2VTZXQoKSkge1xyXG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6cHJlZmVyLWZvci1vZlxyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV2ZW50LmNoYW5nZWRUb3VjaGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgY29uc3QgdG91Y2ggPSBldmVudC5jaGFuZ2VkVG91Y2hlc1tpXTtcclxuICAgICAgICBjb25zdCBkcmFnVG91Y2ggPSB0aGlzLmdldERyYWdUb3VjaEZvcklEKHRvdWNoLmlkZW50aWZpZXIpO1xyXG4gICAgICAgIGlmIChkcmFnVG91Y2ggJiYgZHJhZ1RvdWNoICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgZHJhZ1RvdWNoLmRyYWdIYW5kbGUgaW5zdGFuY2VvZiBDb3JuZXJNYXJrZXIgfHxcclxuICAgICAgICAgICAgZHJhZ1RvdWNoLmRyYWdIYW5kbGUgaW5zdGFuY2VvZiBEcmFnTWFya2VyXHJcbiAgICAgICAgICApIHtcclxuICAgICAgICAgICAgZHJhZ1RvdWNoLmRyYWdIYW5kbGUuc2V0T3ZlcihmYWxzZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmhhbmRsZVJlbGVhc2UoZHJhZ1RvdWNoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICh0aGlzLmN1cnJlbnREcmFnVG91Y2hlcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICB0aGlzLmlzTW91c2VEb3duID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50bHlJbnRlcmFjdGluZyA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzExOTI5MDk5L2h0bWw1LWNhbnZhcy1kcmF3aW1hZ2UtcmF0aW8tYnVnLWlvc1xyXG4gIHB1YmxpYyBkcmF3SW1hZ2VJT1NGaXgoXHJcbiAgICBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCxcclxuICAgIGltZzogSFRNTEltYWdlRWxlbWVudCB8IEhUTUxDYW52YXNFbGVtZW50IHwgSFRNTFZpZGVvRWxlbWVudCxcclxuICAgIHN4OiBudW1iZXIsXHJcbiAgICBzeTogbnVtYmVyLFxyXG4gICAgc3c6IG51bWJlcixcclxuICAgIHNoOiBudW1iZXIsXHJcbiAgICBkeDogbnVtYmVyLFxyXG4gICAgZHk6IG51bWJlcixcclxuICAgIGR3OiBudW1iZXIsXHJcbiAgICBkaDogbnVtYmVyXHJcbiAgKSB7XHJcbiAgICAvLyBXb3JrcyBvbmx5IGlmIHdob2xlIGltYWdlIGlzIGRpc3BsYXllZDpcclxuICAgIC8vIGN0eC5kcmF3SW1hZ2UoaW1nLCBzeCwgc3ksIHN3LCBzaCwgZHgsIGR5LCBkdywgZGggLyB2ZXJ0U3F1YXNoUmF0aW8pO1xyXG4gICAgLy8gVGhlIGZvbGxvd2luZyB3b3JrcyBjb3JyZWN0IGFsc28gd2hlbiBvbmx5IGEgcGFydCBvZiB0aGUgaW1hZ2UgaXMgZGlzcGxheWVkOlxyXG4gICAgLy8gY3R4LmRyYXdJbWFnZShpbWcsIHN4ICogdGhpcy52ZXJ0U3F1YXNoUmF0aW8sIHN5ICogdGhpcy52ZXJ0U3F1YXNoUmF0aW8sIHN3ICogdGhpcy52ZXJ0U3F1YXNoUmF0aW8sIHNoICpcclxuICAgIC8vIHRoaXMudmVydFNxdWFzaFJhdGlvLCBkeCwgZHksIGR3LCBkaCk7XHJcbiAgICBjdHguZHJhd0ltYWdlKGltZywgc3gsIHN5LCBzdywgc2gsIGR4LCBkeSwgZHcsIGRoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvbk1vdXNlRG93bihldmVudDogTW91c2VFdmVudCkge1xyXG4gICAgaWYgKHRoaXMuY3JvcC5pc0ltYWdlU2V0KCkpIHtcclxuICAgICAgdGhpcy5pc01vdXNlRG93biA9IHRydWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb25Nb3VzZVVwKGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICBpZiAodGhpcy5jcm9wLmlzSW1hZ2VTZXQoKSkge1xyXG4gICAgICB0aGlzLmltYWdlQ3JvcHBlckRhdGFTaGFyZS5zZXRSZWxlYXNlZCh0aGlzLmNhbnZhcyk7XHJcbiAgICAgIHRoaXMuaXNNb3VzZURvd24gPSBmYWxzZTtcclxuICAgICAgdGhpcy5oYW5kbGVSZWxlYXNlKG5ldyBDcm9wVG91Y2goMCwgMCwgMCkpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=